{% comment %}
  Product Gallery Component
  Renders a product gallery with image/video support, thumbnails, and fullscreen view.
  Accepts:
  - product: {Object} Product object
  - section: {Object} Section object for settings
  Usage:
  {% render 'product-gallery', product: product, section: section %}
{% endcomment %}

<div class="product-gallery-container_new">
  <div class="product-gallery_new">
    <!-- Main Image/Video Container -->
    <div class="main-image_new" id="mainImageContainer_new">
      {%- if product.featured_media -%}
        <!-- Video Container -->
        <div
          class="main-video-container_new"
          id="mainVideoContainer_new"
          style="display: none;">
          <video
            id="mainVideo_new"
            controls
            disablepictureinpicture
            controlslist="nodownload"
            preload="metadata"
            autoplay
            muted
            width="800"
            height="600">
            <source src="" type="video/mp4">
            Your browser does not support the video tag.
          </video>
          <div class="video-play-overlay_new">
            <svg
              width="60"
              height="60"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <circle
                cx="12"
                cy="12"
                r="10"
                fill="rgba(0,0,0,0.6)" />
              <path d="M10 8L16 12L10 16V8Z" fill="white" />
            </svg>
          </div>
        </div>

        <!-- Main Image -->
        <img
          id="mainImage_new"
          src="{{ product.featured_media | image_url: width: 800 }}"
          alt="{{ product.featured_media.alt | escape }}"
          width="800"
          height="800"
          loading="lazy">
      {%- endif -%}

      <!-- Swipe Indicator -->
      <div class="swipe-indicator_new" id="swipeIndicator_new">
        <span>‚Üê Swipe or tap to browse</span>
      </div>

      <!-- Navigation Arrows -->
      <button
        class="main-nav_new main-prev_new"
        onclick="changeImage(-1)"
        aria-label="Previous image">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none">
          <path
            d="M15 18L9 12L15 6"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </button>

      <button
        class="main-nav_new main-next_new"
        onclick="changeImage(1)"
        aria-label="Next image">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none">
          <path
            d="M9 18L15 12L9 6"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </button>
    </div>

    <!-- Fullscreen Modal -->
    <div
      class="fullscreen-modal_new"
      id="fullscreenModal_new"
      style="display: none;">
      <div class="fullscreen-content_new">
        <button
          class="fullscreen-close_new"
          onclick="closeFullscreen()"
          aria-label="Close fullscreen">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none">
            <path
              d="M18 6L6 18M6 6L18 18"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round" />
          </svg>
        </button>

        <div class="fullscreen-main-area_new">
          <img
            id="fullscreenImage_new"
            src=""
            alt=""
            width="1200"
            height="900"
            style="display: block;">
          <video
            id="fullscreenVideo_new"
            controls
            disablepictureinpicture
            controlslist="nodownload"
            preload="metadata"
            width="1200"
            height="900"
            style="display: none;">
            <source src="" type="video/mp4">
            Your browser does not support the video tag.
          </video>

          <button
            class="fullscreen-nav_new fullscreen-prev_new"
            onclick="changeFullscreenImage(-1)"
            aria-label="Previous image">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none">
              <path
                d="M15 18L9 12L15 6"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </button>

          <button
            class="fullscreen-nav_new fullscreen-next_new"
            onclick="changeFullscreenImage(1)"
            aria-label="Next image">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none">
              <path
                d="M9 18L15 12L9 6"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </button>
        </div>

        <!-- Fullscreen Thumbnails -->
        <div class="fullscreen-thumbnails_new">
          <div class="fullscreen-thumbnails-container_new" id="fullscreenThumbnailsContainer_new">
            {%- for media in product.media -%}
              <div class="fullscreen-thumb-container_new{% if media.id == product.featured_media.id %} active_new{% endif %}" onclick="changeFullscreenMediaByIndex({{ forloop.index0 }})">
                {%- if media.media_type == 'video' -%}
                  <img
                    class="fullscreen-thumb_new fullscreen-thumb-video"
                    src="{{ media.preview_image | image_url: width: 150 }}"
                    alt="{{ media.alt | escape }}"
                    width="150"
                    height="113"
                    data-video-src="{{ media.sources[0].url }}">
                  <div class="fullscreen-video-thumbnail-overlay_new">
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg">
                      <path d="M8 5V19L19 12L8 5Z" fill="white" />
                    </svg>
                  </div>
                {%- else -%}
                  <img
                    class="fullscreen-thumb_new"
                    src="{{ media | image_url: width: 150 }}"
                    alt="{{ media.alt | escape }}"
                    width="150"
                    height="113"
                    data-fullsize="{{ media | image_url: width: 1200 }}">
                {%- endif -%}
              </div>
            {%- endfor -%}
          </div>
        </div>
      </div>
    </div>

    <!-- Thumbnails -->
    <div class="thumbnails-container_new">
      <div class="thumbnails-scroll_new">
        <div class="thumbnails_new">
          {%- for media in product.media -%}
            <div class="thumbnail-container_new{% if media.id == product.featured_media.id %} active_new{% endif %}" onclick="changeMainMedia({{ forloop.index0 }}, this)">
              {%- if media.media_type == 'video' -%}
                <img
                  class="thumbnail_new thumbnail-video"
                  src="{{ media.preview_image | image_url: width: 150 }}"
                  alt="{{ media.alt | escape }}"
                  width="150"
                  height="113"
                  loading="lazy"
                  data-video-src="{{ media.sources[0].url }}">
                <div class="video-thumbnail-overlay_new">
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 5V19L19 12L8 5Z" fill="white" />
                  </svg>
                </div>
              {%- else -%}
                <img
                  class="thumbnail_new"
                  src="{{ media | image_url: width: 150 }}"
                  alt="{{ media.alt | escape }}"
                  width="150"
                  height="113"
                  loading="lazy">
              {%- endif -%}
            </div>
          {%- endfor -%}
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Gallery JavaScript will be injected by main section
</script>