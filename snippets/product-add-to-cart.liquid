{% comment %} 
                      Product Add to Cart Component
                       
                      Renders variant selector, add to cart button, and Shopify native helpers:
                      - Dynamic checkout buttons (Shop Pay, Apple Pay, Google Pay)
                      - Payment terms (Shop Pay Installments)
                       
                      Accepts: 
                      - product: {Object} Product object 
                      - section: {Object} Section object for settings
                       
                      Usage:
                      {% render 'product-add-to-cart', product: product, section: section %} 
{% endcomment %}

{%- assign selected_variant = product.selected_or_first_available_variant -%}
{%- assign product_form_id = 'product-form-' | append: section.id -%}
{%- assign payment_options_block = section.blocks | where: 'type', 'payment_options' | first -%}

  {%- form 'product'
    , product
    , id: product_form_id
    , class: 'product-form_new' -%}
  <!-- Hidden variant input (updated dynamically) -->
  <input
    type="hidden"
    name="id"
    value="{{ selected_variant.id }}"
    id="product-variant-id-{{ section.id }}">

  <!-- Variant Selector (if product has multiple variants) -->
  {%- if product.variants.size > 1 and section.settings.show_variant_selector -%}
    <div class="variant-selector-wrapper_new">
      <label for="variant-selector_new">{{ section.settings.variant_label | default: "Select Option" }}</label>
      <select
        id="variant-selector_new"
        class="variant-selector_new"
        name="id"
        onchange="updateVariant()">
        {%- for variant in product.variants -%}
          <option
            value="{{ variant.id }}"
            {% if variant == selected_variant %}
            selected{% endif %}
            {% unless variant.available %}
            disabled{% endunless %}>
            {{ variant.title }}
            {%- unless variant.available %}
              - Sold Out{% endunless -%}
          </option>
        {%- endfor -%}
      </select>
    </div>
  {%- endif -%}

  <!-- Add to Cart Button - First -->
  {%- if selected_variant.available -%}

    <!-- Payment Terms (Shop Pay Installments) - Second -->
    {%- if payment_options_block and payment_options_block.settings.show_payment_terms -%}
      <div class="payment-options-form">
        {{ form | payment_terms }}
      </div>
    {%- endif -%}

    <button
      type="submit"
      name="add"
      class="add-to-cart-btn_new"
      aria-label="{{ section.settings.add_to_cart_text | default: 'Add to cart' }}">
      {{ section.settings.add_to_cart_text | default: 'Add to Cart' }}
    </button>


    <!-- Dynamic Checkout Buttons (Shop Pay, Apple Pay, Google Pay) - Third -->
    {%- if payment_options_block and payment_options_block.settings.show_dynamic_checkout -%}
      <div id="dynamic-checkout-{{ section.id }}">
        {{ form | payment_button }}
      </div>
    {%- endif -%}
  {%- else -%}
    <button
      type="button"
      class="add-to-cart-btn_new"
      disabled
      aria-label="Sold out">
      Sold Out
    </button>
  {%- endif -%}
{%- endform -%}

<!-- Payment Icons (Accepted Payment Methods) - Shown if enabled -->
{%- if payment_options_block and payment_options_block.settings.show_payment_icons -%}
  <div class="payment-icons_new">
    <img
      src="https://www.ativafit.com/cdn/shop/files/bank_e49b0ef7-0b7d-46e6-b59d-f28b627ed7a3_1024x1024.png?v=1707126791"
      alt="Accepted payment methods"
      class="payment-icons__static-image_new"
      width="1024"
      height="1024"
      loading="lazy">
  </div>
{%- endif -%}

<!-- Payment Text (if enabled) -->
{%- if payment_options_block and payment_options_block.settings.payment_text != blank -%}
  <div class="payment-text_new">
    {{ payment_options_block.settings.payment_text }}
  </div>
{%- endif -%}

<!-- AtivaPeople CTA (if enabled) -->
{%- if section.settings.show_ativapeople_cta -%}
  <p class="ativapeople-cta_new">
    {{ section.settings.ativapeople_cta_text }}
  </p>
{%- endif -%}