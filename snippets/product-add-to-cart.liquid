{% comment %} 
  Product Add to Cart Component
   
  Renders variant selector, quantity selector, and add to cart buttons.
   
  Accepts: 
  - product: {Object} Product object 
  - section: {Object} Section object for settings
   
  Usage:
  {% render 'product-add-to-cart', product: product, section: section %} 
{% endcomment %}

<!-- Variant Selector (if product has multiple variants) -->
{%- if product.variants.size > 1 and section.settings.show_variant_selector -%}
  <div class="variant-selector-wrapper_new">
    <label for="variant-selector_new">{{ section.settings.variant_label | default: "Select Option" }}</label>
    <select
      id="variant-selector_new"
      class="variant-selector_new"
      onchange="updateVariant()">
      {%- for variant in product.variants -%}
        <option
          value="{{ variant.id }}"
          {% if variant == product.selected_or_first_available_variant %}
          selected{% endif %}
          {% unless variant.available %}
          disabled{% endunless %}>
          {{ variant.title }}
          {%- unless variant.available %}
            - Sold Out{% endunless -%}
        </option>
      {%- endfor -%}
    </select>
  </div>
{%- endif -%}

<!-- Quantity Selector -->
{%- if section.settings.show_quantity_selector -%}
  <div class="quantity-wrapper_new">
    <label for="quantity_new" class="quantity-label_new">{{ section.settings.quantity_label | default: "Quantity" }}</label>
    <div class="quantity-selector_new">
      <button
        type="button"
        class="quantity-btn_new quantity-decrease_new"
        onclick="updateQuantity(-1)"
        aria-label="Decrease quantity">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2">
          <line
            x1="5"
            y1="12"
            x2="19"
            y2="12"></line>
        </svg>
      </button>
      <input
        type="number"
        id="quantity_new"
        name="quantity"
        value="1"
        min="1"
        class="quantity-input_new"
        onchange="validateQuantity()"
        aria-label="Quantity">
      <button
        type="button"
        class="quantity-btn_new quantity-increase_new"
        onclick="updateQuantity(1)"
        aria-label="Increase quantity">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2">
          <line
            x1="12"
            y1="5"
            x2="12"
            y2="19"></line>
          <line
            x1="5"
            y1="12"
            x2="19"
            y2="12"></line>
        </svg>
      </button>
    </div>
  </div>
{%- endif -%}

<!-- Add to Cart Button -->
<button
  type="button"
  class="add-to-cart-btn_new"
  onclick="addToCart()"
  aria-label="{{ section.settings.add_to_cart_text | default: 'Add to cart' }}">
  {{ section.settings.add_to_cart_text | default: 'Add to Cart' }}
</button>

<!-- Buy It Now Button (if enabled) -->
{%- if section.settings.show_buy_it_now -%}
  <form
    action="{{ routes.cart_add_url }}"
    method="post"
    enctype="multipart/form-data"
    id="buy-it-now-form">
    <input
      type="hidden"
      name="id"
      id="buy-it-now-variant-id"
      value="{{ product.selected_or_first_available_variant.id }}">
    <input
      type="hidden"
      name="quantity"
      value="1">
    <button
      type="submit"
      name="checkout"
      class="buy-it-now-btn_new"
      aria-label="{{ section.settings.buy_it_now_text | default: 'Buy it now' }}">
      {{ section.settings.buy_it_now_text | default: 'Buy It Now' }}
    </button>
  </form>
{%- endif -%}

<!-- AtivaPeople CTA (if enabled) -->
{%- if section.settings.show_ativapeople_cta -%}
  <p class="ativapeople-cta_new">
    {{ section.settings.ativapeople_cta_text }}
  </p>
{%- endif -%}

<script>
  // Quantity functions
  function updateQuantity(change) {
    const quantityInput = document.getElementById('quantity_new');
    let currentQuantity = parseInt(quantityInput.value) || 1;
    let newQuantity = currentQuantity + change;
    
    if (newQuantity < 1) newQuantity = 1;
    quantityInput.value = newQuantity;
  }
  
  function validateQuantity() {
    const quantityInput = document.getElementById('quantity_new');
    let quantity = parseInt(quantityInput.value);
    
    if (isNaN(quantity) || quantity < 1) {
      quantityInput.value = 1;
    }
  }
</script>