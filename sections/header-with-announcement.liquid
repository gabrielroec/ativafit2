{%- style -%}
  /* UNIFIED HEADER + ANNOUNCEMENT BAR COMPONENT */

  /* Container principal - INICIALMENTE RELATIVE, NÃO FIXED */.unified-header {
    position: relative;
    /* MUDANÇA: era 'fixed', agora é 'relative' */
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    background: #fff;
    transition: all 0.3s ease;
    transform: translateY(0);
    margin: 0 !important;
    padding: 0 !important;
    border: none !important;
    outline: none !important;
    font-size: 0 !important;
    /* Remove espaçamento de caracteres invisíveis */
    line-height: 0 !important;
    /* Remove espaçamento de linha */
  }

  /* Reset para elementos filhos */
  .unified-header * {
    font-size: initial !important;
    line-height: initial !important;
  }

  /* QUANDO STICKY - então vira fixed com transições suaves */
  .unified-header.sticky {
    position: fixed;
    top: 0;
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
    transform: translateY(0);
  }

  /* ANNOUNCEMENT BAR SECTION */
  .announcement-section {
    background: #000000;
    border-bottom: 1px solid #333;
    transition: all 0.3s ease;
  }

  .unified-header.sticky .announcement-section {
    background: rgba(0, 0, 0, 0.95);
    padding: 4px 0;
    /* Reduz o padding vertical quando sticky */
    border-bottom-color: rgba(51, 51, 51, 0.7);
  }

  .announcement-bar {
    position: relative;
  }

  .announcement-bar__inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-height: 44px;
    padding: 8px 0;
  }

  .announcement-bar__ticker {
    flex: 1;
    overflow: hidden;
    position: relative;
  }

  .announcement-bar__ticker-content {
    display: flex;
    animation: scroll-text 20s linear infinite;
  }

  .announcement-bar__text {
    font-size: 14px;
    font-weight: 500 !important;
    color: #ffffff;
    text-decoration: none;
    white-space: nowrap;
    padding-right: 100px;
    display: inline-block;
    transition: color 0.3s ease;
  }

  .announcement-bar__text:hover {
    color: #eb701f;
    transform: translateY(-1px);
  }

  @keyframes scroll-text {
    0% {
      transform: translateX(100%);
    }
    100% {
      transform: translateX(-100%);
    }
  }

  /* Static announcement bar */
  .announcement-bar--static .announcement-bar__ticker {
    overflow: visible;
  }

  .announcement-bar--static .announcement-bar__ticker-content {
    animation: none;
    justify-content: center;
  }

  .announcement-bar--static .announcement-bar__text {
    padding-right: 0;
  }

  .announcement-bar__static {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
  }

  .announcement-bar__text--static {
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: calc(100% - 200px);
    font-size: 14px;
    font-weight: 500 !important;
    color: #ffffff;
    text-decoration: none;
  }

  .announcement-bar__text--static:hover {
    color: #eb701f;
  }

  @media screen and (max-width: 768px) {
    .announcement-bar__text--static {
      max-width: 100%;
      white-space: normal;
      text-overflow: unset;
      overflow: visible;
      line-height: 1.4;
    }
  }

  .announcement-bar__button {
    background: #eb701f;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .announcement-bar__button:hover {
    background: #d65a0f;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(235, 112, 31, 0.3);
  }

  /* HEADER SECTION */
  .header-section {
    background: #fff;
    border-bottom: 1px solid #cdcdcd;
    padding: 20px;
    transition: all 0.3s ease;
  }

  .unified-header.sticky .header-section {
    background: rgba(255, 255, 255, 0.95);
    padding: 12px 20px;
    /* Reduz o padding vertical quando sticky */
    border-bottom-color: rgba(205, 205, 205, 0.5);
  }

  .header-container {
    max-width: 1750px;
    margin: 0 auto;
  }

  .header-navigation-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s ease;
  }

  .unified-header.sticky .header-navigation-section {
    gap: 20px;
    /* Reduz o gap quando sticky */
    margin-top: 5px;
    /* Reduz o margin quando sticky */
  }

  .header-logo-section {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 0;
    gap: 30px;
    transition: all 0.3s ease;
  }

  .unified-header.sticky .header-logo-section {
    gap: 20px;
    /* Reduz o gap quando sticky */
  }

  .header-logo {
    max-width: {{ section.settings.logo_max_width }}px;
    transition: all 0.3s ease;
  }

  .unified-header.sticky .header-logo {
    max-width: calc({{ section.settings.logo_max_width }}px * 0.85);
    /* Reduz um pouco mais o logo */
  }

  .header-logo img {
    width: 100%;
    height: auto;
    display: block;
    transition: all 0.3s ease;
  }

  .header-navigation {
    display: flex;
    gap: 30px;
    margin-top: 11px;
    transition: all 0.3s ease;
  }

  .unified-header.sticky .header-navigation {
    gap: 20px;
    /* Reduz o gap quando sticky */
    margin-top: 5px;
    /* Reduz o margin quando sticky */
  }

  .header-navigation__item {
    position: relative;
  }

  .header-navigation__link {
    color: #222021;
    text-decoration: none;
    font-size: 16px;
    font-weight: 600;
    text-transform: capitalize;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 5px;
    position: relative;
  }

  .header-navigation__link::after {
    content: '';
    position: absolute;
    bottom: -5px;
    left: 0;
    width: 0;
    height: 2px;
    background: linear-gradient(90deg, #eb7122, #ff8c42);
    transition: width 0.3s ease;
  }

  .header-navigation__link:hover::after {
    width: 100%;
  }

  .header-navigation__link:hover {
    color: #eb7122;
    transform: translateY(-1px);
  }

  .header-navigation__dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    background: #fff;
    min-width: 500px;
    padding: 15px 0;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    z-index: 10;
    transition: all 0.3s ease;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
  }

  .header-navigation__item:hover .header-navigation__dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .header-navigation__dropdown-link {
    color: #000;
    text-decoration: none;
    font-size: 14px;
    padding: 8px 25px;
    display: flex;
    gap: 10px;
    align-items: center;
    transition: all 0.3s ease;
    position: relative;
  }

  .header-navigation__dropdown-link::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    width: 0;
    height: 100%;
    background: linear-gradient(90deg, #eb7122, #ff8c42);
    transition: width 0.3s ease;
    z-index: -1;
  }

  .header-navigation__dropdown-link:hover::before {
    width: 100%;
  }

  .header-navigation__dropdown-link:hover {
    color: #ffffff;
  }

  .header-navigation__dropdown-item {
    position: relative;
  }

  .header-navigation__sub-dropdown {
    position: absolute;
    left: 100%;
    top: 0;
    background: #fff;
    min-width: 200px;
    padding: 15px 0;
    opacity: 0;
    visibility: hidden;
    transform: translateX(-10px);
    z-index: 15;
    box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
    border-left: 1px solid #f0f0f0;
    border-radius: 0 8px 8px 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .header-navigation__dropdown-item:hover .header-navigation__sub-dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateX(0);
  }

  .header-navigation__sub-dropdown-link {
    color: #000;
    text-decoration: none;
    font-size: 14px;
    padding: 8px 25px;
    display: block;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    transform: translateX(0);
  }

  .header-navigation__sub-dropdown-link::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    width: 0;
    height: 100%;
    background: linear-gradient(90deg, #eb7122, #ff8c42);
    transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: -1;
  }

  .header-navigation__sub-dropdown-link:hover::before {
    width: 100%;
  }

  .header-navigation__sub-dropdown-link:hover {
    color: #ffffff;
    transform: translateX(0px);
  }

  .icon-arrow-sub {
    width: 8px;
    height: 12px;
    fill: currentColor;
    margin-left: 8px;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .header-navigation__dropdown-link:hover .icon-arrow-sub {
    transform: rotate(90deg);
  }

  .header-actions {
    display: flex;
    gap: 9px;
    align-items: center;
    transition: all 0.3s ease;
  }

  .unified-header.sticky .header-actions {
    gap: 6px;
    /* Reduz o gap quando sticky */
  }

  .header-actions a {
    transition: all 0.3s ease;
    transform: scale(1);
    padding: 8px;
    border-radius: 8px;
  }


  .cart-count {
    color: #ffffff;
    background-color: #eb701f;
    position: absolute;
    top: -8px;
    right: -8px;
    font-size: 11px;
    font-family: 'Barlow'
    , sans-serif !important;
    font-weight: 600;
    width: 20px;
    height: 20px;
    display: flex !important;
    align-items: center;
    justify-content: center;
    border: 2px solid #fff;
    border-radius: 50%;
    line-height: 1;
    min-width: 20px;
    box-shadow: 0 3px 4px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    animation: cartCountPulse 2s ease-in-out infinite;
  }

  .cart-count:hover {
    transform: scale(1.1);
    background-color: #d65a0f;
    animation-play-state: paused;
  }

  /* Ajustes para números maiores no carrinho */
  .cart-count[data-count="10"],
  .cart-count[data-count="11"],
  .cart-count[data-count="12"],
  .cart-count[data-count="13"],
  .cart-count[data-count="14"],
  .cart-count[data-count="15"],
  .cart-count[data-count="16"],
  .cart-count[data-count="17"],
  .cart-count[data-count="18"],
  .cart-count[data-count="19"],
  .cart-count[data-count="20"] {
    width: 22px;
    height: 22px;
    font-size: 10px;
    top: -9px;
    right: -9px;
    display: flex !important;
    align-items: center;
    justify-content: center;
  }

  .cart-count[data-count="100"] {
    width: 24px;
    height: 24px;
    font-size: 9px;
    top: -10px;
    right: -10px;
    display: flex !important;
    align-items: center;
    justify-content: center;
  }

  /* Animação de bounce quando o número muda */
  @keyframes cartCountBounce {
    0,
    20%,
    50%,
    80%,
    100% {
      transform: translateY(0);
    }
    40% {
      transform: translateY(-3px);
    }
    60% {
      transform: translateY(-2px);
    }
  }

  @keyframes cartCountPulse {
    0,
    100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.1);
    }
  }

  .header-cart {
    position: relative;
    display: inline-block;
  }

  .header-cart .cart-icon {
    position: relative;
    display: inline-block;
  }

  .icon-arrow {
    width: 12px;
    height: 12px;
    fill: currentColor;
    transition: transform 0.3s ease;
  }

  .header-navigation__link:hover .icon-arrow {
    transform: rotate(180deg);
  }

  /* MOBILE MENU */
  .header-mobile-menu-icon {
    display: none;
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #222021;
    padding: 5px;
    transition: all 0.3s ease;
  }

  .header-mobile-menu-icon:hover {
    color: #eb7122;
    transform: scale(1.1);
  }

  .header-mobile-menu-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
  }

  .header-mobile-menu-backdrop.open {
    opacity: 1;
    visibility: visible;
  }

  .header-mobile-menu {
    position: fixed;
    top: 0;
    left: -100%;
    width: 100%;
    /* MUDANÇA: era 80%, agora é 100% */
    max-width: 100%;
    /* MUDANÇA: era 300px, agora é 100% */
    height: 100vh;
    /* MUDANÇA: era 100%, agora é 100vh para garantir altura total */
    background: #fff;
    z-index: 1001;
    transition: left 0.3s ease;
    padding: 20px;
    overflow-y: auto;
    box-shadow: 4px 0 25px rgba(0, 0, 0, 0.15);
  }

  .header-mobile-menu.open {
    left: 0;
  }

  .header-mobile-menu-close {
    position: absolute;
    top: 20px;
    right: 20px;
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #222021;
    transition: all 0.3s ease;
  }

  .header-mobile-menu-close:hover {
    color: #eb7122;
    transform: scale(1.1);
  }

  .header-mobile-menu-nav {
    margin-top: 60px;
    display: flex;
    flex-direction: column;
    gap: 0;
    /* MUDANÇA: era 20px, agora é 0 para melhor organização */
  }

  .header-mobile-menu-item {
    border-bottom: 1px solid #eee;
  }

  .header-mobile-menu-link {
    color: #222021;
    text-decoration: none;
    font-size: 18px;
    font-weight: 600;
    padding: 15px 0;
    /* MUDANÇA: era 10px, agora é 15px para melhor toque */
    transition: all 0.3s ease;
    position: relative;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
  }

  .header-mobile-menu-link::before {
    content: '';
    position: absolute;
    left: 0;
    bottom: 0;
    width: 0;
    height: 2px;
    background: linear-gradient(90deg, #eb7122, #ff8c42);
    transition: width 0.3s ease;
  }

  .header-mobile-menu-link:hover::before {
    width: 100%;
  }

  .header-mobile-menu-link:hover {
    color: #eb7122;
    transform: translateX(5px);
  }

  /* NOVO: Submenu mobile */
  .header-mobile-submenu {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
    background: #f8f8f8;
    margin: 0 -20px;
    padding: 0 20px;
  }

  .header-mobile-submenu.open {
    max-height: 500px;
    /* Altura suficiente para o submenu */
  }

  .header-mobile-submenu-link {
    color: #666;
    text-decoration: none;
    font-size: 16px;
    font-weight: 500 !important;
    padding: 12px 20px;
    display: block;
    border-bottom: 1px solid #eee;
    transition: all 0.3s ease;
    position: relative;
  }

  .header-mobile-submenu-link::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    width: 0;
    height: 100%;
    background: linear-gradient(90deg, #eb7122, #ff8c42);
    transition: width 0.3s ease;
    z-index: -1;
  }

  .header-mobile-submenu-link:hover::before {
    width: 100%;
  }

  .header-mobile-submenu-link:hover {
    color: #ffffff;
    transform: translateX(10px);
  }

  /* NOVO: Submenu de segundo nível no mobile */
  .header-mobile-submenu-item {
    position: relative;
  }

  .header-mobile-submenu-level2 {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
    background: #f0f0f0;
    margin: 0 -20px;
    padding: 0 20px;
  }

  .header-mobile-submenu-item.open .header-mobile-submenu-level2 {
    max-height: 300px;
  }

  .header-mobile-submenu-link-level2 {
    color: #888;
    text-decoration: none;
    font-size: 14px;
    font-weight: 400 !important;
    padding: 10px 20px;
    display: block;
    border-bottom: 1px solid #ddd;
    transition: all 0.3s ease;
    position: relative;
  }

  .header-mobile-submenu-link-level2::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    width: 0;
    height: 100%;
    background: linear-gradient(90deg, #eb7122, #ff8c42);
    transition: width 0.3s ease;
    z-index: -1;
  }

  .header-mobile-submenu-link-level2:hover::before {
    width: 100%;
  }

  .header-mobile-submenu-link-level2:hover {
    color: #ffffff;
    transform: translateX(15px);
  }

  /* NOVO: Ícone de seta para submenus */
  .mobile-menu-arrow {
    width: 16px;
    height: 16px;
    fill: currentColor;
    transition: transform 0.3s ease;
  }

  .header-mobile-menu-item.has-submenu .mobile-menu-arrow {
    transform: rotate(0deg);
  }

  .header-mobile-menu-item.has-submenu.open .mobile-menu-arrow {
    transform: rotate(180deg);
  }

  /* RESPONSIVE */
  @media (max-width: 768px) {
    .header-navigation {
      display: none;
    }

    .header-mobile-menu-icon {
      display: block;
    }

    .header-logo-section {
      gap: 15px;
    }

    .header-section {
      padding: 15px;
    }

    .announcement-bar__button {
      display: none;
    }
  }

  /* SPACER - INICIALMENTE 0, só cresce quando sticky */
  .unified-header-spacer {
    height: 0;
    transition: height 0.3s ease;
    overflow: hidden;
  }

  /* QUANDO STICKY - spacer cresce para compensar */
  .unified-header.sticky + .unified-header-spacer {
    height: var(--unified-header-height, 0px);
  }

  /* Indicador visual sutil para mostrar que o header está sticky */
  .unified-header.sticky::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #eb701f, #ff8c42);
    background-size: 200% 100%;
    animation: stickyIndicator 2s ease-in-out infinite;
  }

  @keyframes stickyIndicator {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }

  /* PROGRESS BAR - Substitui a barrinha laranja */
  .unified-header.sticky::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: var(--scroll-progress, 0%);
    /* Usa a variável CSS para largura dinâmica */
    height: 3px;
    background: linear-gradient(90deg, #eb701f, #ff8c42);
    transition: width 0.1s ease;
    z-index: 101;
  }

  /* Remove a animação antiga */


  /*

   @keyframes stickyIndicator {
   0% {
   background-position: 200% 0;
   }
   100% {
   background-position: -200% 0;
   }
   }
*/

  /* Efeito de hover nos elementos do header quando sticky */
  .unified-header.sticky .header-navigation__link:hover {
    transform: translateY(-2px);
  }

  .unified-header.sticky .header-actions a:hover {
    transform: scale(1.15);
    background: rgba(235, 112, 31, 0.15);
  }

  /* Search Overlay Styles */
  .header-search-wrapper {
    position: relative;
  }

  .header-search-toggle {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform: scale(1);
  }

  .header-search-toggle:hover {
    transform: scale(1.1);
  }

  .header-search-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    height: 100vh;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: auto;
    /* Permite scroll interno do overlay */
    -webkit-overflow-scrolling: touch;
    /* Smooth scroll no iOS */
  }

  .header-search-overlay.show {
    opacity: 1;
    visibility: visible;
  }

  /* Adiciona padding para prevenir scroll */
  body.search-overlay-open {
    overflow: hidden !important;
    position: fixed;
    width: 100%;
  }

  html.search-overlay-open {
    overflow: hidden !important;
  }

  .header-search-overlay__backdrop {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
  }

  .header-search-overlay__content {
    position: relative;
    background: #fff;
    margin: 60px auto 0;
    max-width: 1120px;
    border-radius: 16px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    transform: translateY(-20px);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .header-search-overlay.show .header-search-overlay__content {
    transform: translateY(0);
  }

  .header-search-overlay__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 24px 24px 0;
  }

  .header-search-overlay__header h2 {
    font-size: 20px;
    font-weight: 600;
    color: #111827;
    margin: 0;
  }

  .header-search-overlay__close {
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
    color: #6b7280;
    border-radius: 8px;
    transition: all 0.2s ease;
  }

  .header-search-overlay__close:hover {
    background: #f3f4f6;
    color: #111827;
  }

  .header-search-overlay__body {
    padding: 24px;
  }

  /* Mobile adjustments for search overlay */
  @media screen and (max-width: 768px) {
    .header-search-overlay__content {
      margin: 20px;
      max-width: none;
      border-radius: 12px;
    }

    .header-search-overlay__header {
      padding: 20px 20px 0;
    }

    .header-search-overlay__header h2 {
      font-size: 18px;
    }

    .header-search-overlay__body {
      padding: 20px;
    }
  }

{%- endstyle -%}

<!-- Spacer para compensar o espaço do header quando sticky -->
<div class="unified-header-spacer" id="unified-header-spacer"></div>

<!-- Componente Unificado Header + Announcement -->
<div class="unified-header" id="unified-header">

  <!-- ANNOUNCEMENT BAR SECTION -->
  {%- if section.settings.show_announcement -%}
    <div class="announcement-section">
      <div class="container">
        <div class="announcement-bar{% unless section.settings.enable_ticker %} announcement-bar--static{% endunless %}">
          <div class="announcement-bar__inner">
            {%- if section.settings.enable_ticker -%}
              <div class="announcement-bar__ticker">
                <div class="announcement-bar__ticker-content">
                  {%- if section.settings.announcement_link != blank -%}
                    <a href="{{ section.settings.announcement_link }}" class="announcement-bar__text">{{ section.settings.announcement_text | escape }}</a>
                  {%- else -%}
                    <span class="announcement-bar__text">{{ section.settings.announcement_text | escape }}</span>
                  {%- endif -%}
                  {%- if section.settings.announcement_link != blank -%}
                    <a href="{{ section.settings.announcement_link }}" class="announcement-bar__text">{{ section.settings.announcement_text | escape }}</a>
                  {%- else -%}
                    <span class="announcement-bar__text">{{ section.settings.announcement_text | escape }}</span>
                  {%- endif -%}
                </div>
              </div>
            {%- else -%}
              <div class="announcement-bar__static">
                {%- if section.settings.announcement_link != blank -%}
                  <a href="{{ section.settings.announcement_link }}" class="announcement-bar__text announcement-bar__text--static">{{ section.settings.announcement_text | escape }}</a>
                {%- else -%}
                  <span class="announcement-bar__text announcement-bar__text--static">{{ section.settings.announcement_text | escape }}</span>
                {%- endif -%}
              </div>
            {%- endif -%}

            {%- if section.settings.show_newsletter -%}
              <button
                type="button"
                class="announcement-bar__button hidden-phone"
                data-action="toggle-newsletter"
                aria-expanded="false">
                {%- render 'icon'
                  , icon: 'newsletter' -%}
                {{ section.settings.newsletter_button | escape }}
              </button>
            {%- endif -%}
          </div>
        </div>
      </div>
    </div>
  {%- endif -%}

  <!-- HEADER SECTION -->
  <div class="header-section">
    <div class="header-container">
      <div class="header-navigation-section">

        <!-- Mobile Menu Icon -->
        <button
          class="header-mobile-menu-icon"
          id="header-mobile-menu-open"
          aria-label="Open menu">
          &#9776;
        </button>

        <div class="header-logo-section">
          <!-- Logo -->
          <a href="{{ routes.root_url }}" class="header-logo">
            {% if section.settings.logo != blank %}
              {%- assign logo_alt = section.settings.logo.alt | default: shop.name | escape -%}
              {%- assign logo_height = section.settings.logo.height -%}
              {%- assign logo_width = section.settings.logo.width -%}
              {{ section.settings.logo | image_url: width: 300 | image_tag: class: 'header-logo-image', alt: logo_alt, width: logo_width, height: logo_height, loading: 'lazy' }}
            {% else %}
              <img
                class="header-logo-image"
                src="{{ 'logo-black.png' | asset_url }}"
                alt="{{ shop.name | escape }}"
                width="120"
                height="120"
                loading="lazy">
            {% endif %}
          </a>

          <!-- Desktop Navigation -->
          <nav class="header-navigation">
            {%- assign navigation_menu_handle = section.settings.navigation_menu | default: 'main-menu-new-0411' -%}
            {%- assign navigation_menu = linklists[navigation_menu_handle] -%}

            {%- for link in navigation_menu.links -%}
              <div class="header-navigation__item">
                <a
                  href="{{ link.url }}"
                  class="header-navigation__link"
                  {% if link.links.size > 0 %}
                  aria-expanded="false"
                  aria-haspopup="true"
                  {% endif %}>
                  {{ link.title }}
                  {%- if link.links.size > 0 -%}
                    <svg class="icon-arrow" viewBox="0 0 12 8">
                      <path
                        d="M1 1l5 5 5-5"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2" />
                    </svg>
                  {%- endif -%}
                </a>

                {%- if link.links.size > 0 -%}
                  <div class="header-navigation__dropdown">
                    {%- for childlink in link.links -%}
                      <div class="header-navigation__dropdown-item">
                        <a href="{{ childlink.url }}" class="header-navigation__dropdown-link">
                          {{ childlink.title }}
                          {%- if childlink.links.size > 0 -%}
                            <svg class="icon-arrow-sub" viewBox="0 0 8 12">
                              <path
                                d="M1 1l3 5 3-5"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2" />
                            </svg>
                          {%- endif -%}
                        </a>
                        {%- if childlink.links.size > 0 -%}
                          <div class="header-navigation__sub-dropdown">
                            {%- for subchildlink in childlink.links -%}
                              <a href="{{ subchildlink.url }}" class="header-navigation__sub-dropdown-link">{{ subchildlink.title }}</a>
                            {%- endfor -%}
                          </div>
                        {%- endif -%}
                      </div>
                    {%- endfor -%}
                  </div>
                {%- endif -%}
              </div>
            {%- endfor -%}
          </nav>
        </div>

        <!-- Header Actions -->
        <div class="header-actions">
          <div class="header-search-wrapper">
            <button
              class="header-search-toggle"
              id="header-search-toggle"
              aria-label="Open search">
              <svg
                width="32"
                height="32"
                viewBox="0 0 32 32"
                fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <rect
                  width="32"
                  height="32"
                  rx="16"
                  fill="#EB701F" />
                <path d="M24.7264 23.3951L20.2891 18.9395C21.4304 17.6322 22.0559 15.9773 22.0551 14.2675C22.0551 10.2603 18.6782 7 14.5275 7C10.3769 7 7 10.2603 7 14.2675C7 18.2747 10.3769 21.535 14.5275 21.535C16.0857 21.535 17.5706 21.0812 18.8402 20.2199L23.3112 24.7093C23.4981 24.8967 23.7494 25 24.0188 25C24.2738 25 24.5156 24.9062 24.6992 24.7355C24.8866 24.5611 24.9947 24.322 24.9998 24.0708C25.0049 23.8195 24.9066 23.5765 24.7264 23.3951ZM14.5275 8.89587C17.5955 8.89587 20.0914 11.3055 20.0914 14.2675C20.0914 17.2295 17.5955 19.6391 14.5275 19.6391C11.4596 19.6391 8.96371 17.2295 8.96371 14.2675C8.96371 11.3055 11.4596 8.89587 14.5275 8.89587Z" fill="white" />
              </svg>
            </button>

            <!-- Search Overlay -->
            <div class="header-search-overlay" id="header-search-overlay">
              <div class="header-search-overlay__backdrop"></div>
              <div class="header-search-overlay__content">
                <div class="header-search-overlay__header">
                  <h2>Search Products</h2>
                  <button
                    class="header-search-overlay__close"
                    id="header-search-overlay-close"
                    aria-label="Close search">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none">
                      <path
                        d="M18 6L6 18M6 6L18 18"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round" />
                    </svg>
                  </button>
                </div>
                <div class="header-search-overlay__body">
                  {% render 'search-autocomplete' %}
                </div>
              </div>
            </div>
          </div>
          <a href="{{ routes.account_url }}" class="header-account">
            <svg
              width="32"
              height="32"
              viewBox="0 0 32 32"
              fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <rect
                width="32"
                height="32"
                rx="16"
                fill="#EB701F" />
              <g clip-path="url(#clip0_403_69)">
                <path d="M15.9837 16.4778C14.0653 16.5848 12.2634 17.4489 10.9608 18.8864C9.65818 20.3238 8.95739 22.2216 9.00725 24.1765C8.9923 24.2782 8.99907 24.3819 9.0271 24.4807C9.05514 24.5795 9.10378 24.6709 9.1697 24.7488C9.23562 24.8267 9.31728 24.8892 9.40909 24.932C9.50091 24.9749 9.60072 24.9971 9.70172 24.9971C9.80273 24.9971 9.90254 24.9749 9.99435 24.932C10.0862 24.8892 10.1678 24.8267 10.2337 24.7488C10.2997 24.6709 10.3483 24.5795 10.3763 24.4807C10.4044 24.3819 10.4111 24.2782 10.3962 24.1765C10.342 22.5952 10.8949 21.0546 11.9379 19.8813C12.9808 18.708 14.4317 17.9943 15.9829 17.8915C17.5342 17.9943 18.9851 18.708 20.028 19.8813C21.0709 21.0546 21.6239 22.5952 21.5697 24.1765C21.5543 24.2783 21.5608 24.3823 21.5886 24.4814C21.6165 24.5804 21.665 24.6722 21.731 24.7503C21.7969 24.8285 21.8786 24.8912 21.9706 24.9343C22.0625 24.9773 22.1626 24.9995 22.2638 24.9995C22.365 24.9995 22.465 24.9773 22.557 24.9343C22.6489 24.8912 22.7307 24.8285 22.7966 24.7503C22.8625 24.6722 22.9111 24.5804 22.9389 24.4814C22.9667 24.3823 22.9732 24.2783 22.9579 24.1765C23.0078 22.2218 22.3072 20.3243 21.0049 18.8868C19.7025 17.4494 17.9018 16.5852 15.9837 16.4778Z" fill="white" />
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M18.9081 14.2525C18.5258 14.6479 18.0706 14.9628 17.5687 15.1791C17.0668 15.3954 16.5279 15.509 15.9828 15.5133C14.8825 15.5043 13.8308 15.0509 13.0589 14.2527C12.287 13.4545 11.8582 12.377 11.8668 11.257C11.8625 10.7023 11.9655 10.1522 12.17 9.63807C12.3745 9.12393 12.6766 8.65584 13.0589 8.26052C13.4412 7.86521 13.8962 7.55042 14.398 7.33414C14.8999 7.11786 15.4386 7.00432 15.9836 7C16.5285 7.00432 17.0673 7.11786 17.5691 7.33414C18.0709 7.55042 18.526 7.86521 18.9083 8.26052C19.2906 8.65584 19.5926 9.12393 19.7971 9.63807C20.0017 10.1522 20.1047 10.7023 20.1003 11.257C20.1088 12.3769 19.68 13.4544 18.9081 14.2525ZM17.9259 9.25975C17.4144 8.72652 16.7157 8.42194 15.9836 8.413C15.6209 8.41731 15.2627 8.4943 14.9293 8.63957C14.5959 8.78484 14.2938 8.99554 14.0405 9.25965C13.7871 9.52375 13.5873 9.83608 13.4525 10.1788C13.3178 10.5215 13.2507 10.8879 13.255 11.257C13.255 11.9935 13.5425 12.6998 14.0541 13.2205C14.5657 13.7413 15.2596 14.0339 15.9832 14.0339C16.7068 14.0339 17.4007 13.7413 17.9123 13.2205C18.4239 12.6998 18.7114 11.9935 18.7114 11.257C18.7157 10.8879 18.6486 10.5215 18.5138 10.1788C18.379 9.83615 18.1793 9.52384 17.9259 9.25975Z"
                  fill="white" />
              </g>
              <defs>
                <clipPath id="clip0_403_69">
                  <rect
                    width="14"
                    height="18"
                    fill="white"
                    transform="translate(9 7)" />
                </clipPath>
              </defs>
            </svg>
          </a>
          <a href="{{ routes.cart_url }}" class="header-cart cart-icon">
            <svg
              width="32"
              height="32"
              viewBox="0 0 32 32"
              fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <rect
                width="32"
                height="32"
                rx="16"
                fill="#EB701F" />
              <path
                d="M12.5 22.1579C12.2033 22.1579 11.9133 22.2412 11.6666 22.3974C11.42 22.5535 11.2277 22.7755 11.1142 23.0351C11.0006 23.2948 10.9709 23.5805 11.0288 23.8562C11.0867 24.1318 11.2296 24.385 11.4393 24.5838C11.6491 24.7825 11.9164 24.9179 12.2074 24.9727C12.4983 25.0275 12.7999 24.9994 13.074 24.8918C13.3481 24.7843 13.5824 24.6021 13.7472 24.3684C13.912 24.1348 14 23.86 14 23.5789C14 23.2021 13.842 22.8406 13.5607 22.5741C13.2794 22.3076 12.8978 22.1579 12.5 22.1579ZM23 19.3158H11C10.7348 19.3158 10.4804 19.216 10.2929 19.0383C10.1054 18.8606 10 18.6197 10 18.3684C10 18.1172 10.1054 17.8762 10.2929 17.6985C10.4804 17.5209 10.7348 17.4211 11 17.4211H19.4912C20.1426 17.4191 20.7758 17.2171 21.2959 16.8455C21.816 16.4739 22.195 15.9526 22.376 15.3598L23.9614 10.1025C24.004 9.96154 24.0114 9.81312 23.9831 9.66895C23.9548 9.52478 23.8915 9.3888 23.7983 9.27172C23.7051 9.15464 23.5845 9.05966 23.446 8.99424C23.3075 8.92882 23.1548 8.89476 23 8.89474H10.7391C10.5321 8.34276 10.1504 7.86467 9.64622 7.52561C9.14201 7.18655 8.53971 7.00301 7.92139 7H7C6.73478 7 6.48043 7.09981 6.29289 7.27748C6.10536 7.45514 6 7.69611 6 7.94737C6 8.19863 6.10536 8.43959 6.29289 8.61726C6.48043 8.79492 6.73478 8.89474 7 8.89474H7.92139C8.13847 8.89546 8.34947 8.96277 8.52279 9.08661C8.6961 9.21044 8.82242 9.38413 8.88281 9.58167L9.03833 10.0977L9.03857 10.1025L10.6792 15.5425C9.91576 15.6203 9.21287 15.9725 8.71527 16.5265C8.21766 17.0805 7.96321 17.7942 8.00433 18.5205C8.04544 19.2469 8.37898 19.9307 8.93626 20.4312C9.49355 20.9316 10.2322 21.2105 11 21.2105H23C23.2652 21.2105 23.5196 21.1107 23.7071 20.933C23.8946 20.7554 24 20.5144 24 20.2632C24 20.0119 23.8946 19.7709 23.7071 19.5933C23.5196 19.4156 23.2652 19.3158 23 19.3158ZM21.6743 10.7895L20.4531 14.8389C20.3928 15.0366 20.2664 15.2105 20.093 15.3344C19.9196 15.4583 19.7084 15.5257 19.4912 15.5263H12.7544L12.4995 14.6811L11.3264 10.7895H21.6743ZM20.5 22.1579C20.2033 22.1579 19.9133 22.2412 19.6666 22.3974C19.42 22.5535 19.2277 22.7755 19.1142 23.0351C19.0006 23.2948 18.9709 23.5805 19.0288 23.8562C19.0867 24.1318 19.2296 24.385 19.4393 24.5838C19.6491 24.7825 19.9164 24.9179 20.2074 24.9727C20.4983 25.0275 20.7999 24.9994 21.074 24.8918C21.3481 24.7843 21.5824 24.6021 21.7472 24.3684C21.912 24.1348 22 23.86 22 23.5789C22 23.2021 21.842 22.8406 21.5607 22.5741C21.2794 22.3076 20.8978 22.1579 20.5 22.1579Z"
                fill="white"
                stroke="#EB701F"
                stroke-width="0.5" />
            </svg>
            {% if cart.item_count > 0 %}
              <span class="cart-count">{{ cart.item_count }}</span>
            {% endif %}
          </a>
        </div>

      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div class="header-mobile-menu-backdrop" id="header-mobile-menu-backdrop"></div>
  <nav
    class="header-mobile-menu"
    id="header-mobile-menu"
    aria-label="Mobile menu">
    <button
      class="header-mobile-menu-close"
      id="header-mobile-menu-close"
      aria-label="Close menu">&times;</button>
    <div class="header-mobile-menu-nav">
      {%- assign navigation_menu_handle = section.settings.navigation_menu | default: 'main-menu-new-0411' -%}
      {%- assign navigation_menu = linklists[navigation_menu_handle] -%}
      {%- for link in navigation_menu.links -%}
        <div class="header-mobile-menu-item{% if link.links.size > 0 %} has-submenu{% endif %}">
          <a href="{{ link.url }}" class="header-mobile-menu-link">
            {{ link.title }}
            {%- if link.links.size > 0 -%}
              <svg class="mobile-menu-arrow" viewBox="0 0 12 8">
                <path
                  d="M1 1l5 5 5-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2" />
              </svg>
            {%- endif -%}
          </a>
          {%- if link.links.size > 0 -%}
            <div class="header-mobile-submenu">
              {%- for childlink in link.links -%}
                <div class="header-mobile-submenu-item{% if childlink.links.size > 0 %} has-submenu{% endif %}">
                  <a href="{{ childlink.url }}" class="header-mobile-submenu-link">
                    {{ childlink.title }}
                    {%- if childlink.links.size > 0 -%}
                      <svg class="mobile-menu-arrow" viewBox="0 0 12 8">
                        <path
                          d="M1 1l5 5 5-5"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2" />
                      </svg>
                    {%- endif -%}
                  </a>
                  {%- if childlink.links.size > 0 -%}
                    <div class="header-mobile-submenu-level2">
                      {%- for subchildlink in childlink.links -%}
                        <a href="{{ subchildlink.url }}" class="header-mobile-submenu-link-level2">{{ subchildlink.title }}</a>
                      {%- endfor -%}
                    </div>
                  {%- endif -%}
                </div>
              {%- endfor -%}
            </div>
          {%- endif -%}
        </div>
      {%- endfor -%}
    </div>
  </nav>

</div>

<script>
  class UnifiedHeaderManager {
    constructor() {
      this.header = document.getElementById('unified-header');
      this.spacer = document.getElementById('unified-header-spacer');
      this.lastScrollTop = 0;
      this.scrollThreshold = 100;
      this.headerHeight = 0;
      this.isSticky = false;
      
      this.init();
    }
  
    init() {
      if (!this.header) return;
  
      // Calcula altura inicial com delay para garantir que o DOM esteja pronto
      setTimeout(() => this.updateHeight(), 100);
      setTimeout(() => this.updateHeight(), 500);
  
      // Scroll handler otimizado
      let ticking = false;
      window.addEventListener('scroll', () => {
        if (!ticking) {
          requestAnimationFrame(() => {
            this.checkPosition();
            this.updateProgressBar(); // NOVO: Atualiza a progress bar
            ticking = false;
          });
          ticking = true;
        }
      }, { passive: true });
  
      // Resize handler
      window.addEventListener('resize', () => {
        this.updateHeight();
      });
  
      // Mobile menu handlers
      this.setupMobileMenu();
      
      // Initial position check
      this.checkPosition();
    }
  
    updateHeight() {
      if (!this.header || !this.spacer) return;
      
      this.headerHeight = this.header.offsetHeight;
      
      // Inicialmente o spacer deve ser 0
      if (!this.isSticky) {
        this.spacer.style.height = '0px';
      }
      
      // Set CSS custom properties for other components
      document.documentElement.style.setProperty('--unified-header-height', `${this.headerHeight}px`);
    }
  
    checkPosition() {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      
      // Evita mudanças desnecessárias
      if (Math.abs(scrollTop - this.lastScrollTop) < 5) return;
  
      if (scrollTop > this.scrollThreshold) {
        if (!this.isSticky) {
          this.makeSticky();
        }
      } else {
        if (this.isSticky) {
          this.removeSticky();
        }
      }
  
      this.lastScrollTop = scrollTop;
    }
  
    // NOVO: Atualiza a progress bar baseada no scroll
    updateProgressBar() {
      if (!this.header || !this.isSticky) return;
      
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const documentHeight = document.documentElement.scrollHeight - window.innerHeight;
      const scrollProgress = (scrollTop / documentHeight) * 100;
      
      // Atualiza a largura da progress bar
      this.header.style.setProperty('--scroll-progress', `${Math.min(scrollProgress, 100)}%`);
    }
  
    makeSticky() {
      // Adiciona classe sticky
      this.header.classList.add('sticky');
      
      // Ajusta spacer imediatamente
      this.spacer.style.height = `${this.headerHeight}px`;
      
      this.isSticky = true;
    }
  
    removeSticky() {
      // Remove classe sticky
      this.header.classList.remove('sticky');
      
      // Zera spacer imediatamente
      this.spacer.style.height = '0px';
      
      this.isSticky = false;
    }
  
    setupMobileMenu() {
      const openBtn = document.getElementById('header-mobile-menu-open');
      const closeBtn = document.getElementById('header-mobile-menu-close');
      const mobileMenu = document.getElementById('header-mobile-menu');
      const backdrop = document.getElementById('header-mobile-menu-backdrop');
  
      const openMenu = () => {
        mobileMenu.classList.add('open');
        backdrop.classList.add('open');
        document.body.style.overflow = 'hidden';
      };
  
      const closeMenu = () => {
        mobileMenu.classList.remove('open');
        backdrop.classList.remove('open');
        document.body.style.overflow = '';
        
        // Fecha todos os submenus quando fecha o menu principal
        const submenus = mobileMenu.querySelectorAll('.header-mobile-submenu');
        const menuItems = mobileMenu.querySelectorAll('.header-mobile-menu-item');
        
        submenus.forEach(submenu => submenu.classList.remove('open'));
        menuItems.forEach(item => item.classList.remove('open'));
      };
  
      if (openBtn) openBtn.addEventListener('click', openMenu);
      if (closeBtn) closeBtn.addEventListener('click', closeMenu);
      if (backdrop) backdrop.addEventListener('click', closeMenu);
      
      // NOVO: Funcionalidade dos submenus mobile
      const menuItems = mobileMenu.querySelectorAll('.header-mobile-menu-item.has-submenu');
      
      menuItems.forEach(item => {
        const link = item.querySelector('.header-mobile-menu-link');
        const submenu = item.querySelector('.header-mobile-submenu');
        
        if (link && submenu) {
          link.addEventListener('click', (e) => {
            e.preventDefault(); // Previne navegação para links com submenu
            
            // Toggle do submenu
            const isOpen = submenu.classList.contains('open');
            
            // Fecha todos os outros submenus
            menuItems.forEach(otherItem => {
              if (otherItem !== item) {
                otherItem.classList.remove('open');
                otherItem.querySelector('.header-mobile-submenu').classList.remove('open');
              }
            });
            
            // Toggle do submenu atual
            if (isOpen) {
              submenu.classList.remove('open');
              item.classList.remove('open');
            } else {
              submenu.classList.add('open');
              item.classList.add('open');
            }
          });
        }
      });
  
      // NOVO: Funcionalidade dos sub-submenus mobile
      const submenuItems = mobileMenu.querySelectorAll('.header-mobile-submenu-item.has-submenu');
      
      submenuItems.forEach(item => {
        const link = item.querySelector('.header-mobile-submenu-link');
        const submenuLevel2 = item.querySelector('.header-mobile-submenu-level2');
        
        if (link && submenuLevel2) {
          link.addEventListener('click', (e) => {
            e.preventDefault(); // Previne navegação para links com submenu
            
            // Toggle do submenu de segundo nível
            const isOpen = submenuLevel2.classList.contains('open');
            
            // Fecha todos os outros submenus de segundo nível
            submenuItems.forEach(otherItem => {
              if (otherItem !== item) {
                otherItem.classList.remove('open');
                otherItem.querySelector('.header-mobile-submenu-level2').classList.remove('open');
              }
            });
            
            // Toggle do submenu atual
            if (isOpen) {
              submenuLevel2.classList.remove('open');
              item.classList.remove('open');
            } else {
              submenuLevel2.classList.add('open');
              item.classList.add('open');
            }
          });
        }
      });
      
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeMenu();
      });
    }
  }
  
  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => new UnifiedHeaderManager());
  } else {
    new UnifiedHeaderManager();
  }
  
  // Cart Manager para melhorar UX do carrinho
  class CartManager {
    constructor() {
      this.cartCount = document.querySelector('.cart-count');
      this.cartIcon = document.querySelector('.header-cart');
      this.init();
    }
  
    init() {
      if (!this.cartCount || !this.cartIcon) return;
  
      // Atualiza o contador quando o carrinho muda
      this.updateCartCount();
      
      // Escuta mudanças no carrinho
      document.addEventListener('cart:updated', () => {
        this.updateCartCount();
      });
  
      // Adiciona efeito visual ao clicar no carrinho
      this.cartIcon.addEventListener('click', () => {
        this.addClickEffect();
      });
    }
  
    updateCartCount() {
      // Busca o contador atual do carrinho
      fetch('/cart.js')
        .then(response => response.json())
        .then(cart => {
          const count = cart.item_count || 0;
          
          if (count > 0) {
            this.cartCount.textContent = count;
            this.cartCount.style.display = 'flex';
            this.cartCount.setAttribute('data-count', count);
            
            // Adiciona animação de entrada
            this.cartCount.style.animation = 'none';
            setTimeout(() => {
              this.cartCount.style.animation = 'cartCountPulse 0.6s ease-out, cartCountBounce 0.8s ease-out';
            }, 10);
          } else {
            this.cartCount.style.display = 'none';
          }
        })
        .catch(error => {
          console.log('Erro ao atualizar contador do carrinho:', error);
        });
    }
  
    addClickEffect() {
      if (this.cartIcon) {
        this.cartIcon.style.transform = 'scale(0.95)';
        setTimeout(() => {
          this.cartIcon.style.transform = 'scale(1)';
        }, 150);
      }
    }
  }
  
  // Inicializa o Cart Manager
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => new CartManager());
  } else {
    new CartManager();
  }

  // Search Overlay Manager
  class SearchOverlayManager {
    constructor() {
      this.toggleBtn = document.getElementById('header-search-toggle');
      this.closeBtn = document.getElementById('header-search-overlay-close');
      this.overlay = document.getElementById('header-search-overlay');
      this.backdrop = this.overlay?.querySelector('.header-search-overlay__backdrop');
      this.searchInput = document.getElementById('search-autocomplete-input');
      
      this.init();
    }

    init() {
      if (!this.toggleBtn || !this.overlay) {
        console.log('SearchOverlayManager: Elements not found', {
          toggleBtn: !!this.toggleBtn,
          overlay: !!this.overlay
        });
        return;
      }

      console.log('SearchOverlayManager: Initialized successfully');

      // Open search overlay
      this.toggleBtn.addEventListener('click', (e) => {
        e.preventDefault();
        console.log('Search button clicked - opening overlay');
        this.openOverlay();
      });
      
      // Close search overlay
      this.closeBtn?.addEventListener('click', () => this.closeOverlay());
      this.backdrop?.addEventListener('click', () => this.closeOverlay());
      
      // Close on escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && this.overlay.classList.contains('show')) {
          this.closeOverlay();
        }
      });
    }

    openOverlay() {
      console.log('Opening search overlay');
      this.overlay.classList.add('show');
      
      // Bloqueia scroll do body E do html usando classe e inline style
      document.body.classList.add('search-overlay-open');
      document.documentElement.classList.add('search-overlay-open');
      document.body.style.overflow = 'hidden';
      document.documentElement.style.overflow = 'hidden';
      
      // Salva posição atual do scroll para restaurar depois
      const scrollY = window.scrollY;
      document.body.style.position = 'fixed';
      document.body.style.top = `-${scrollY}px`;
      document.body.style.width = '100%';
      
      // Focus search input after animation
      setTimeout(() => {
        if (this.searchInput) {
          this.searchInput.focus();
          console.log('Search input focused');
        }
      }, 300);
    }

    closeOverlay() {
      this.overlay.classList.remove('show');
      
      // Restaura scroll do body E do html
      document.body.classList.remove('search-overlay-open');
      document.documentElement.classList.remove('search-overlay-open');
      
      // Restaura posição do scroll
      const scrollY = document.body.style.top;
      document.body.style.position = '';
      document.body.style.top = '';
      document.body.style.width = '';
      document.body.style.overflow = '';
      document.documentElement.style.overflow = '';
      
      // Scroll de volta para onde estava
      if (scrollY) {
        window.scrollTo(0, parseInt(scrollY || '0') * -1);
      }
      
      // Clear search input
      if (this.searchInput) {
        this.searchInput.value = '';
        this.searchInput.dispatchEvent(new Event('input'));
      }
    }
  }

  // Initialize Search Overlay Manager
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      console.log('DOM loaded, initializing SearchOverlayManager');
      new SearchOverlayManager();
    });
  } else {
    console.log('DOM already loaded, initializing SearchOverlayManager immediately');
    new SearchOverlayManager();
  }

  // Emergency fallback - remove any old search links
  document.addEventListener('DOMContentLoaded', () => {
    const oldSearchLinks = document.querySelectorAll('a[href="/search"], a[href*="search"]');
    oldSearchLinks.forEach(link => {
      if (link.classList.contains('header-search')) {
        console.log('Found old search link, removing href');
        link.removeAttribute('href');
        link.style.cursor = 'pointer';
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const overlay = document.getElementById('header-search-overlay');
          if (overlay) {
            overlay.classList.add('show');
            document.body.style.overflow = 'hidden';
          }
        });
      }
    });
  });
</script>

{% schema %}
  {
    "name": "Header with Announcement",
    "settings": [
      {
        "type": "header",
        "content": "Announcement Bar"
      },
      {
        "type": "checkbox",
        "id": "show_announcement",
        "label": "Show announcement bar",
        "default": true
      },
      {
        "type": "text",
        "id": "announcement_text",
        "label": "Announcement text",
        "default": "LIMITED-TIME OFFER: GET 10% OFF WITH COUPON ATIVAFIT10"
      },
      {
        "type": "url",
        "id": "announcement_link",
        "label": "Announcement link"
      }, {
        "type": "checkbox",
        "id": "enable_ticker",
        "label": "Enable sliding text",
        "info": "When enabled, text will scroll horizontally. When disabled, text will be centered and static.",
        "default": true
      }, {
        "type": "checkbox",
        "id": "show_newsletter",
        "label": "Show newsletter button",
        "default": false
      }, {
        "type": "text",
        "id": "newsletter_button",
        "label": "Newsletter button text",
        "default": "Subscribe & Save"
      }, {
        "type": "header",
        "content": "Header"
      }, {
        "type": "image_picker",
        "id": "logo",
        "label": "Logo",
        "info": "400 x 120px .png recommended"
      }, {
        "type": "range",
        "id": "logo_max_width",
        "min": 50,
        "max": 300,
        "step": 5,
        "unit": "px",
        "label": "Logo width",
        "default": 120
      }, {
        "type": "link_list",
        "id": "navigation_menu",
        "label": "Menu"
      }
    ],
    "presets": [
      {
        "name": "Header with Announcement"
      }
    ]
  }
{% endschema %}