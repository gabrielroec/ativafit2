{% comment %} 
                                                                                                                      Product Main Section - Refactored
                                                                                                                       
                                                                                                                      Professional product page section following Shopify 2.0 best practices.
                                                                                                                      Uses modular snippets for better organization and maintainability.
                                                                                                                       
                                                                                                                      Accepts: 
                                                                                                                      - product: {Object} Product object
                                                                                                                       
                                                                                                                      Dependencies: 
                                                                                                                      - product-gallery.liquid snippet 
                                                                                                                      - product-info.liquid snippet 
                                                                                                                      - product-benefits.liquid snippet 
                                                                                                                      - product-add-to-cart.liquid snippet 
                                                                                                                      - product-accordions.liquid snippet 
                                                                                                                      - product-benefit-popups.liquid snippet 
                                                                                                                      - product-main-section.css asset 
{% endcomment %}

{{ 'product-main-section.css' | asset_url | stylesheet_tag }}

<section
  class="pp-full_new"
  data-section-id="{{ section.id }}"
  data-section-type="product-main">
  <div class="container-product-page_new">
    <div class="product-main_new">

      <!-- Product Gallery -->
      {% render 'product-gallery'
        , product: product
        , section: section %}

      <!-- Product Information -->
      <div class="product-info-wrapper_new">
      {% render 'product-info'
        , product: product
        , section: section %}

        <!-- Add to Cart Section -->
      {% render 'product-add-to-cart'
        , product: product
        , section: section %}
        <!-- Benefits Section -->
      {% render 'product-benefits'
        , section: section %}
        <!-- Accordions -->
      {% render 'product-accordions'
        , section: section %}


        <!-- Pairs Well With Section -->
        {% render 'product-pairs-well-with'
          , section: section %}

      <!-- Mobile Price (shown only on mobile) -->
      {% comment %} {%- if section.settings.show_mobile_price -%}
                                                                                                                                                                                                                                                                          <div class="product-price-container_new mobile-only_new">
                                                                                                                                                                                                                                                                            <p class="product-price_new black">{{ product.selected_or_first_available_variant.price | money }}</p>
                                                                                                                                                                                                                                                                            {%- if product.selected_or_first_available_variant.compare_at_price > product.selected_or_first_available_variant.price -%}
                                                                                                                                                                                                                                                                              <p class="product-price-original_new">{{ product.selected_or_first_available_variant.compare_at_price | money }}</p>
                                                                                                                                                                                                                                                                            {%- endif -%}
                                                                                                                                                                                                                                                                          </div>
                                                                                                                                                                                                        {%- endif -%} {% endcomment %}


      </div>

    </div>
  </div></section>

<!-- Benefit Popups -->
{% render 'product-benefit-popups'
  , section: section %}

<script>
  // ====================================================================
  // PRODUCT MAIN SECTION JAVASCRIPT
  // ====================================================================
  
  (function() {
    'use strict';
    
    const ProductGallery = {
      currentIndex: 0,
      thumbnailsOffset: 0,
      thumbnailWidth: 88,
      isDragging: false,
      startX: 0,
      startOffset: 0,
      dragThreshold: 10,
      hasMoved: false,
      isSwiping: false,
      swipeStartX: 0,
      swipeStartY: 0,
      swipeThreshold: 50,
      fullscreenCurrentIndex: 0,
      mediaData: {{ product.media | json }},
      
      // Change main media (image or video)
      changeMainMedia(mediaIndex, clickedThumb, force = false) {
        if (!force && (this.isDragging || this.hasMoved)) return;
        
        const media = this.mediaData[mediaIndex];
        if (!media) return;
        
        const mainImage = document.getElementById('mainImage_new');
        const mainVideo = document.getElementById('mainVideo_new');
        const mainVideoContainer = document.getElementById('mainVideoContainer_new');
        
        // Update current index
        this.currentIndex = mediaIndex;
        
        // Update active thumbnails
        document.querySelectorAll('.thumbnail-container_new').forEach(container => 
          container.classList.remove('active_new')
        );
        
        if (clickedThumb) {
          clickedThumb.classList.add('active_new');
        } else {
          // If no thumbnail provided, find and activate the correct one
          const thumbnailContainers = document.querySelectorAll('.thumbnail-container_new');
          if (thumbnailContainers[mediaIndex]) {
            thumbnailContainers[mediaIndex].classList.add('active_new');
          }
        }
        
        if (media.media_type === 'video') {
          if (mainImage) mainImage.style.display = 'none';
          if (mainVideoContainer) {
            mainVideoContainer.style.display = 'flex';
            if (mainVideo) {
              mainVideo.src = media.sources[0].url;
              mainVideo.load();
              
              // Video event listeners
              mainVideo.addEventListener('play', () => mainVideoContainer.classList.add('video-playing_new'));
              mainVideo.addEventListener('pause', () => mainVideoContainer.classList.remove('video-playing_new'));
              mainVideo.addEventListener('ended', () => mainVideoContainer.classList.remove('video-playing_new'));
              mainVideo.addEventListener('loadeddata', () => {
                mainVideo.play().catch(err => console.log('Auto-play blocked:', err));
              });
            }
          }
        } else {
          if (mainVideoContainer) mainVideoContainer.style.display = 'none';
          if (mainImage) {
            mainImage.style.display = 'block';
            mainImage.src = media.preview_image ? 
              media.preview_image.src.replace('150', '800') : 
              media.src.replace('150', '800');
          }
        }
        
        this.updateMainNavButtons();
      },
      
      // Navigate through images
      changeImage(direction) {
        if (this.mediaData.length === 0) return;
        
        this.currentIndex += direction;
        if (this.currentIndex >= this.mediaData.length) this.currentIndex = 0;
        if (this.currentIndex < 0) this.currentIndex = this.mediaData.length - 1;
        
        const thumbnailContainers = document.querySelectorAll('.thumbnail-container_new');
        const targetThumb = thumbnailContainers[this.currentIndex];
        
        if (targetThumb) {
          this.changeMainMedia(this.currentIndex, targetThumb);
          this.scrollToActiveThumbnail();
        }
      },
      
      // Update navigation button states
      updateMainNavButtons() {
        const prevBtn = document.querySelector('.main-prev_new');
        const nextBtn = document.querySelector('.main-next_new');
        
        if (!prevBtn || !nextBtn || !this.mediaData) return;
        
        prevBtn.disabled = this.currentIndex <= 0;
        nextBtn.disabled = this.currentIndex >= this.mediaData.length - 1;
      },
      
      // Scroll to active thumbnail
      scrollToActiveThumbnail() {
        const thumbnailContainers = document.querySelectorAll('.thumbnail-container_new');
        const thumbnailsScroll = document.querySelector('.thumbnails-scroll_new');
        
        if (thumbnailContainers.length <= 5 || !thumbnailsScroll) return;
        
        const scrollWidth = thumbnailsScroll.offsetWidth;
        const totalWidth = thumbnailContainers.length * this.thumbnailWidth;
        
        let idealOffset = this.currentIndex * this.thumbnailWidth - (scrollWidth / 2) + (this.thumbnailWidth / 2);
        idealOffset = Math.max(0, Math.min(totalWidth - scrollWidth, idealOffset));
        
        this.thumbnailsOffset = idealOffset;
        
        const thumbnailsContainer = document.querySelector('.thumbnails_new');
        if (thumbnailsContainer) {
          thumbnailsContainer.style.transform = `translateX(-${this.thumbnailsOffset}px)`;
        }
      },
      
      // Initialize main media
      initializeMainMedia() {
        const featuredMedia = {{ product.featured_media | json }};
        if (!featuredMedia || this.mediaData.length === 0) return;
        
        const featuredIndex = this.mediaData.findIndex(media => media.id === featuredMedia.id);
        if (featuredIndex !== -1) {
          this.currentIndex = featuredIndex;
          
          if (featuredMedia.media_type === 'video') {
            const mainVideoContainer = document.getElementById('mainVideoContainer_new');
            const mainVideo = document.getElementById('mainVideo_new');
            const mainImage = document.getElementById('mainImage_new');
            
            if (mainVideoContainer && mainVideo && mainImage) {
              mainImage.style.display = 'none';
              mainVideoContainer.style.display = 'flex';
              mainVideo.src = featuredMedia.sources[0].url;
              mainVideo.load();
              
              mainVideo.addEventListener('play', () => mainVideoContainer.classList.add('video-playing_new'));
              mainVideo.addEventListener('pause', () => mainVideoContainer.classList.remove('video-playing_new'));
              mainVideo.addEventListener('ended', () => mainVideoContainer.classList.remove('video-playing_new'));
              mainVideo.addEventListener('loadeddata', () => {
                mainVideo.play().catch(err => console.log('Auto-play blocked:', err));
              });
            }
          }
          
          // Update active thumbnails
          document.querySelectorAll('.thumbnail-container_new').forEach((container, index) => {
            container.classList.remove('active_new');
            if (index === featuredIndex) container.classList.add('active_new');
          });
        }
      },
      
      // Setup event listeners
      setupEventListeners() {
        // Main image container click/swipe events
        const mainImageContainer = document.getElementById('mainImageContainer_new');
        const mainImage = document.getElementById('mainImage_new');
        
        if (mainImageContainer) {
          // Prevent native image drag
          if (mainImage) {
            mainImage.setAttribute('draggable', 'false');
            mainImage.addEventListener('dragstart', (e) => {
              e.preventDefault();
              return false;
            });
            mainImage.addEventListener('selectstart', (e) => {
              e.preventDefault();
              return false;
            });
          }
          
          // Prevent drag on container
          mainImageContainer.addEventListener('dragstart', (e) => {
            e.preventDefault();
            return false;
          });
          
          mainImageContainer.addEventListener('selectstart', (e) => {
            if (this.isSwiping) {
              e.preventDefault();
              return false;
            }
          });
          
          // Mouse events for desktop swipe
          let mouseDown = false;
          let mouseStartX = 0;
          let mouseStartY = 0;
          
          mainImageContainer.addEventListener('mousedown', (e) => {
            if (e.target.closest('.main-nav_new')) return;
            mouseDown = true;
            mouseStartX = e.clientX;
            mouseStartY = e.clientY;
            this.startSwipe(e);
            mainImageContainer.style.cursor = 'grabbing';
            
            const handleMouseMove = (moveEvent) => {
              if (!mouseDown) return;
              this.onSwipe(moveEvent);
            };
            
            const handleMouseUp = (upEvent) => {
              if (!mouseDown) return;
              mouseDown = false;
              mainImageContainer.style.cursor = 'grab';
              this.stopSwipe(upEvent);
              document.removeEventListener('mousemove', handleMouseMove);
              document.removeEventListener('mouseup', handleMouseUp);
            };
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);
          });
          
          // Reset cursor if mouse leaves container
          mainImageContainer.addEventListener('mouseleave', () => {
            if (mouseDown) {
              mouseDown = false;
              mainImageContainer.style.cursor = 'grab';
            }
          });
          
          // Click event (only if not swiping)
          mainImageContainer.addEventListener('click', (e) => {
            if (e.target.closest('.main-nav_new')) return;
            // Only open fullscreen if it wasn't a swipe
            if (!this.isSwiping) {
              this.openFullscreen();
            }
          });
          
          // Touch events for mobile swipe
          mainImageContainer.addEventListener('touchstart', this.startSwipe.bind(this), { passive: true });
          mainImageContainer.addEventListener('touchmove', this.onSwipe.bind(this), { passive: false });
          mainImageContainer.addEventListener('touchend', this.stopSwipe.bind(this), { passive: true });
        }
        
        // Thumbnails drag events
        const thumbnailsContainer = document.querySelector('.thumbnails_new');
        if (thumbnailsContainer) {
          thumbnailsContainer.addEventListener('mousedown', (e) => {
            // Only start drag if not clicking on a thumbnail
            if (!e.target.closest('.thumbnail-container_new')) {
              this.startDrag(e);
            }
          });
          thumbnailsContainer.addEventListener('touchstart', (e) => {
            // Only start drag if not touching a thumbnail
            if (!e.target.closest('.thumbnail-container_new')) {
              this.startDrag(e);
            }
          }, { passive: false });
          thumbnailsContainer.addEventListener('selectstart', (e) => {
            if (this.isDragging) e.preventDefault();
          });
        }
        
        // Fullscreen modal events
        const fullscreenModal = document.getElementById('fullscreenModal_new');
        if (fullscreenModal) {
          document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && fullscreenModal.classList.contains('active_new')) {
              this.closeFullscreen();
            }
          });
          
          fullscreenModal.addEventListener('click', (e) => {
            if (e.target === fullscreenModal) this.closeFullscreen();
          });
          
          const closeBtn = fullscreenModal.querySelector('.fullscreen-close_new');
          if (closeBtn) {
            closeBtn.addEventListener('click', (e) => {
              e.preventDefault();
              e.stopPropagation();
              this.closeFullscreen();
            });
          }
        }
        
        // Hide swipe indicator after 3 seconds
        setTimeout(() => {
          const swipeIndicator = document.getElementById('swipeIndicator_new');
          if (swipeIndicator) swipeIndicator.classList.add('hidden_new');
        }, 3000);
        
        // Window resize
        window.addEventListener('resize', () => {
          this.thumbnailsOffset = 0;
          const container = document.querySelector('.thumbnails_new');
          if (container) container.style.transform = 'translateX(0px)';
          this.updateMainNavButtons();
        });
      },
      
      // Swipe functions
      startSwipe(e) {
        this.isSwiping = false;
        this.swipeStartX = e.type === 'mousedown' ? e.clientX : e.touches[0].clientX;
        this.swipeStartY = e.type === 'mousedown' ? e.clientY : e.touches[0].clientY;
      },
      
      onSwipe(e) {
        if (!this.isSwiping) {
          const currentX = e.type === 'mousemove' ? e.clientX : e.touches[0].clientX;
          const currentY = e.type === 'mousemove' ? e.clientY : e.touches[0].clientY;
          const deltaX = Math.abs(this.swipeStartX - currentX);
          const deltaY = Math.abs(this.swipeStartY - currentY);
          
          if (deltaX > 10 && deltaX > deltaY) {
            this.isSwiping = true;
            e.preventDefault();
          }
        }
        
        if (this.isSwiping) e.preventDefault();
      },
      
      stopSwipe(e) {
        if (this.isSwiping) {
          const currentX = e.type === 'mouseup' ? e.clientX : e.changedTouches[0].clientX;
          const deltaX = Math.abs(this.swipeStartX - currentX);
          
          if (deltaX > this.swipeThreshold) {
            if (this.swipeStartX > currentX) {
              this.changeImage(1);
            } else {
              this.changeImage(-1);
            }
          }
        }
        
        // Reset isSwiping after a small delay to allow click detection
        setTimeout(() => {
          this.isSwiping = false;
        }, 100);
      },
      
      // Drag functions
      startDrag(e) {
        // Check if click was on a thumbnail - if so, don't start drag
        const clickedThumbnail = e.target.closest('.thumbnail-container_new');
        if (clickedThumbnail) {
          // Allow the thumbnail click to work normally
          return;
        }
        
        this.isDragging = false;
        this.hasMoved = false;
        this.startX = e.type === 'mousedown' ? e.clientX : e.touches[0].clientX;
        this.startOffset = this.thumbnailsOffset;
        
        if (e.type === 'mousedown') {
          document.addEventListener('mousemove', this.onDrag.bind(this));
          document.addEventListener('mouseup', this.stopDrag.bind(this));
        } else {
          document.addEventListener('touchmove', this.onDrag.bind(this));
          document.addEventListener('touchend', this.stopDrag.bind(this));
        }
      },
      
      onDrag(e) {
        const currentX = e.type === 'mousemove' ? e.clientX : e.touches[0].clientX;
        const deltaX = Math.abs(this.startX - currentX);
        
        if (!this.hasMoved && deltaX > this.dragThreshold) {
          this.isDragging = true;
          this.hasMoved = true;
          document.body.style.cursor = 'grabbing';
          document.body.style.userSelect = 'none';
        }
        
        if (!this.isDragging) return;
        
        e.preventDefault();
        const newOffset = this.startOffset + (this.startX - currentX);
        const thumbnailContainers = document.querySelectorAll('.thumbnail-container_new');
        const thumbnailsScroll = document.querySelector('.thumbnails-scroll_new');
        
        if (thumbnailsScroll && thumbnailContainers.length > 5) {
          const scrollWidth = thumbnailsScroll.offsetWidth;
          const totalWidth = thumbnailContainers.length * this.thumbnailWidth;
          const maxOffset = totalWidth - scrollWidth;
          
          this.thumbnailsOffset = Math.max(0, Math.min(maxOffset, newOffset));
          
          const thumbnailsContainer = document.querySelector('.thumbnails_new');
          if (thumbnailsContainer) {
            thumbnailsContainer.style.transform = `translateX(-${this.thumbnailsOffset}px)`;
          }
        }
      },
      
      stopDrag(e) {
        // If it was a click (not a drag), don't do anything
        if (!this.isDragging && !this.hasMoved) {
          this.cleanupDrag();
          return;
        }
        
        this.isDragging = false;
        this.cleanupDrag();
      },
      
      cleanupDrag() {
        document.body.style.cursor = '';
        document.body.style.userSelect = '';
        
        document.removeEventListener('mousemove', this.onDrag);
        document.removeEventListener('mouseup', this.stopDrag);
        document.removeEventListener('touchmove', this.onDrag);
        document.removeEventListener('touchend', this.stopDrag);
        
        setTimeout(() => { this.hasMoved = false; }, 50);
      },
      
      // Fullscreen functions
      openFullscreen() {
        const modal = document.getElementById('fullscreenModal_new');
        const fullscreenImage = document.getElementById('fullscreenImage_new');
        const fullscreenVideo = document.getElementById('fullscreenVideo_new');
        const mainImage = document.getElementById('mainImage_new');
        
        if (modal && fullscreenImage && fullscreenVideo) {
          // Garantir que o modal está no body
          if (modal.parentNode !== document.body) {
            document.body.appendChild(modal);
          }
          
          const currentMedia = this.mediaData[this.currentIndex];
          this.fullscreenCurrentIndex = this.currentIndex;
          
          if (currentMedia && currentMedia.media_type === 'video') {
            fullscreenImage.style.display = 'none';
            fullscreenVideo.style.display = 'block';
            fullscreenVideo.src = currentMedia.sources[0].url;
            fullscreenVideo.load();
            fullscreenVideo.addEventListener('loadeddata', () => {
              fullscreenVideo.play().catch(err => console.log('Auto-play blocked:', err));
            });
          } else {
            fullscreenVideo.style.display = 'none';
            fullscreenImage.style.display = 'block';
            if (mainImage) {
              fullscreenImage.src = mainImage.src.replace('800', '1200');
              fullscreenImage.alt = mainImage.alt;
            }
          }
          
          this.updateFullscreenThumbnails();
          modal.style.display = 'flex';
          modal.classList.add('active_new');
          document.body.classList.add('modal-open_new');
        }
      },
      
      closeFullscreen() {
        const modal = document.getElementById('fullscreenModal_new');
        if (modal) {
          modal.classList.remove('active_new');
          modal.style.display = 'none';
          document.body.classList.remove('modal-open_new');
        }
      },
      
      changeFullscreenImage(direction) {
        if (this.mediaData.length === 0) return;
        
        this.fullscreenCurrentIndex += direction;
        if (this.fullscreenCurrentIndex >= this.mediaData.length) this.fullscreenCurrentIndex = 0;
        if (this.fullscreenCurrentIndex < 0) this.fullscreenCurrentIndex = this.mediaData.length - 1;
        
        const currentMedia = this.mediaData[this.fullscreenCurrentIndex];
        const fullscreenImage = document.getElementById('fullscreenImage_new');
        const fullscreenVideo = document.getElementById('fullscreenVideo_new');
        
        if (currentMedia && fullscreenImage && fullscreenVideo) {
          if (currentMedia.media_type === 'video') {
            fullscreenImage.style.display = 'none';
            fullscreenVideo.style.display = 'block';
            fullscreenVideo.src = currentMedia.sources[0].url;
            fullscreenVideo.load();
            fullscreenVideo.addEventListener('loadeddata', () => {
              fullscreenVideo.play().catch(err => console.log('Auto-play blocked:', err));
            });
          } else {
            fullscreenVideo.style.display = 'none';
            fullscreenImage.style.display = 'block';
            fullscreenImage.src = currentMedia.preview_image ? 
              currentMedia.preview_image.src.replace('150', '1200') : 
              currentMedia.src.replace('150', '1200');
            fullscreenImage.alt = currentMedia.alt || '';
          }
          
          this.updateFullscreenThumbnails();
        }
      },
      
      changeFullscreenMediaByIndex(index) {
        if (index < 0 || index >= this.mediaData.length) return;
        this.fullscreenCurrentIndex = index;
        this.changeFullscreenImage(0);
      },
      
      updateFullscreenThumbnails() {
        const containers = document.querySelectorAll('.fullscreen-thumb-container_new');
        const thumbnailsContainer = document.getElementById('fullscreenThumbnailsContainer_new');
        
        containers.forEach((container, index) => {
          container.classList.remove('active_new');
          if (index === this.fullscreenCurrentIndex) {
            container.classList.add('active_new');
            
            // Scroll suave para centralizar a thumbnail ativa
            if (thumbnailsContainer && container) {
              const containerRect = container.getBoundingClientRect();
              const scrollContainerRect = thumbnailsContainer.getBoundingClientRect();
              const scrollLeft = thumbnailsContainer.scrollLeft;
              const containerLeft = containerRect.left - scrollContainerRect.left + scrollLeft;
              const containerWidth = containerRect.width;
              const scrollContainerWidth = scrollContainerRect.width;
              const targetScroll = containerLeft - (scrollContainerWidth / 2) + (containerWidth / 2);
              
              thumbnailsContainer.scrollTo({
                left: targetScroll,
                behavior: 'smooth'
              });
            }
          }
        });
      },
      
      // Initialize gallery
      init() {
        // Mover modal para o body para garantir z-index máximo
        const modal = document.getElementById('fullscreenModal_new');
        if (modal && modal.parentNode !== document.body) {
          document.body.appendChild(modal);
        }
        
        this.initializeMainMedia();
        this.updateMainNavButtons();
        this.setupEventListeners();
      }
    };
    
    // Make gallery functions global for onclick handlers
    window.changeMainMedia = (index, thumb) => ProductGallery.changeMainMedia(index, thumb);
    window.changeImage = (direction) => ProductGallery.changeImage(direction);
    window.openFullscreen = () => ProductGallery.openFullscreen();
    window.closeFullscreen = () => ProductGallery.closeFullscreen();
    window.changeFullscreenImage = (direction) => ProductGallery.changeFullscreenImage(direction);
    window.changeFullscreenMediaByIndex = (index) => ProductGallery.changeFullscreenMediaByIndex(index);
    
    // ====================================================================
    // VARIANT & CART FUNCTIONS
    // ====================================================================
    
    const ProductVariants = {
      variants: {{ product.variants | json }},
      currentSelector: null,
      
      updateVariant(sourceSelector = null) {
        let selectedVariant = null;
        // Check both desktop and mobile selectors
        const variantSelectorDesktop = document.getElementById('variant-selector_new');
        const variantSelectorMobile = document.getElementById('variant-selector-mobile_new');
        
        // Determine which selector to use
        let variantSelector = sourceSelector;
        if (!variantSelector) {
          // Check which one is visible or recently interacted with
          if (variantSelectorMobile && window.getComputedStyle(variantSelectorMobile).display !== 'none') {
            variantSelector = variantSelectorMobile;
          } else if (variantSelectorDesktop) {
            variantSelector = variantSelectorDesktop;
          }
        }
        
        if (variantSelector) {
          const selectedVariantId = parseInt(variantSelector.value);
          selectedVariant = this.variants.find(v => v.id === selectedVariantId);
          
          // Sync both selectors
          if (variantSelectorDesktop && variantSelectorMobile) {
            variantSelectorDesktop.value = selectedVariantId;
            variantSelectorMobile.value = selectedVariantId;
          }
        }
        
        if (selectedVariant) {
          this.updatePrice(selectedVariant);
          this.updateMainImageForVariant(selectedVariant);
          this.updateProductForm(selectedVariant);
          this.updateDynamicCheckout(selectedVariant);
          this.updateButtonsForVariant(selectedVariant);
        }
      },
      
      updateButtonsForVariant(variant) {
        // Check if waitlist should be shown for this variant
        const waitlistVariants = '{{ section.settings.waitlist_variant_ids | escape }}';
        const showWaitlistGlobal = {{ section.settings.show_waitlist_button | json }};
        
        let shouldShowWaitlist = false;
        
        if (showWaitlistGlobal) {
          if (!waitlistVariants || waitlistVariants.trim() === '') {
            // No variants specified, show for all variants
            shouldShowWaitlist = true;
          } else {
            // Check if current variant ID or name (title) is in the list
            const variantList = waitlistVariants.split(',').map(item => item.trim().toLowerCase());
            const variantIdString = variant.id.toString();
            const variantTitle = variant.title ? variant.title.trim().toLowerCase() : '';
            
            // Check by ID (case-sensitive) or by name (case-insensitive)
            const variantIdInList = variantList.some(item => item === variantIdString);
            const variantNameInList = variantList.some(item => item === variantTitle);
            
            shouldShowWaitlist = variantIdInList || variantNameInList;
            
            // Debug log
            console.log('Waitlist check:', {
              variantId: variantIdString,
              variantTitle: variant.title,
              waitlistVariants: variantList,
              shouldShow: shouldShowWaitlist
            });
          }
        }
        
        // Get buttons - use more specific selectors
        const addToCartBtn = document.querySelector('button[name="add"].add-to-cart-btn_new:not(.waitlist-btn_new)');
        const waitlistBtn = document.querySelector('.waitlist-btn_new.klaviyo_waitlist_trigger');
        const buyItNowBtn = document.querySelector('.buy-it-now-btn_new');
        
        console.log('Buttons found:', {
          addToCartBtn: !!addToCartBtn,
          waitlistBtn: !!waitlistBtn,
          buyItNowBtn: !!buyItNowBtn,
          shouldShowWaitlist: shouldShowWaitlist
        });
        
        if (shouldShowWaitlist) {
          // Show waitlist button, hide add to cart and buy it now
          if (addToCartBtn) {
            addToCartBtn.style.display = 'none';
          }
          if (waitlistBtn) {
            waitlistBtn.style.display = '';
            waitlistBtn.setAttribute('data-variant-id', variant.id);
            // Update Klaviyo form ID if needed
            const formId = waitlistBtn.getAttribute('data-klaviyo-form-id');
            if (!formId || formId.trim() === '') {
              console.warn('Klaviyo Form ID is missing from waitlist button');
            }
          } else {
            console.warn('Waitlist button not found in DOM');
          }
          if (buyItNowBtn) {
            buyItNowBtn.style.display = 'none';
          }
        } else {
          // Show add to cart and buy it now, hide waitlist
          if (addToCartBtn) {
            addToCartBtn.style.display = '';
            addToCartBtn.setAttribute('data-variant-id', variant.id);
          }
          if (waitlistBtn) {
            waitlistBtn.style.display = 'none';
          }
          if (buyItNowBtn && {{ section.settings.show_buy_it_now | json }}) {
            buyItNowBtn.style.display = '';
          }
        }
      },
      
      updateProductForm(variant) {
        // Update hidden input in the main product form
        const productForm = document.querySelector('.product-form_new');
        if (productForm && variant) {
          const variantInput = productForm.querySelector('input[name="id"]');
          if (variantInput) {
            variantInput.value = variant.id;
          }
          
          // Update hidden variant input with section ID
          const variantInputWithId = document.getElementById('product-variant-id-{{ section.id }}');
          if (variantInputWithId) {
            variantInputWithId.value = variant.id;
          }
          
          // Update select[name="id"] if it exists
          const variantSelect = productForm.querySelector('select[name="id"]');
          if (variantSelect) {
            variantSelect.value = variant.id;
          }
          
          // Update variant selectors if they exist (both desktop and mobile)
          const variantSelectorDesktop = document.getElementById('variant-selector_new');
          const variantSelectorMobile = document.getElementById('variant-selector-mobile_new');
          if (variantSelectorDesktop) {
            variantSelectorDesktop.value = variant.id;
          }
          if (variantSelectorMobile) {
            variantSelectorMobile.value = variant.id;
          }
          
          // Update shopify-payment-terms component if it exists
          const paymentTerms = productForm.querySelector('shopify-payment-terms');
          if (paymentTerms) {
            paymentTerms.setAttribute('variant-id', variant.id);
          }
        }
      },
      
      updateDynamicCheckout(variant) {
        // Dynamic checkout buttons are automatically updated by Shopify
        // But we can trigger a refresh if needed
        const dynamicCheckout = document.querySelector('[id^="dynamic-checkout"]');
        if (dynamicCheckout && variant) {
          // Shopify handles this automatically, but we ensure the form is updated
          const productForm = document.querySelector('.product-form_new');
          if (productForm) {
            // Trigger form change event to update Shopify's dynamic checkout
            const event = new Event('change', { bubbles: true });
            const variantInput = productForm.querySelector('input[name="id"]');
            if (variantInput) {
              variantInput.dispatchEvent(event);
            }
          }
        }
      },
      
      updatePrice(variant) {
        if (!variant) return;
        
        // Helper function to format money with fallback
        const formatMoney = (cents) => {
          if (window.Shopify && typeof window.Shopify.formatMoney === 'function') {
            const moneyFormat = window.theme?.moneyFormat || window.Shopify?.money_format || '${{amount}}';
            return window.Shopify.formatMoney(cents, moneyFormat);
          }
          // Fallback: format as USD currency
          return new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD'
          }).format((cents || 0) / 100);
        };
        
        // Update main price
        const priceElements = document.querySelectorAll('.product-price_new');
        priceElements.forEach(el => {
          if (el) {
            el.textContent = formatMoney(variant.price);
          }
        });
        
        // Update compare at price (original price)
        const comparePriceElements = document.querySelectorAll('.product-price-original_new');
        comparePriceElements.forEach(el => {
          if (el) {
            if (variant.compare_at_price && variant.compare_at_price > variant.price) {
              el.textContent = formatMoney(variant.compare_at_price);
              el.style.display = 'block';
            } else {
              el.style.display = 'none';
            }
          }
        });
        
        // Also update payment terms component if it exists
        const paymentTerms = document.querySelector('shopify-payment-terms');
        if (paymentTerms && variant.id) {
          paymentTerms.setAttribute('variant-id', variant.id);
        }
      },
      
      updateMainImageForVariant(variant) {
        if (!variant || !variant.featured_image) return;
        
        // Find the media index that matches the variant's featured image
        const variantImageId = variant.featured_image.id;
        const variantImageSrc = variant.featured_image.src;
        
        const mediaIndex = ProductGallery.mediaData.findIndex(media => {
          // Check if this media matches the variant's featured image by ID
          if (media.media_type === 'image' && media.id === variantImageId) {
            return true;
          }
          // Check by image source URL (normalize for comparison)
          if (media.media_type === 'image' && media.src) {
            const mediaSrcNormalized = media.src.split('?')[0]; // Remove query params
            const variantSrcNormalized = variantImageSrc.split('?')[0];
            if (mediaSrcNormalized === variantSrcNormalized || 
                mediaSrcNormalized.includes(variantSrcNormalized) ||
                variantSrcNormalized.includes(mediaSrcNormalized)) {
              return true;
            }
          }
          // Also check preview_image for videos (in case variant image is a video thumbnail)
          if (media.preview_image) {
            if (media.preview_image.id === variantImageId) {
              return true;
            }
            if (media.preview_image.src) {
              const previewSrcNormalized = media.preview_image.src.split('?')[0];
              const variantSrcNormalized = variantImageSrc.split('?')[0];
              if (previewSrcNormalized === variantSrcNormalized ||
                  previewSrcNormalized.includes(variantSrcNormalized) ||
                  variantSrcNormalized.includes(previewSrcNormalized)) {
                return true;
              }
            }
          }
          return false;
        });
        
        // If we found a matching media, switch to it
        if (mediaIndex !== -1) {
          // Update current index
          ProductGallery.currentIndex = mediaIndex;
          
          // Get the thumbnail container for this media
          const thumbnailContainers = document.querySelectorAll('.thumbnail-container_new');
          const targetThumb = thumbnailContainers[mediaIndex];
          
          if (targetThumb) {
            // Use the existing changeMainMedia function to properly switch
            // Force the change to bypass drag checks
            ProductGallery.changeMainMedia(mediaIndex, targetThumb, true);
            ProductGallery.scrollToActiveThumbnail();
            ProductGallery.updateMainNavButtons();
          }
        } else {
          // Fallback: if we can't find the media, just update the image directly
          const mainImage = document.getElementById('mainImage_new');
          const mainVideoContainer = document.getElementById('mainVideoContainer_new');
          
          if (mainImage) {
            // Hide video, show image
            if (mainVideoContainer) {
              mainVideoContainer.style.display = 'none';
            }
            mainImage.style.display = 'block';
            mainImage.src = variant.featured_image.src.replace('150', '800');
            mainImage.alt = variant.featured_image.alt || variant.title;
          }
        }
      }
    };
    
    window.updateVariant = () => ProductVariants.updateVariant();
    
    // ====================================================================
    // ADD TO CART FUNCTION
    // ====================================================================
    
    window.addToCart = async function() {
      // Get variant ID from form or selector
      const variantInput = document.getElementById('product-variant-id-{{ section.id }}');
      const variantSelector = document.getElementById('variant-selector_new');
      let variantId = null;
      
      if (variantInput) {
        variantId = parseInt(variantInput.value);
      } else if (variantSelector) {
        variantId = parseInt(variantSelector.value);
      } else {
        variantId = ProductVariants.variants[0]?.id || {{ product.selected_or_first_available_variant.id }};
      }
      
      const quantity = parseInt(document.getElementById('quantity_new')?.value || 1);
      const btn = document.querySelector('.add-to-cart-btn_new');
      
      if (!variantId) {
        alert('Please select a product variant');
        return;
      }
      
      // Prevent multiple submissions
      if (btn.dataset.processing === 'true') {
        return;
      }
      
      const originalText = btn.textContent;
      btn.textContent = 'ADDING...';
      btn.disabled = true;
      btn.style.opacity = '0.7';
      btn.dataset.processing = 'true';
      
      try {
        const response = await fetch('/cart/add.js', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            items: [{ id: variantId, quantity: quantity }]
          })
        });
        
        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.message || 'Error adding to cart');
        }
        
        const data = await response.json();
        
        // Update cart counter
        const cartData = await fetch('/cart.js').then(res => res.json());
        const cartCountElement = document.querySelector('.header__cart-count');
        if (cartCountElement) {
          cartCountElement.textContent = cartData.item_count;
        }
        
        // Update cart drawer if available
        if (window.cartDrawer) {
          await window.cartDrawer.loadCartData();
          window.cartDrawer.updateCartCount();
          window.cartDrawer.updateRecommendedSection();
        } else if (window.updateCartCount) {
          window.updateCartCount();
        }
        
        // Show success notification FIRST
        if (window.CartNotification) {
          const productTitle = document.querySelector('.product-name_new')?.textContent || 'Product';
          window.CartNotification.success({
            title: "Product Added!",
            message: 'Join <a href="https://www.ativafit.com/pages/ativapeople-rewards-program" target="_blank" style="color: #eb701f; text-decoration: underline; font-weight: bold;">AtivaPeople</a> & get 10% off your first order.',
            type: "success"
          });
        }
        
        // Wait for notification to appear, then open cart drawer
        setTimeout(() => {
          if (window.cartDrawer) {
            window.cartDrawer.open();
          } else if (window.theme && window.theme.miniCart) {
            window.theme.miniCart.open();
          }
        }, 300);
        
        btn.textContent = 'ADDED ✓';
        setTimeout(() => {
          btn.textContent = originalText;
          btn.disabled = false;
          btn.style.opacity = '1';
          delete btn.dataset.processing;
        }, 2000);
        
      } catch (error) {
        console.error('Add to cart error:', error);
        
        // Show error notification
        if (window.CartNotification) {
          window.CartNotification.error('Unable to add product to cart. Please try again.', 'Error adding product');
        } else {
          alert('Error adding product to cart. Please try again.');
        }
        
        btn.textContent = originalText;
        btn.disabled = false;
        btn.style.opacity = '1';
        delete btn.dataset.processing;
      }
    };
    
    // ====================================================================
    // BUY IT NOW FUNCTION - Goes directly to checkout
    // ====================================================================
    
    window.buyItNow = async function() {
      // Get variant ID from form or selector
      const variantInput = document.getElementById('product-variant-id-{{ section.id }}');
      const variantSelector = document.getElementById('variant-selector_new');
      let variantId = null;
      
      if (variantInput) {
        variantId = parseInt(variantInput.value);
      } else if (variantSelector) {
        variantId = parseInt(variantSelector.value);
      } else {
        variantId = ProductVariants.variants[0]?.id || {{ product.selected_or_first_available_variant.id }};
      }
      
      const quantity = parseInt(document.getElementById('quantity_new')?.value || 1);
      const btn = document.querySelector('.buy-it-now-btn_new');
      
      if (!variantId) {
        alert('Please select a product variant');
        return;
      }
      
      const originalText = btn.textContent;
      btn.textContent = 'PROCESSING...';
      btn.disabled = true;
      btn.style.opacity = '0.7';
      
      try {
        const response = await fetch('/cart/add.js', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            items: [{ id: variantId, quantity: quantity }]
          })
        });
        
        if (!response.ok) throw new Error('Error adding to cart');
        
        // Redirect to checkout immediately
        window.location.href = '/checkout';
        
      } catch (error) {
        console.error('Buy It Now error:', error);
        alert('Error processing your order. Please try again.');
        btn.textContent = originalText;
        btn.disabled = false;
        btn.style.opacity = '1';
      }
    };
    
    // ====================================================================
    // ACCORDION FUNCTION
    // ====================================================================
    
    window.toggleAccordion = function(header) {
      const content = header.nextElementSibling;
      const icon = header.querySelector('.accordion-icon_new');
      const isActive = content.classList.contains('active_new');
      
      // Remove active from all
      document.querySelectorAll('.accordion-header_new').forEach(item => item.classList.remove('active_new'));
      document.querySelectorAll('.accordion-content_new').forEach(item => item.classList.remove('active_new'));
      document.querySelectorAll('.accordion-icon_new').forEach(item => item.textContent = '+');
      
      // Toggle current
      if (!isActive) {
        header.classList.add('active_new');
        content.classList.add('active_new');
        icon.textContent = '-';
      }
    };
    
    // ====================================================================
    // BENEFIT POPUPS
    // ====================================================================
    
    const BenefitPopups = {
      init() {
        const benefitLinks = document.querySelectorAll('.benefit-learn-more_new');
        
        benefitLinks.forEach((link) => {
          link.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            const benefitId = link.getAttribute('data-benefit-popup');
            
            if (benefitId) {
              const popupId = 'benefit-popup-' + benefitId;
              const popup = document.getElementById(popupId);
              
              if (popup) {
                popup.classList.add('is-show');
                document.body.style.overflow = 'hidden';
              } else {
                console.warn('Popup não encontrado para benefit:', popupId);
              }
            }
          });
        });
        
        // Close buttons
        document.querySelectorAll('[data-close-benefit]').forEach(button => {
          button.addEventListener('click', () => {
            const benefitId = button.getAttribute('data-close-benefit');
            const popup = document.getElementById('benefit-popup-' + benefitId);
            
            if (popup) {
              popup.classList.remove('is-show');
              document.body.style.overflow = '';
            }
          });
        });
        
        // Close on backdrop click
        document.querySelectorAll('.halo-popup').forEach(popup => {
          popup.addEventListener('click', (e) => {
            if (e.target === popup) {
              popup.classList.remove('is-show');
              document.body.style.overflow = '';
            }
          });
        });
        
        // Close on Escape key
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            document.querySelectorAll('.halo-popup.is-show').forEach(popup => {
              popup.classList.remove('is-show');
              document.body.style.overflow = '';
            });
          }
        });
      }
    };
    
    // ====================================================================
    // INITIALIZATION
    // ====================================================================
    
    document.addEventListener('DOMContentLoaded', () => {
      ProductGallery.init();
      BenefitPopups.init();
      
      // Initialize variant selector event listeners (both desktop and mobile)
      const variantSelectorDesktop = document.getElementById('variant-selector_new');
      const variantSelectorMobile = document.getElementById('variant-selector-mobile_new');
      
      // Function to sync both selectors
      const syncVariantSelectors = (sourceSelector, targetSelector) => {
        if (targetSelector && sourceSelector) {
          targetSelector.value = sourceSelector.value;
        }
      };
      
      // Initialize desktop selector
      if (variantSelectorDesktop) {
        variantSelectorDesktop.addEventListener('change', (e) => {
          e.preventDefault();
          ProductVariants.updateVariant(variantSelectorDesktop);
        });
        
        // Initialize price with current selected variant
        const currentVariantId = parseInt(variantSelectorDesktop.value);
        const currentVariant = ProductVariants.variants.find(v => v.id === currentVariantId);
        if (currentVariant) {
          ProductVariants.updatePrice(currentVariant);
          ProductVariants.updateButtonsForVariant(currentVariant);
        }
      }
      
      // Initialize mobile selector
      if (variantSelectorMobile) {
        variantSelectorMobile.addEventListener('change', (e) => {
          e.preventDefault();
          ProductVariants.updateVariant(variantSelectorMobile);
        });
        
        // Sync initial value from desktop if mobile exists
        if (variantSelectorDesktop) {
          variantSelectorMobile.value = variantSelectorDesktop.value;
        }
      }
      
      // If no desktop selector, initialize buttons with first available variant
      if (!variantSelectorDesktop && ProductVariants.variants.length > 0) {
        const firstVariant = ProductVariants.variants.find(v => v.available) || ProductVariants.variants[0];
        if (firstVariant) {
          ProductVariants.updateButtonsForVariant(firstVariant);
        }
      }
      
      // ====================================================================
      // KLAVIYO WAITLIST BUTTON TRIGGER (Must be before form submit handler)
      // ====================================================================
      // Following Klaviyo documentation: https://help.klaviyo.com/hc/en-us/articles/4418052317339
      const waitlistButtons = document.querySelectorAll('.klaviyo_waitlist_trigger');
      
      if (waitlistButtons.length > 0) {
        waitlistButtons.forEach(function(waitlistButton) {
          let formId = waitlistButton.getAttribute('data-klaviyo-form-id');
          
          if (formId && formId.trim() !== '') {
            // Extract Form ID if user accidentally pasted the full JavaScript code
            // Look for pattern like ['openForm', 'Sr3xAi'] or "Sr3xAi" or 'Sr3xAi'
            const formIdMatch = formId.match(/['"]([A-Za-z0-9]{6})['"]/);
            if (formIdMatch) {
              formId = formIdMatch[1];
              console.log('Extracted Form ID from code:', formId);
            }
            
            // Clean up: remove any JavaScript code, keep only the ID
            formId = formId.trim();
            
            // Final validation: Form ID should be 6 alphanumeric characters
            if (formId.length === 6 && /^[A-Za-z0-9]+$/.test(formId)) {
              waitlistButton.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                
                console.log('Klaviyo Waitlist Button clicked, Form ID:', formId);
                
                // Initialize Klaviyo onsite array if it doesn't exist
                window._klOnsite = window._klOnsite || [];
                
                // Push the openForm command
                window._klOnsite.push(['openForm', formId]);
                
                console.log('Klaviyo command pushed:', ['openForm', formId]);
                
                return false;
              }, true); // Use capture phase to ensure it runs first
            } else {
              console.error('Invalid Klaviyo Form ID. Expected 6 alphanumeric characters (e.g., Sr3xAi). Got:', formId);
              console.warn('Please enter only the Form ID (6 characters) in the "Klaviyo Form ID" field, not the JavaScript code.');
            }
          } else {
            console.warn('Klaviyo Form ID is not configured for waitlist button.');
          }
        });
      } else {
        console.log('No Klaviyo waitlist buttons found on page');
      }
      
      // Intercept form submission to prevent redirect to /cart
      const productForm = document.querySelector('.product-form_new');
      if (productForm) {
        productForm.addEventListener('submit', async function(e) {
          // Don't prevent if it's a waitlist button click
          const clickedButton = e.target.querySelector('.klaviyo_waitlist_trigger:active, .klaviyo_waitlist_trigger:focus');
          if (clickedButton) {
            return; // Let the waitlist handler deal with it
          }
          
          e.preventDefault();
          
          // Prevent multiple submissions
          if (productForm.dataset.processing === 'true') {
            return;
          }
          
          productForm.dataset.processing = 'true';
          
          // Call addToCart function
          await window.addToCart();
          
          // Remove processing flag after a delay
          setTimeout(() => {
            delete productForm.dataset.processing;
          }, 2000);
        });
      }
      
      // Ensure shopify-payment-terms component is displayed in product form
      const ensurePaymentTermsVisible = () => {
        const paymentTerms = document.querySelector('.payment-options-form shopify-payment-terms, .product-form_new shopify-payment-terms');
        if (paymentTerms) {
          // Force component to be visible
          paymentTerms.style.display = 'block';
          paymentTerms.style.visibility = 'visible';
          paymentTerms.style.opacity = '1';
        }
      };
      
      ensurePaymentTermsVisible();
      // Also check after a delay in case Shopify scripts load later
      setTimeout(ensurePaymentTermsVisible, 1000);
      
      // Hide Shop Pay button if option is enabled
      const hideShopPayButton = () => {
        const hideShopPayContainer = document.querySelector('.hide-shop-pay_new');
        if (hideShopPayContainer) {
          // Hide Shop Pay button using various selectors
          const shopPayButtons = hideShopPayContainer.querySelectorAll(
            '[data-testid="shopify-pay-button"], ' +
            '[aria-label*="Shop Pay"], ' +
            'iframe[src*="shop-pay"], ' +
            '.shopify-cleanslate [aria-label*="Shop Pay"], ' +
            '.shopify-cleanslate button[data-testid="shopify-pay-button"]'
          );
          
          shopPayButtons.forEach(btn => {
            btn.style.display = 'none';
            btn.style.visibility = 'hidden';
          });
          
          // Also hide parent containers if they only contain Shop Pay
          const shopPayIframes = hideShopPayContainer.querySelectorAll('iframe[src*="shop-pay"]');
          shopPayIframes.forEach(iframe => {
            const parent = iframe.closest('div');
            if (parent && parent.querySelectorAll('iframe').length === 1) {
              parent.style.display = 'none';
            }
            iframe.style.display = 'none';
            iframe.style.visibility = 'hidden';
          });
        }
      };
      
      // Run immediately and after delays to catch dynamically loaded buttons
      hideShopPayButton();
      setTimeout(hideShopPayButton, 500);
      setTimeout(hideShopPayButton, 1500);
      setTimeout(hideShopPayButton, 3000);
      
      // Also observe for dynamically added elements
      const observer = new MutationObserver(() => {
        hideShopPayButton();
      });
      
      const dynamicCheckout = document.querySelector('.hide-shop-pay_new');
      if (dynamicCheckout) {
        observer.observe(dynamicCheckout, {
          childList: true,
          subtree: true
        });
      }
      
    });
    
  })();
</script>

{% schema %}
  {
    "name": "Product Main",
    "class": "product-main-section",
    "settings": [
      {
        "type": "header",
        "content": "Product Information"
      },
      {
        "type": "checkbox",
        "id": "show_badges",
        "label": "Show Product Badges",
        "default": true,
        "info": "Configure badges using Product Badge blocks"
      },
      {
        "type": "text",
        "id": "product_title",
        "label": "Custom Product Title",
        "info": "Leave blank to use product title"
      },
      {
        "type": "textarea",
        "id": "product_subtitle",
        "label": "Product Subtitle",
        "info": "Tagline or description below title"
      }, {
        "type": "header",
        "content": "Pricing"
      }, {
        "type": "checkbox",
        "id": "show_mobile_price",
        "label": "Show Mobile Price",
        "default": true,
        "info": "Displays price below benefits on mobile"
      }, {
        "type": "checkbox",
        "id": "show_ativapeople_badge",
        "label": "Show AtivaPeople Badge",
        "default": true
      }, {
        "type": "html",
        "id": "ativapeople_badge_text",
        "label": "AtivaPeople Badge Text",
        "default": "Get an extra <strong>10% Off</strong> Join <a href=\"https://www.ativafit.com/pages/ativapeople-rewards-program\" target=\"_blank\">AtivaPeople</a>"
      }, {
        "type": "header",
        "content": "Pairs Well With"
      }, {
        "type": "checkbox",
        "id": "show_pairs_well_with",
        "label": "Show Pairs Well With Section",
        "default": true
      }, {
        "type": "text",
        "id": "pairs_well_with_title",
        "label": "Section Title",
        "default": "PAIRS WELL WITH"
      }, {
        "type": "checkbox",
        "id": "pairs_well_with_show_random",
        "label": "Show Random Products if No Blocks",
        "default": true,
        "info": "If no products are selected in blocks, show random products from the collection"
      }, {
        "type": "collection",
        "id": "pairs_well_with_collection",
        "label": "Collection for Random Products",
        "info": "Collection to pick random products from when no blocks are selected"
      }, {
        "type": "text",
        "id": "pairs_well_with_add_to_cart_text",
        "label": "Add to Cart Button Text",
        "default": "ADD TO CART",
        "info": "Used for the pairs well with section"
      }, {
        "type": "checkbox",
        "id": "pairs_well_with_auto_play",
        "label": "Auto Play Slider",
        "default": false,
        "info": "Automatically rotate through products"
      }, {
        "type": "range",
        "id": "pairs_well_with_auto_play_interval",
        "label": "Auto Play Interval (seconds)",
        "min": 3,
        "max": 10,
        "step": 1,
        "default": 5,
        "info": "Time between automatic slides"
      }, {
        "type": "header",
        "content": "Benefits Section"
      }, {
        "type": "checkbox",
        "id": "show_benefits",
        "label": "Show Benefits",
        "default": true,
        "info": "Configure individual benefits using Benefit blocks"
      }, {
        "type": "header",
        "content": "Variant Selector"
      }, {
        "type": "checkbox",
        "id": "show_variant_selector",
        "label": "Show Variant Selector",
        "default": true
      }, {
        "type": "text",
        "id": "variant_label",
        "label": "Variant Label",
        "default": "Select Option"
      }, {
        "type": "header",
        "content": "Quantity Selector"
      }, {
        "type": "checkbox",
        "id": "show_quantity_selector",
        "label": "Show Quantity Selector",
        "default": true
      }, {
        "type": "text",
        "id": "quantity_label",
        "label": "Quantity Label",
        "default": "Quantity"
      }, {
        "type": "header",
        "content": "Buttons"
      }, {
        "type": "text",
        "id": "add_to_cart_text",
        "label": "Add to Cart Button Text",
        "default": "Add to Cart",
        "info": "Used for main add to cart button (pairs well with section has its own setting)"
      }, {
        "type": "checkbox",
        "id": "show_buy_it_now",
        "label": "Show Buy It Now Button",
        "default": false,
        "info": "Adds a button that goes directly to checkout"
      }, {
        "type": "text",
        "id": "buy_it_now_text",
        "label": "Buy It Now Button Text",
        "default": "Buy It Now"
      }, {
        "type": "checkbox",
        "id": "remove_shop_pay_button",
        "label": "Remove Shop Pay Button",
        "default": false,
        "info": "Removes Shop Pay button from dynamic checkout buttons"
      }, {
        "type": "checkbox",
        "id": "show_ativapeople_cta",
        "label": "Show AtivaPeople CTA",
        "default": false
      }, {
        "type": "html",
        "id": "ativapeople_cta_text",
        "label": "AtivaPeople CTA Text",
        "default": "Join <a href=\"#\">AtivaPeople</a> for exclusive rewards"
      }, {
        "type": "header",
        "content": "Waitlist Button (Klaviyo)"
      }, {
        "type": "checkbox",
        "id": "show_waitlist_button",
        "label": "Show Join the Waitlist Button",
        "default": false,
        "info": "When enabled, replaces Add to Cart button with Waitlist button"
      }, {
        "type": "text",
        "id": "waitlist_button_text",
        "label": "Waitlist Button Text",
        "default": "Join the Waitlist"
      }, {
        "type": "text",
        "id": "klaviyo_form_id",
        "label": "Klaviyo Form ID",
        "info": "Enter the 6-digit Klaviyo form ID (e.g., Sr3xAi). Find this in your Klaviyo form editor URL."
      }, {
        "type": "text",
        "id": "waitlist_variant_ids",
        "label": "Waitlist Variants (Optional)",
        "info": "Comma-separated list of variant IDs or names that should show the waitlist button. Leave empty to show for all variants. Examples: 123456789,987654321 or Sunrise,Midnight"
      }
    ],
    "blocks": [
      {
        "type": "pairs_well_with_product",
        "name": "Pairs Well With Product",
        "settings": [
          {
            "type": "product",
            "id": "product",
            "label": "Product"
          }
        ]
      },
      {
        "type": "accordion_item",
        "name": "Accordion Item",
        "settings": [
          {
            "type": "text",
            "id": "title",
            "label": "Title",
            "default": "Accordion Title"
          },
          {
            "type": "select",
            "id": "content_type",
            "label": "Content Type",
            "options": [
              {
                "value": "text",
                "label": "Rich Text"
              }, {
                "value": "list",
                "label": "List Items"
              }
            ],
            "default": "text"
          },
          {
            "type": "richtext",
            "id": "text_content",
            "label": "Content",
            "info": "Used when Content Type is 'Rich Text'"
          },
          {
            "type": "html",
            "id": "item_1",
            "label": "List Item 1",
            "info": "Supports HTML. Used when Content Type is 'List Items'"
          }, {
            "type": "html",
            "id": "item_2",
            "label": "List Item 2"
          }, {
            "type": "html",
            "id": "item_3",
            "label": "List Item 3"
          }, {
            "type": "html",
            "id": "item_4",
            "label": "List Item 4"
          }, {
            "type": "html",
            "id": "item_5",
            "label": "List Item 5"
          }, {
            "type": "header",
            "content": "Optional Link"
          }, {
            "type": "checkbox",
            "id": "show_link",
            "label": "Show Link",
            "default": false
          }, {
            "type": "text",
            "id": "link_text",
            "label": "Link Text",
            "default": "Learn more"
          }, {
            "type": "url",
            "id": "link_url",
            "label": "Link URL"
          }
        ]
      },
      {
        "type": "benefit",
        "name": "Benefit",
        "settings": [
          {
            "type": "text",
            "id": "title",
            "label": "Benefit Title",
            "default": "Free Shipping within the U.S."
          },
          {
            "type": "textarea",
            "id": "description",
            "label": "Benefit Description",
            "default": "Standard shipping in 3–7 days."
          },
          {
            "type": "html",
            "id": "svg_icon",
            "label": "SVG Icon",
            "info": "Paste the complete SVG code"
          },
          {
            "type": "image_picker",
            "id": "icon_image",
            "label": "Icon Image (Legacy)",
            "info": "Old setting - Use SVG icon instead"
          }, {
            "type": "header",
            "content": "Popup Modal (Optional)"
          }, {
            "type": "text",
            "id": "popup_title",
            "label": "Popup Title",
            "info": "If filled, a 'Learn more' link will appear that opens a popup with this title"
          }, {
            "type": "richtext",
            "id": "popup_content",
            "label": "Popup Content",
            "info": "Content displayed in the popup modal. Supports HTML formatting."
          }, {
            "type": "header",
            "content": "External Link (Alternative to Popup)"
          }, {
            "type": "checkbox",
            "id": "show_learn_more",
            "label": "Show Learn More Link",
            "default": false,
            "info": "Only shows if popup_title is empty. Use popup_title for modal instead."
          }, {
            "type": "text",
            "id": "link_text",
            "label": "Link Text",
            "default": "Learn more"
          }, {
            "type": "url",
            "id": "link_url",
            "label": "Link URL"
          }
        ]
      },
      {
        "type": "payment_options",
        "name": "Payment Options",
        "settings": [
          {
            "type": "checkbox",
            "id": "show_dynamic_checkout",
            "label": "Show Dynamic Checkout Buttons",
            "info": "Displays Shop Pay, Apple Pay, Google Pay buttons",
            "default": true
          },
          {
            "type": "checkbox",
            "id": "show_payment_terms",
            "label": "Show Payment Terms",
            "info": "Displays Shop Pay Installments banner",
            "default": true
          },
          {
            "type": "html",
            "id": "payment_text",
            "label": "Payment Text",
            "default": "Pay your way. We accept a wide range of payment options for your convenience and security. Choose from express checkouts like Shop Pay, Apple Pay, Google Pay, and PayPal, or enjoy flexible payments with Klarna. We also proudly accept HSA/FSA accounts and Amazon Buy with Prime."
          },
          {
            "type": "checkbox",
            "id": "show_shop_pay_logo",
            "label": "Show Shop Pay Logo",
            "default": true
          }, {
            "type": "text",
            "id": "learn_more_text",
            "label": "Learn More Text",
            "default": "Learn more"
          }, {
            "type": "url",
            "id": "learn_more_url",
            "label": "Learn More URL"
          }, {
            "type": "checkbox",
            "id": "show_payment_icons",
            "label": "Show Payment Icons",
            "info": "Displays accepted payment method icons (Visa, Mastercard, etc.)",
            "default": true
          }, {
            "type": "text",
            "id": "payment_types_filter",
            "label": "Payment Types Filter",
            "info": "Comma-separated list of payment types to show (e.g., visa,master,american_express,paypal,shop_pay). Leave blank to show all enabled payment types."
          }
        ]
      }, {
        "type": "reviews",
        "name": "Reviews",
        "settings": [
          {
            "type": "checkbox",
            "id": "enabled",
            "label": "Show Reviews",
            "default": true
          }, {
            "type": "text",
            "id": "review_text",
            "label": "Review Text",
            "default": "4.7 (47 Reviews)"
          }
        ]
      }, {
        "type": "product_badge",
        "name": "Product Badge",
        "settings": [
          {
            "type": "text",
            "id": "badge_text",
            "label": "Badge Text",
            "default": "Built for Progress"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Product Main Section",
        "blocks": [
          {
            "type": "accordion_item",
            "settings": {
              "title": "Key Features",
              "content_type": "text"
            }
          }, {
            "type": "accordion_item",
            "settings": {
              "title": "Shipping & Returns",
              "content_type": "text"
            }
          }, {
            "type": "accordion_item",
            "settings": {
              "title": "Warranty & Support",
              "content_type": "text"
            }
          }
        ]
      }
    ]
  }
{% endschema %}