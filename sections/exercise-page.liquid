{%- style -%}
  .exercise-page {
    --primary: #eb701f;
    --primary-light: #f59a56;
    --primary-dark: #c55a12;
    --background: #fafafa;
    --surface: #ffffff;
    --text-primary: #1a1a1a;
    --text-secondary: #6b7280;
    --text-muted: #9ca3af;
    --border: #e5e7eb;
    --rating-empty: #e5e7eb;
    background-color: var(--background);
    color: var(--text-primary);
    font-family: var(--font-body-family, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif);
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
  }

  .exercise-page * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  .exercise-page__container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2.5rem 2rem;
  }

  .exercise-page__header {
    text-align: center;
    margin-bottom: 3rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--border);
  }

  .exercise-page__badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: #ffffff;
    padding: 0.5rem 1rem;
    border-radius: 50px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 1.5rem;
  }

  .exercise-page__badge svg {
    width: 14px;
    height: 14px;
  }

  .exercise-page__title {
    font-size: clamp(2.5rem, 5vw, 3.5rem);
    font-weight: 800;
    color: var(--text-primary);
    margin-bottom: 1rem;
    letter-spacing: -0.02em;
  }

  .exercise-page__title span {
    color: var(--primary);
  }

  .exercise-page__subtitle {
    font-size: 1.125rem;
    color: var(--text-secondary);
    max-width: 600px;
    margin: 0 auto !important;
    line-height: 1.7;
  }

  .exercise-page__target {
    margin-top: 1rem;
    font-size: 0.95rem;
    color: var(--text-secondary);
    display: flex;
    justify-content: center;
    gap: 0.4rem;
  }

  .exercise-page__target strong {
    color: var(--text-primary);
  }

  .exercise-page__section {
    background: var(--surface);
    border-radius: 20px;
    padding: 2.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    border: 1px solid var(--border);
  }

  .exercise-page__section-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .exercise-page__section-title::before {
    content: "";
    width: 4px;
    height: 24px;
    background: var(--primary);
    border-radius: 2px;
  }

  .exercise-page__description {
    color: var(--text-secondary);
    font-size: 1rem;
    line-height: 1.8;
  }

  .exercise-page__benefits {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1.5rem;
  }

  .exercise-page__benefit {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    background: var(--background);
    border-radius: 10px;
    font-size: 0.9rem;
    color: var(--text-primary);
    font-weight: 500;
  }

  .exercise-page__benefit-icon {
    width: 24px;
    height: 24px;
    background: var(--primary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .exercise-page__benefit-icon svg {
    width: 14px;
    height: 14px;
    color: #ffffff;
  }

  .exercise-page__ratings {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .exercise-page__rating-card {
    background: var(--surface);
    border-radius: 16px;
    padding: 1.75rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    border: 1px solid var(--border);
    transition: transform 0.2s ease
    , box-shadow 0.2s ease;
  }

  .exercise-page__rating-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(235, 112, 31, 0.1);
  }

  .exercise-page__rating-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.25rem;
  }

  .exercise-page__rating-icon {
    width: 64px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .exercise-page__rating-icon svg {
    width: 24px;
    height: 24px;
    color: #ffffff;
  }

  .exercise-page__rating-info h3 {
    font-size: 1rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.25rem !important;
  }

  .exercise-page__rating-info p {
    font-size: 0.8rem;
    color: var(--text-muted);
  }

  .exercise-page__rating-dots {
    display: flex;
    gap: 0;
    align-items: center;
  }

  .exercise-page__rating-dot {
    flex-shrink: 0;
    display: flex;
    align-items: center;
  }

  .exercise-page__rating-dot svg {
    display: block;
    height: 26px;
    width: auto;
  }

  .exercise-page__rating-dot:first-child svg {
    width: 61px;
  }

  .exercise-page__rating-dot:last-child svg {
    width: 63px;
  }

  .exercise-page__rating-dot:not(:first-child):not(:last-child) svg {
    width: 61px;
  }

  .exercise-page__rating-dot svg rect,
  .exercise-page__rating-dot svg path {
    transition: fill 0.3s ease;
  }

  .exercise-page__rating-dot:not(.is-active) svg rect,
  .exercise-page__rating-dot:not(.is-active) svg path {
    fill: #D9D9D9 !important;
  }

  .exercise-page__rating-dot.is-active svg rect,
  .exercise-page__rating-dot.is-active svg path {
    fill: var(--primary) !important;
  }

  .exercise-page__rating-value {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 0.75rem;
  }

  .exercise-page__rating-number {
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--primary);
  }

  .exercise-page__rating-max {
    font-size: 0.875rem;
    color: var(--text-muted);
  }

  .exercise-page__tutorial {
    margin-top: 3rem;
  }

  .exercise-page__tutorial-header {
    text-align: center;
    margin-bottom: 2.5rem;
  }

  .exercise-page__tutorial-header h2 {
    font-size: 1.75rem;
    font-weight: 800;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
  }

  .exercise-page__tutorial-header p {
    color: var(--text-secondary);
    font-size: 1rem;
  }

  .exercise-page__tutorial-grid {
    display: grid;
    gap: 2rem;
  }

  .exercise-page__tutorial-item {
    background: var(--surface);
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    border: 1px solid var(--border);
    display: grid;
    grid-template-columns: 1fr 1fr;
    transition: transform 0.2s ease
    , box-shadow 0.2s ease;
  }

  .exercise-page__tutorial-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 30px rgba(235, 112, 31, 0.12);
  }

  .exercise-page__tutorial-item--reverse {
    direction: rtl;
  }

  .exercise-page__tutorial-item--reverse > * {
    direction: ltr;
  }

  .exercise-page__tutorial-media {
    position: relative;
    background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .exercise-page__tutorial-media-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    min-height: 400px;
  }

  .exercise-page__tutorial-gallery {
    position: relative;
    width: 100%;
    height: 100%;
    min-height: 400px;
  }

  .exercise-page__tutorial-gallery-item {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .exercise-page__tutorial-gallery-item.is-active {
    position: relative;
    opacity: 1;
    z-index: 2;
  }

  .exercise-page__tutorial-gallery-item img {
    width: 100%;
    height: 100%;
    min-height: 100%;
    display: block;
    object-fit: cover;
  }

  .exercise-page__tutorial-media img {
    width: 100%;
    height: 100%;
    min-height: 100%;
    display: block;
    object-fit: cover;
  }

  .exercise-page__tutorial-thumbnails {
    position: absolute;
    bottom: 1rem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 0.5rem;
    z-index: 10;
    background: rgba(0, 0, 0, 0.5);
    padding: 0.5rem;
    border-radius: 8px;
  }

  .exercise-page__tutorial-thumbnail {
    width: 50px;
    height: 50px;
    border-radius: 4px;
    overflow: hidden;
    cursor: pointer;
    opacity: 0.6;
    transition: opacity 0.2s ease, transform 0.2s ease;
    border: 2px solid transparent;
  }

  .exercise-page__tutorial-thumbnail:hover {
    opacity: 1;
    transform: scale(1.1);
  }

  .exercise-page__tutorial-thumbnail.is-active {
    opacity: 1;
    border-color: var(--primary);
    transform: scale(1.1);
  }

  .exercise-page__tutorial-thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .exercise-page__tutorial-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 10;
    background: rgba(235, 112, 31, 0.9);
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s ease;
    font-size: 18px;
    line-height: 1;
  }

  .exercise-page__tutorial-nav:hover {
    background: var(--primary);
  }

  .exercise-page__tutorial-nav--prev {
    left: 1rem;
  }

  .exercise-page__tutorial-nav--next {
    right: 1rem;
  }

  .exercise-page__tutorial-nav:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .exercise-page__step-badge {
    position: absolute;
    top: 1rem;
    left: 1rem;
    background: var(--primary);
    color: #ffffff;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1rem;
    box-shadow: 0 4px 12px rgba(235, 112, 31, 0.3);
  }

  .exercise-page__tutorial-content {
    padding: 2rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .exercise-page__tutorial-content h3 {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.75rem;
  }

  .exercise-page__tutorial-content p {
    color: var(--text-secondary);
    font-size: 0.95rem;
    line-height: 1.7;
  }

  .exercise-page__tip {
    margin-top: 1rem;
    padding: 1rem;
    background: rgba(235, 112, 31, 0.08);
    border-radius: 10px;
    border-left: 3px solid var(--primary);
  }

  .exercise-page__tip span {
    font-weight: 600;
    color: var(--primary);
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .exercise-page__tip p {
    margin-top: 0.25rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
  }


  @media (max-width: 768px) {
    .exercise-page__container {
      padding: 1.5rem 1rem;
    }

    .exercise-page__tutorial-item {
      grid-template-columns: 1fr;
    }

    .exercise-page__tutorial-item--reverse {
      direction: ltr;
    }


    .exercise-page__ratings {
      grid-template-columns: 1fr;
    }

    .exercise-page__section {
      padding: 1.5rem;
    }
  }
{%- endstyle -%}

<section class="exercise-page">
  <div class="exercise-page__container">
    <header class="exercise-page__header">
      {%- if section.settings.badge_text != blank -%}
        <div class="exercise-page__badge">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
            aria-hidden="true">
            <path d="M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007.004-.003.001a.752.752 0 01-.704 0l-.003-.001z" />
          </svg>
          {{ section.settings.badge_text }}
        </div>
      {%- endif -%}
      {%- if section.settings.title != blank -%}
        <h1 class="exercise-page__title">
          {%- if section.settings.title_highlight != blank -%}
            {{ section.settings.title | replace: section.settings.title_highlight, '' | strip }}
            <span>{{ section.settings.title_highlight }}</span>
          {%- else -%}
            {{ section.settings.title }}
          {%- endif -%}
        </h1>
      {%- endif -%}
      {%- if section.settings.subtitle != blank -%}
        <p class="exercise-page__subtitle">
          {{ section.settings.subtitle }}
        </p>
      {%- endif -%}
      {%- if section.settings.target != blank -%}
        <p class="exercise-page__target">
          <strong>Target:</strong>
          <span>{{ section.settings.target }}</span>
        </p>
      {%- endif -%}
    </header>

    {%- if section.settings.about_title != blank or section.settings.about_description != blank or section.blocks.size > 0 -%}
      <section class="exercise-page__section">
        {%- if section.settings.about_title != blank -%}
          <h2 class="exercise-page__section-title">{{ section.settings.about_title }}</h2>
        {%- endif -%}
        {%- if section.settings.about_description != blank -%}
          <p class="exercise-page__description">
            {{ section.settings.about_description }}
          </p>
        {%- endif -%}
        {%- assign benefit_blocks = section.blocks | where: 'type', 'benefit' -%}
        {%- if benefit_blocks.size > 0 -%}
          <div class="exercise-page__benefits">
            {%- for block in benefit_blocks -%}
              <div class="exercise-page__benefit" {{ block.shopify_attributes }}>
                <div class="exercise-page__benefit-icon">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                    aria-hidden="true">
                    <path
                      fill-rule="evenodd"
                      d="M19.916 4.626a.75.75 0 01.208 1.04l-9 13.5a.75.75 0 01-1.154.114l-6-6a.75.75 0 011.06-1.06l5.353 5.353 8.493-12.739a.75.75 0 011.04-.208z"
                      clip-rule="evenodd" />
                  </svg>
                </div>
                {{ block.settings.text }}
              </div>
            {%- endfor -%}
          </div>
        {%- endif -%}
      </section>
    {%- endif -%}

    {%- assign rating_blocks = section.blocks | where: 'type', 'rating' -%}
    {%- if rating_blocks.size > 0 -%}
      <div class="exercise-page__ratings">
        {%- for block in rating_blocks -%}
          {%- assign rating_value = block.settings.rating_value | default: 5 | times: 1 -%}
          <article class="exercise-page__rating-card" {{ block.shopify_attributes }}>
            <div class="exercise-page__rating-header">
              <div class="exercise-page__rating-icon">
                {%- if block.settings.icon != blank -%}
                  <img
                    src="{{ block.settings.icon | image_url: width: 64 }}"
                    alt="{{ block.settings.title | default: 'Rating icon' }}"
                    width="64"
                    height="64"
                    loading="lazy">
                {%- endif -%}
              </div>
              <div class="exercise-page__rating-info">
                <h3>{{ block.settings.title }}</h3>
                <p>{{ block.settings.subtitle }}</p>
              </div>
            </div>
            <div class="exercise-page__rating-dots">
              {%- for i in (1..5) -%}
                {%- if i == 1 -%}
                  <div class="exercise-page__rating-dot {% if i <= rating_value %}is-active{% endif %}">
                    <svg width="61" height="26" viewBox="0 0 61 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <rect width="52.4478" height="26" rx="13" fill="{% if i <= rating_value %}#ff6100{% else %}#D9D9D9{% endif %}"></rect>
                      <path d="M30.0918 0H60.4002L51.4454 26H30.0918V0Z" fill="{% if i <= rating_value %}#ff6100{% else %}#D9D9D9{% endif %}"></path>
                    </svg>
                  </div>
                {%- elsif i == 5 -%}
                  <div class="exercise-page__rating-dot {% if i <= rating_value %}is-active{% endif %}">
                    <svg width="63" height="26" viewBox="0 0 63 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <rect x="63" y="26" width="52.4478" height="26" rx="13" transform="rotate(180 63 26)" fill="{% if i <= rating_value %}#ff6100{% else %}#D9D9D9{% endif %}"></rect>
                      <path d="M30.9082 26L0.599824 26L9.55457 1.31695e-06L30.9082 0L30.9082 26Z" fill="{% if i <= rating_value %}#ff6100{% else %}#D9D9D9{% endif %}"></path>
                    </svg>
                  </div>
                {%- else -%}
                  <div class="exercise-page__rating-dot {% if i <= rating_value %}is-active{% endif %}">
                    <svg width="61" height="26" viewBox="0 0 61 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M30.4912 -0.00012207H60.7996L51.8448 25.9999H30.4912V-0.00012207Z" fill="{% if i <= rating_value %}#ff6100{% else %}#D9D9D9{% endif %}"></path>
                      <path d="M32.4912 25.9999H0.399985L9.88148 -0.00012207H32.4912V25.9999Z" fill="{% if i <= rating_value %}#ff6100{% else %}#D9D9D9{% endif %}"></path>
                    </svg>
                  </div>
                {%- endif -%}
              {%- endfor -%}
            </div>
            <div class="exercise-page__rating-value">
              <span class="exercise-page__rating-number">{{ rating_value }}</span>
              <span>/ 5</span>
            </div>
          </article>
        {%- endfor -%}
      </div>
    {%- endif -%}

    <section class="exercise-page__tutorial">
      <div class="exercise-page__tutorial-header">
        <h2>Step-by-Step Tutorial</h2>
        <p>Follow each step carefully to perform the movement correctly.</p>
      </div>
      <div class="exercise-page__tutorial-grid">
        {%- assign tutorial_steps = section.blocks | where: 'type', 'tutorial_step' -%}
        {%- for step_block in tutorial_steps -%}
          {%- assign step_number = forloop.index | times: 1 -%}

          {%- assign image_count = 0 -%}
          {%- if step_block.settings.image != blank -%}{%- assign image_count = image_count | plus: 1 -%}{%- endif -%}
          {%- if step_block.settings.image_2 != blank -%}{%- assign image_count = image_count | plus: 1 -%}{%- endif -%}
          {%- if step_block.settings.image_3 != blank -%}{%- assign image_count = image_count | plus: 1 -%}{%- endif -%}
          {%- if step_block.settings.image_4 != blank -%}{%- assign image_count = image_count | plus: 1 -%}{%- endif -%}

          <article class="exercise-page__tutorial-item {% if step_block.settings.image_position == 'right' %}exercise-page__tutorial-item--reverse{% endif %}" {{ step_block.shopify_attributes }}>
            <div class="exercise-page__tutorial-media">
              <div class="exercise-page__step-badge">{{ step_number }}</div>

              {%- if image_count > 1 -%}
                <div class="exercise-page__tutorial-media-wrapper">
                  <div class="exercise-page__tutorial-gallery" data-step-gallery="{{ step_block.id }}">
                    {%- assign idx = 0 -%}

                    {%- if step_block.settings.image != blank -%}
                      <div class="exercise-page__tutorial-gallery-item {% if idx == 0 %}is-active{% endif %}" data-image-index="{{ idx }}">
                        <img
                          src="{{ step_block.settings.image | image_url: width: 1280 }}"
                          alt="{{ step_block.settings.alt_text | default: step_block.settings.title }}"
                          width="640"
                          height="480"
                          loading="{% if idx == 0 %}eager{% else %}lazy{% endif %}"
                          decoding="async">
                      </div>
                      {%- assign idx = idx | plus: 1 -%}
                    {%- endif -%}

                    {%- if step_block.settings.image_2 != blank -%}
                      <div class="exercise-page__tutorial-gallery-item {% if idx == 0 %}is-active{% endif %}" data-image-index="{{ idx }}">
                        <img
                          src="{{ step_block.settings.image_2 | image_url: width: 1280 }}"
                          alt="{{ step_block.settings.alt_text_2 | default: step_block.settings.alt_text | default: step_block.settings.title }}"
                          width="640"
                          height="480"
                          loading="{% if idx == 0 %}eager{% else %}lazy{% endif %}"
                          decoding="async">
                      </div>
                      {%- assign idx = idx | plus: 1 -%}
                    {%- endif -%}

                    {%- if step_block.settings.image_3 != blank -%}
                      <div class="exercise-page__tutorial-gallery-item {% if idx == 0 %}is-active{% endif %}" data-image-index="{{ idx }}">
                        <img
                          src="{{ step_block.settings.image_3 | image_url: width: 1280 }}"
                          alt="{{ step_block.settings.alt_text_3 | default: step_block.settings.alt_text | default: step_block.settings.title }}"
                          width="640"
                          height="480"
                          loading="{% if idx == 0 %}eager{% else %}lazy{% endif %}"
                          decoding="async">
                      </div>
                      {%- assign idx = idx | plus: 1 -%}
                    {%- endif -%}

                    {%- if step_block.settings.image_4 != blank -%}
                      <div class="exercise-page__tutorial-gallery-item {% if idx == 0 %}is-active{% endif %}" data-image-index="{{ idx }}">
                        <img
                          src="{{ step_block.settings.image_4 | image_url: width: 1280 }}"
                          alt="{{ step_block.settings.alt_text_4 | default: step_block.settings.alt_text | default: step_block.settings.title }}"
                          width="640"
                          height="480"
                          loading="{% if idx == 0 %}eager{% else %}lazy{% endif %}"
                          decoding="async">
                      </div>
                      {%- assign idx = idx | plus: 1 -%}
                    {%- endif -%}

                    <button type="button" class="exercise-page__tutorial-nav exercise-page__tutorial-nav--prev" aria-label="Previous image" data-nav="prev">‹</button>
                    <button type="button" class="exercise-page__tutorial-nav exercise-page__tutorial-nav--next" aria-label="Next image" data-nav="next">›</button>
                  </div>

                  <div class="exercise-page__tutorial-thumbnails">
                    {%- assign t = 0 -%}
                    {%- if step_block.settings.image != blank -%}
                      <button type="button" class="exercise-page__tutorial-thumbnail {% if t == 0 %}is-active{% endif %}" data-thumbnail-index="{{ t }}" aria-label="View image {{ t | plus: 1 }}">
                        <img src="{{ step_block.settings.image | image_url: width: 100 }}" alt="" width="50" height="50" loading="lazy" decoding="async">
                      </button>
                      {%- assign t = t | plus: 1 -%}
                    {%- endif -%}
                    {%- if step_block.settings.image_2 != blank -%}
                      <button type="button" class="exercise-page__tutorial-thumbnail {% if t == 0 %}is-active{% endif %}" data-thumbnail-index="{{ t }}" aria-label="View image {{ t | plus: 1 }}">
                        <img src="{{ step_block.settings.image_2 | image_url: width: 100 }}" alt="" width="50" height="50" loading="lazy" decoding="async">
                      </button>
                      {%- assign t = t | plus: 1 -%}
                    {%- endif -%}
                    {%- if step_block.settings.image_3 != blank -%}
                      <button type="button" class="exercise-page__tutorial-thumbnail {% if t == 0 %}is-active{% endif %}" data-thumbnail-index="{{ t }}" aria-label="View image {{ t | plus: 1 }}">
                        <img src="{{ step_block.settings.image_3 | image_url: width: 100 }}" alt="" width="50" height="50" loading="lazy" decoding="async">
                      </button>
                      {%- assign t = t | plus: 1 -%}
                    {%- endif -%}
                    {%- if step_block.settings.image_4 != blank -%}
                      <button type="button" class="exercise-page__tutorial-thumbnail {% if t == 0 %}is-active{% endif %}" data-thumbnail-index="{{ t }}" aria-label="View image {{ t | plus: 1 }}">
                        <img src="{{ step_block.settings.image_4 | image_url: width: 100 }}" alt="" width="50" height="50" loading="lazy" decoding="async">
                      </button>
                      {%- assign t = t | plus: 1 -%}
                    {%- endif -%}
                  </div>
                </div>

              {%- elsif image_count == 1 -%}
                {%- if step_block.settings.image != blank -%}
                  <img
                    src="{{ step_block.settings.image | image_url: width: 1280 }}"
                    alt="{{ step_block.settings.alt_text | default: step_block.settings.title }}"
                    width="640"
                    height="480"
                    loading="lazy"
                    decoding="async">
                {%- elsif step_block.settings.image_2 != blank -%}
                  <img
                    src="{{ step_block.settings.image_2 | image_url: width: 1280 }}"
                    alt="{{ step_block.settings.alt_text_2 | default: step_block.settings.alt_text | default: step_block.settings.title }}"
                    width="640"
                    height="480"
                    loading="lazy"
                    decoding="async">
                {%- elsif step_block.settings.image_3 != blank -%}
                  <img
                    src="{{ step_block.settings.image_3 | image_url: width: 1280 }}"
                    alt="{{ step_block.settings.alt_text_3 | default: step_block.settings.alt_text | default: step_block.settings.title }}"
                    width="640"
                    height="480"
                    loading="lazy"
                    decoding="async">
                {%- elsif step_block.settings.image_4 != blank -%}
                  <img
                    src="{{ step_block.settings.image_4 | image_url: width: 1280 }}"
                    alt="{{ step_block.settings.alt_text_4 | default: step_block.settings.alt_text | default: step_block.settings.title }}"
                    width="640"
                    height="480"
                    loading="lazy"
                    decoding="async">
                {%- endif -%}
              {%- endif -%}
            </div>
            <div class="exercise-page__tutorial-content">
              <h3>{{ step_block.settings.title | default: 'Step' | append: ' ' | append: step_number }}</h3>
              {%- if step_block.settings.description != blank -%}
                <p>{{ step_block.settings.description }}</p>
              {%- endif -%}
              {%- if step_block.settings.note != blank -%}
                <div class="exercise-page__tip">
                  <span>Note</span>
                  <p>{{ step_block.settings.note }}</p>
                </div>
              {%- endif -%}
              {%- if step_block.settings.caution != blank -%}
                <div class="exercise-page__tip">
                  <span>Caution</span>
                  <p>{{ step_block.settings.caution }}</p>
                </div>
              {%- endif -%}
            </div>
          </article>
        {%- endfor -%}
      </div>
    </section>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const galleries = document.querySelectorAll('[data-step-gallery]');
    
    galleries.forEach(gallery => {
      const images = gallery.querySelectorAll('.exercise-page__tutorial-gallery-item');
      const wrapper = gallery.closest('.exercise-page__tutorial-media-wrapper');
      const thumbnails = wrapper?.querySelectorAll('.exercise-page__tutorial-thumbnail') || [];
      const prevBtn = gallery.querySelector('[data-nav="prev"]');
      const nextBtn = gallery.querySelector('[data-nav="next"]');
      let currentIndex = 0;
      
      if (images.length <= 1) {
        if (prevBtn) prevBtn.style.display = 'none';
        if (nextBtn) nextBtn.style.display = 'none';
        if (thumbnails.length > 0) {
          thumbnails[0].parentElement.style.display = 'none';
        }
        return;
      }
      
      function showImage(index) {
        images.forEach((img, i) => {
          img.classList.toggle('is-active', i === index);
        });
        thumbnails.forEach((thumb, i) => {
          thumb.classList.toggle('is-active', i === index);
        });
        currentIndex = index;
        
        if (prevBtn) prevBtn.disabled = index === 0;
        if (nextBtn) nextBtn.disabled = index === images.length - 1;
      }
      
      if (prevBtn) {
        prevBtn.addEventListener('click', () => {
          if (currentIndex > 0) {
            showImage(currentIndex - 1);
          }
        });
      }
      
      if (nextBtn) {
        nextBtn.addEventListener('click', () => {
          if (currentIndex < images.length - 1) {
            showImage(currentIndex + 1);
          }
        });
      }
      
      thumbnails.forEach((thumb, index) => {
        thumb.addEventListener('click', () => {
          showImage(index);
        });
      });
      
      showImage(0);
    });
  });
</script>

{% schema %}
  {
    "name": "Exercise Page",
    "tag": "section",
    "class": "exercise-page-section",
    "settings": [
      {
        "type": "header",
        "content": "Header Content"
      },
      {
        "type": "text",
        "id": "badge_text",
        "label": "Badge Text",
        "default": "Upper Body Exercise"
      },
      {
        "type": "text",
        "id": "title",
        "label": "Exercise Title",
        "default": "Bicep Curls"
      },
      {
        "type": "text",
        "id": "title_highlight",
        "label": "Title Highlight Word",
        "info": "Word to highlight in orange (e.g., 'Curls' in 'Bicep Curls')",
        "default": "Curls"
      },
      {
        "type": "textarea",
        "id": "subtitle",
        "label": "Subtitle",
        "default": "A classic isolation exercise to build arm strength and definition. Perfect for controlled reps and strong bicep engagement."
      },
      {
        "type": "text",
        "id": "target",
        "label": "Target Muscle",
        "default": "Biceps"
      },
      {
        "type": "header",
        "content": "About Section"
      },
      {
        "type": "text",
        "id": "about_title",
        "label": "About Section Title",
        "default": "About the Exercise"
      },
      {
        "type": "textarea",
        "id": "about_description",
        "label": "About Description",
        "default": "Bicep curls isolate the biceps to build strength, size, and definition in the upper arms. Focus on slow, controlled reps to keep tension on the muscle and avoid using momentum. This movement is great for beginners and advanced lifters alike, especially when paired with strict form and proper breathing."
      }
    ],
    "blocks": [
      {
        "type": "benefit",
        "name": "Benefit",
        "settings": [
          {
            "type": "text",
            "id": "text",
            "label": "Benefit Text",
            "default": "Builds bicep strength"
          }
        ]
      },
      {
        "type": "rating",
        "name": "Rating",
        "settings": [
          {
            "type": "image_picker",
            "id": "icon",
            "label": "Icon"
          },
          {
            "type": "text",
            "id": "title",
            "label": "Title",
            "default": "Muscle & Strength"
          },
          {
            "type": "text",
            "id": "subtitle",
            "label": "Subtitle",
            "default": "Muscle-building impact"
          },
          {
            "type": "range",
            "id": "rating_value",
            "label": "Rating Value",
            "min": 1,
            "max": 5,
            "step": 1,
            "default": 5,
            "info": "Rating from 1 to 5"
          }
        ]
      },
      {
        "type": "tutorial_step",
        "name": "Tutorial Step",
        "settings": [
          {
            "type": "image_picker",
            "id": "image",
            "label": "Main GIF/Image"
          },
          {
            "type": "image_picker",
            "id": "image_2",
            "label": "Extra GIF/Image 2 (Optional)"
          },
          {
            "type": "image_picker",
            "id": "image_3",
            "label": "Extra GIF/Image 3 (Optional)"
          },
          {
            "type": "image_picker",
            "id": "image_4",
            "label": "Extra GIF/Image 4 (Optional)"
          },
          {
            "type": "text",
            "id": "title",
            "label": "Step Title",
            "default": "Step"
          },
          {
            "type": "textarea",
            "id": "description",
            "label": "Description",
            "default": "Step description goes here"
          },
          {
            "type": "textarea",
            "id": "note",
            "label": "Note (Optional)",
            "info": "Additional tip or note for this step"
          }, {
            "type": "textarea",
            "id": "caution",
            "label": "Caution (Optional)",
            "info": "Warning or caution message for this step"
          }, {
            "type": "text",
            "id": "alt_text",
            "label": "Image Alt Text",
            "default": "Exercise step"
          }, {
            "type": "text",
            "id": "alt_text_2",
            "label": "Alt Text (Image 2)",
            "default": "Exercise step (image 2)"
          }, {
            "type": "text",
            "id": "alt_text_3",
            "label": "Alt Text (Image 3)",
            "default": "Exercise step (image 3)"
          }, {
            "type": "text",
            "id": "alt_text_4",
            "label": "Alt Text (Image 4)",
            "default": "Exercise step (image 4)"
          }, {
            "type": "select",
            "id": "image_position",
            "label": "Image Position",
            "options": [
              {
                "value": "left",
                "label": "Left"
              }, {
                "value": "right",
                "label": "Right"
              }
            ],
            "default": "left",
            "info": "Choose which side the image appears on"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Exercise Page",
        "settings": {
          "badge_text": "Upper Body Exercise",
          "title": "Bicep Curls",
          "title_highlight": "Curls",
          "subtitle": "A classic isolation exercise to build arm strength and definition. Perfect for controlled reps and strong bicep engagement.",
          "target": "Biceps",
          "about_title": "About the Exercise",
          "about_description": "Bicep curls isolate the biceps to build strength, size, and definition in the upper arms. Focus on slow, controlled reps to keep tension on the muscle and avoid using momentum. This movement is great for beginners and advanced lifters alike, especially when paired with strict form and proper breathing."
        },
        "blocks": [
          {
            "type": "benefit",
            "settings": {
              "text": "Builds bicep strength"
            }
          },
          {
            "type": "benefit",
            "settings": {
              "text": "Improves arm definition"
            }
          },
          {
            "type": "benefit",
            "settings": {
              "text": "Enhances elbow control"
            }
          },
          {
            "type": "benefit",
            "settings": {
              "text": "Reinforces grip stability"
            }
          },
          {
            "type": "rating",
            "settings": {
              "title": "Muscle & Strength",
              "subtitle": "Muscle-building impact",
              "rating_value": 5
            }
          },
          {
            "type": "rating",
            "settings": {
              "title": "Cardio & Endurance",
              "subtitle": "Cardiovascular demand",
              "rating_value": 3
            }
          },
          {
            "type": "rating",
            "settings": {
              "title": "Flexibility & Mobility",
              "subtitle": "Range-of-motion demand",
              "rating_value": 4
            }
          },
          {
            "type": "tutorial_step",
            "settings": {
              "title": "Step 1",
              "description": "Stand holding weights, palms up, and slowly curl them toward your shoulders while squeezing the biceps at the top.",
              "note": "Control the weights as you lower them fully back down to the starting position.",
              "caution": "Avoid swinging your body to lift the weight; keep tension on the biceps.",
              "image_position": "left"
            }
          },
          {
            "type": "tutorial_step",
            "settings": {
              "title": "Step 2",
              "description": "Stand holding weights, palms up, and slowly curl them toward your shoulders while squeezing the biceps at the top.",
              "note": "Control the weights as you lower them fully back down to the starting position.",
              "caution": "Avoid swinging your body to lift the weight; keep tension on the biceps.",
              "image_position": "right"
            }
          }
        ]
      }
    ]
  }
{% endschema %}