{%- style -%}
  .exercise-page {
    --primary: #eb701f;
    --primary-light: #f59a56;
    --primary-dark: #c55a12;
    --background: #ffffff;
    --surface: #fafafa;
    --text-primary: #1a1a1a;
    --text-secondary: #6b7280;
    --text-muted: #9ca3af;
    --border: #e5e7eb;
    --spacing: 3rem;
    background-color: #ffffff;
    color: var(--text-primary);
    font-family: var(--font-body-family, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif);
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    counter-increment: exercise-counter;
  }

  /* Alternating colors for exercises */
  /* Since exercise_group_intro is first, exercise-page sections start at nth-of-type(2) */
  .exercise-page {
    background-color: #ffffff;
  }

  /* Odd exercise-page sections (1st, 3rd, 5th exercise) - white */
  .exercise-page:nth-of-type(2),
  .exercise-page:nth-of-type(4),
  .exercise-page:nth-of-type(6) {
    background-color: #ffffff;
  }

  /* Even exercise-page sections (2nd, 4th, 6th exercise) - light gray */
  .exercise-page:nth-of-type(3),
  .exercise-page:nth-of-type(5),
  .exercise-page:nth-of-type(7) {
    background-color: #f8f9fa;
  }

  .exercise-page * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  .exercise-page__container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 4rem 1.5rem 5rem;
  }

  /* Separation between exercises */
  .exercise-page + .exercise-page {
    margin-top: 0;
    padding-top: 5rem;
  }

  .exercise-page:first-of-type .exercise-page__container {
    padding-top: 4rem;
  }

  .exercise-page__container {
    position: relative;
  }

  /* Header - Nike/Adidas Style */
  .exercise-page__header {
    text-align: left;
    margin-bottom: 2.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--border);
  }

  .exercise-page__badge {
    display: inline-block;
    background: transparent;
    color: var(--primary);
    padding: 0;
    border-radius: 0;
    font-size: 0.65rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    margin-bottom: 0.75rem;
  }

  .exercise-page__badge svg {
    display: none;
  }

  .exercise-page__title {
    font-size: clamp(2.25rem, 5vw, 3.5rem);
    font-weight: 800;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    letter-spacing: -0.03em;
    line-height: 1.1;
  }

  .exercise-page__title span {
    color: var(--primary);
  }

  .exercise-page__subtitle {
    font-size: 0.95rem;
    color: var(--text-secondary);
    max-width: 650px;
    margin: 0;
    line-height: 1.5;
    margin-bottom: 0.75rem;
    font-weight: 400;
  }

  .exercise-page__target {
    margin-top: 0.75rem;
    font-size: 0.8rem;
    color: var(--text-muted);
    display: flex;
    justify-content: flex-start;
    gap: 0.4rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 600;
  }

  .exercise-page__target strong {
    color: var(--text-primary);
    font-weight: 700;
  }

  /* About Section - Nike/Adidas Style */
  .exercise-page__section {
    background: transparent;
    padding: 0;
    margin-bottom: 2rem;
  }

  .exercise-page__section-title {
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--text-muted);
    margin-bottom: 1rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
  }

  .exercise-page__description {
    color: var(--text-primary);
    font-size: 0.95rem;
    line-height: 1.7;
    font-weight: 400;
    max-width: 700px;
  }

  /* Ratings - Nike/Adidas Style */
  .exercise-page__ratings {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 0;
    margin-bottom: 2rem;
    border-top: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
  }

  .exercise-page__rating-card {
    background: transparent;
    border-radius: 0;
    padding: 1.5rem 1rem;
    border: none;
    border-right: 1px solid var(--border);
  }

  .exercise-page__rating-card:last-child {
    border-right: none;
  }

  .exercise-page__rating-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
  }

  .exercise-page__rating-icon {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .exercise-page__rating-icon img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .exercise-page__rating-info h3 {
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--text-muted);
    margin-bottom: 0.125rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .exercise-page__rating-info p {
    font-size: 0.7rem;
    color: var(--text-muted);
    font-weight: 400;
  }

  .exercise-page__rating-dots {
    display: flex;
    gap: 0;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .exercise-page__rating-dot {
    flex-shrink: 0;
    display: flex;
    align-items: center;
  }

  .exercise-page__rating-dot svg {
    display: block;
    height: 18px;
    width: auto;
  }

  .exercise-page__rating-dot:first-child svg {
    width: 44px;
  }

  .exercise-page__rating-dot:last-child svg {
    width: 46px;
  }

  .exercise-page__rating-dot:not(:first-child):not(:last-child) svg {
    width: 44px;
  }

  .exercise-page__rating-dot svg rect,
  .exercise-page__rating-dot svg path {
    transition: fill 0.2s ease;
  }

  .exercise-page__rating-dot:not(.is-active) svg rect,
  .exercise-page__rating-dot:not(.is-active) svg path {
    fill: #E5E5E5 !important;
  }

  .exercise-page__rating-dot.is-active svg rect,
  .exercise-page__rating-dot.is-active svg path {
    fill: var(--primary) !important;
  }

  .exercise-page__rating-value {
    display: flex;
    align-items: baseline;
    gap: 0.25rem;
  }

  .exercise-page__rating-number {
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--text-primary);
    letter-spacing: -0.02em;
  }

  .exercise-page__rating-value span:last-child {
    font-size: 0.875rem;
    color: var(--text-muted);
    font-weight: 400;
  }

  /* Tutorial Section - Clean Layout */
  .exercise-page__tutorial {
    margin-top: var(--spacing);
  }

  .exercise-page__tutorial-header {
    text-align: left;
    margin-bottom: 2rem;
  }

  .exercise-page__tutorial-header h2 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    letter-spacing: -0.01em;
  }

  .exercise-page__tutorial-header p {
    color: var(--text-secondary);
    font-size: 0.9rem;
  }

  .exercise-page__tutorial-grid {
    display: grid;
    gap: 2rem;
  }

  .exercise-page__tutorial-item {
    background: var(--surface);
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid var(--border);
    display: grid;
    grid-template-columns: 1fr 1fr;
  }

  .exercise-page__tutorial-item--reverse {
    direction: rtl;
  }

  .exercise-page__tutorial-item--reverse > * {
    direction: ltr;
  }

  .exercise-page__tutorial-media {
    position: relative;
    background: #f3f4f6;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .exercise-page__tutorial-media-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    min-height: 350px;
  }

  .exercise-page__tutorial-gallery {
    position: relative;
    width: 100%;
    height: 100%;
    min-height: 350px;
  }

  .exercise-page__tutorial-gallery-item {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .exercise-page__tutorial-gallery-item.is-active {
    position: relative;
    opacity: 1;
    z-index: 2;
  }

  .exercise-page__tutorial-gallery-item img {
    width: 100%;
    height: 100%;
    min-height: 100%;
    display: block;
    object-fit: cover;
  }

  .exercise-page__tutorial-media img {
    width: 100%;
    height: 100%;
    min-height: 100%;
    display: block;
    object-fit: cover;
  }

  .exercise-page__tutorial-gallery-item video,
  .exercise-page__video {
    width: 100%;
    height: 100%;
    min-height: 100%;
    display: block;
    object-fit: cover;
    background: #000;
  }

  .exercise-page__video-poster {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    pointer-events: none;
  }

  .exercise-page__tutorial-thumbnails {
    position: absolute;
    bottom: 1rem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 0.5rem;
    z-index: 10;
    background: rgba(0, 0, 0, 0.6);
    padding: 0.5rem;
    border-radius: 6px;
  }

  .exercise-page__tutorial-thumbnail {
    width: 40px;
    height: 40px;
    border-radius: 4px;
    overflow: hidden;
    cursor: pointer;
    opacity: 0.6;
    transition: opacity 0.2s ease;
    border: 2px solid transparent;
  }

  .exercise-page__tutorial-thumbnail:hover {
    opacity: 1;
  }

  .exercise-page__tutorial-thumbnail.is-active {
    opacity: 1;
    border-color: var(--primary);
  }

  .exercise-page__tutorial-thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .exercise-page__tutorial-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 10;
    background: rgba(235, 112, 31, 0.85);
    color: white;
    border: none;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s ease;
    font-size: 16px;
    line-height: 1;
  }

  .exercise-page__tutorial-nav:hover {
    background: var(--primary);
  }

  .exercise-page__tutorial-nav--prev {
    left: 0.75rem;
  }

  .exercise-page__tutorial-nav--next {
    right: 0.75rem;
  }

  .exercise-page__tutorial-nav:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .exercise-page__step-badge {
    position: absolute;
    top: 0.75rem;
    left: 0.75rem;
    background: var(--primary);
    color: #ffffff;
    width: 32px;
    height: 32px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 0.875rem;
    z-index: 5;
  }

  .exercise-page__tutorial-content {
    padding: 1.75rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .exercise-page__tutorial-content h3 {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.75rem;
    letter-spacing: -0.01em;
  }

  .exercise-page__tutorial-content p {
    color: var(--text-secondary);
    font-size: 0.9rem;
    line-height: 1.6;
    margin-bottom: 1rem;
  }

  .exercise-page__tip {
    margin-top: 0.75rem;
    padding: 0.875rem;
    background: rgba(235, 112, 31, 0.06);
    border-radius: 8px;
    border-left: 3px solid var(--primary);
  }

  .exercise-page__tip span {
    font-weight: 600;
    color: var(--primary);
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    display: block;
    margin-bottom: 0.25rem;
  }

  .exercise-page__tip p {
    margin: 0;
    font-size: 0.85rem;
    color: var(--text-secondary);
    line-height: 1.5;
  }


  @media (max-width: 768px) {
    .exercise-page__container {
      padding: 2.5rem 1rem 3.5rem;
    }

    .exercise-page + .exercise-page {
      padding-top: 3.5rem;
    }

    .exercise-page:first-of-type .exercise-page__container {
      padding-top: 2.5rem;
    }

    .exercise-page__header {
      margin-bottom: 2rem;
      padding-bottom: 1.25rem;
    }

    .exercise-page__title {
      font-size: clamp(1.75rem, 6vw, 2.5rem);
    }

    .exercise-page__tutorial-item {
      grid-template-columns: 1fr;
    }

    .exercise-page__tutorial-item--reverse {
      direction: ltr;
    }

    .exercise-page__ratings {
      grid-template-columns: 1fr;
      border-left: none;
      border-right: none;
    }

    .exercise-page__rating-card {
      border-right: none;
      border-bottom: 1px solid var(--border);
      padding: 1.25rem 0;
    }

    .exercise-page__rating-card:last-child {
      border-bottom: none;
    }

    .exercise-page__tutorial-content {
      padding: 1.5rem;
    }

    .exercise-page__tutorial-media-wrapper,
    .exercise-page__tutorial-gallery {
      min-height: 280px;
    }
  }
{%- endstyle -%}

<section class="exercise-page" data-exercise-index>
  <div class="exercise-page__container">
    <header class="exercise-page__header">
      {%- if section.settings.badge_text != blank -%}
        <div class="exercise-page__badge">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
            aria-hidden="true">
            <path d="M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007.004-.003.001a.752.752 0 01-.704 0l-.003-.001z" />
          </svg>
          {{ section.settings.badge_text }}
        </div>
      {%- endif -%}
      {%- if section.settings.title != blank -%}
        <h1 class="exercise-page__title">
          {%- if section.settings.title_highlight != blank -%}
            {{ section.settings.title | replace: section.settings.title_highlight, '' | strip }}
            <span>{{ section.settings.title_highlight }}</span>
          {%- else -%}
            {{ section.settings.title }}
          {%- endif -%}
        </h1>
      {%- endif -%}
      {%- if section.settings.subtitle != blank -%}
        <p class="exercise-page__subtitle">
          {{ section.settings.subtitle }}
        </p>
      {%- endif -%}
      {%- if section.settings.target != blank -%}
        <p class="exercise-page__target">
          <strong>Target:</strong>
          <span>{{ section.settings.target }}</span>
        </p>
      {%- endif -%}
    </header>

    {%- if section.settings.about_title != blank or section.settings.about_description != blank -%}
      <section class="exercise-page__section">
        {%- if section.settings.about_title != blank -%}
          <h2 class="exercise-page__section-title">{{ section.settings.about_title }}</h2>
        {%- endif -%}
        {%- if section.settings.about_description != blank -%}
          <p class="exercise-page__description">
            {{ section.settings.about_description }}
          </p>
        {%- endif -%}
      </section>
    {%- endif -%}

    {%- assign rating_blocks = section.blocks | where: 'type', 'rating' -%}
    {%- if rating_blocks.size > 0 -%}
      <div class="exercise-page__ratings">
        {%- for block in rating_blocks -%}
          {%- assign rating_value = block.settings.rating_value | default: 5 | times: 1 -%}
          <article class="exercise-page__rating-card" {{ block.shopify_attributes }}>
            <div class="exercise-page__rating-header">
              <div class="exercise-page__rating-icon">
                {%- assign rating_title = block.settings.title | downcase -%}
                {%- if rating_title contains 'muscle' or rating_title contains 'strength' -%}
                  {%- assign icon_url = 'https://cdn.shopify.com/s/files/1/2623/4904/files/Screenshot_2025-08-01_020520_150x.png?v=1754024731' -%}
                {%- elsif rating_title contains 'cardio' or rating_title contains 'endurance' -%}
                  {%- assign icon_url = 'https://cdn.shopify.com/s/files/1/2623/4904/files/Screenshot_2025-08-01_020534_150x.png?v=1754024740' -%}
                {%- elsif rating_title contains 'flexibility' or rating_title contains 'mobility' -%}
                  {%- assign icon_url = 'https://cdn.shopify.com/s/files/1/2623/4904/files/Screenshot_2025-08-01_020547_150x.png?v=1754024757' -%}
                {%- else -%}
                  {%- assign icon_url = 'https://cdn.shopify.com/s/files/1/2623/4904/files/Screenshot_2025-08-01_020520_150x.png?v=1754024731' -%}
                {%- endif -%}
                <img
                  src="{{ icon_url }}"
                  alt="{{ block.settings.title | default: 'Rating icon' }}"
                  width="48"
                  height="48"
                  loading="lazy"
                  decoding="async">
              </div>
              <div class="exercise-page__rating-info">
                <h3>{{ block.settings.title }}</h3>
                <p>{{ block.settings.subtitle }}</p>
              </div>
            </div>
            <div class="exercise-page__rating-dots">
              {%- for i in (1..5) -%}
                {%- if i == 1 -%}
                  <div class="exercise-page__rating-dot {% if i <= rating_value %}is-active{% endif %}">
                    <svg width="61" height="26" viewBox="0 0 61 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <rect width="52.4478" height="26" rx="13" fill="{% if i <= rating_value %}#eb701f{% else %}#D9D9D9{% endif %}"></rect>
                      <path d="M30.0918 0H60.4002L51.4454 26H30.0918V0Z" fill="{% if i <= rating_value %}#eb701f{% else %}#D9D9D9{% endif %}"></path>
                    </svg>
                  </div>
                {%- elsif i == 5 -%}
                  <div class="exercise-page__rating-dot {% if i <= rating_value %}is-active{% endif %}">
                    <svg width="63" height="26" viewBox="0 0 63 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <rect x="63" y="26" width="52.4478" height="26" rx="13" transform="rotate(180 63 26)" fill="{% if i <= rating_value %}#eb701f{% else %}#D9D9D9{% endif %}"></rect>
                      <path d="M30.9082 26L0.599824 26L9.55457 1.31695e-06L30.9082 0L30.9082 26Z" fill="{% if i <= rating_value %}#eb701f{% else %}#D9D9D9{% endif %}"></path>
                    </svg>
                  </div>
                {%- else -%}
                  <div class="exercise-page__rating-dot {% if i <= rating_value %}is-active{% endif %}">
                    <svg width="61" height="26" viewBox="0 0 61 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M30.4912 -0.00012207H60.7996L51.8448 25.9999H30.4912V-0.00012207Z" fill="{% if i <= rating_value %}#eb701f{% else %}#D9D9D9{% endif %}"></path>
                      <path d="M32.4912 25.9999H0.399985L9.88148 -0.00012207H32.4912V25.9999Z" fill="{% if i <= rating_value %}#eb701f{% else %}#D9D9D9{% endif %}"></path>
                    </svg>
                  </div>
                {%- endif -%}
              {%- endfor -%}
            </div>
            <div class="exercise-page__rating-value">
              <span class="exercise-page__rating-number">{{ rating_value }}</span>
              <span>/ 5</span>
            </div>
          </article>
        {%- endfor -%}
      </div>
    {%- endif -%}

    <section class="exercise-page__tutorial">
      <div class="exercise-page__tutorial-header">
        <h2>Step-by-Step Tutorial</h2>
        <p>Follow each step carefully to perform the movement correctly.</p>
      </div>
      <div class="exercise-page__tutorial-grid">
        {%- assign tutorial_steps = section.blocks | where: 'type', 'tutorial_step' -%}
        {%- for step_block in tutorial_steps -%}
          {%- assign step_number = forloop.index | times: 1 -%}

          {%- assign image_count = 0 -%}
          {%- if step_block.settings.image != blank or step_block.settings.video_url != blank -%}{%- assign image_count = image_count | plus: 1 -%}{%- endif -%}
          {%- if step_block.settings.image_2 != blank or step_block.settings.video_url_2 != blank -%}{%- assign image_count = image_count | plus: 1 -%}{%- endif -%}
          {%- if step_block.settings.image_3 != blank or step_block.settings.video_url_3 != blank -%}{%- assign image_count = image_count | plus: 1 -%}{%- endif -%}
          {%- if step_block.settings.image_4 != blank or step_block.settings.video_url_4 != blank -%}{%- assign image_count = image_count | plus: 1 -%}{%- endif -%}

          <article class="exercise-page__tutorial-item {% if step_block.settings.image_position == 'right' %}exercise-page__tutorial-item--reverse{% endif %}" {{ step_block.shopify_attributes }}>
            <div class="exercise-page__tutorial-media">
              <div class="exercise-page__step-badge">{{ step_number }}</div>

              {%- if image_count > 1 -%}
                <div class="exercise-page__tutorial-media-wrapper">
                  <div class="exercise-page__tutorial-gallery" data-step-gallery="{{ step_block.id }}">
                    {%- assign idx = 0 -%}

                    {%- if step_block.settings.image != blank or step_block.settings.video_url != blank -%}
                      <div class="exercise-page__tutorial-gallery-item {% if idx == 0 %}is-active{% endif %}" data-image-index="{{ idx }}">
                        {%- liquid
                          if idx == 0
                            assign load_type = 'eager'
                          else
                            assign load_type = 'lazy'
                          endif
                        -%}
                        {% render 'exercise-media',
                          image: step_block.settings.image,
                          video_url: step_block.settings.video_url,
                          alt_text: step_block.settings.alt_text | default: step_block.settings.title,
                          width: 1280,
                          height: 480,
                          loading: load_type,
                          class_name: '' %}
                      </div>
                      {%- assign idx = idx | plus: 1 -%}
                    {%- endif -%}

                    {%- if step_block.settings.image_2 != blank or step_block.settings.video_url_2 != blank -%}
                      <div class="exercise-page__tutorial-gallery-item {% if idx == 0 %}is-active{% endif %}" data-image-index="{{ idx }}">
                        {%- liquid
                          if idx == 0
                            assign load_type = 'eager'
                          else
                            assign load_type = 'lazy'
                          endif
                        -%}
                        {% render 'exercise-media',
                          image: step_block.settings.image_2,
                          video_url: step_block.settings.video_url_2,
                          alt_text: step_block.settings.alt_text_2 | default: step_block.settings.alt_text | default: step_block.settings.title,
                          width: 1280,
                          height: 480,
                          loading: load_type,
                          class_name: '' %}
                      </div>
                      {%- assign idx = idx | plus: 1 -%}
                    {%- endif -%}

                    {%- if step_block.settings.image_3 != blank or step_block.settings.video_url_3 != blank -%}
                      <div class="exercise-page__tutorial-gallery-item {% if idx == 0 %}is-active{% endif %}" data-image-index="{{ idx }}">
                        {%- liquid
                          if idx == 0
                            assign load_type = 'eager'
                          else
                            assign load_type = 'lazy'
                          endif
                        -%}
                        {% render 'exercise-media',
                          image: step_block.settings.image_3,
                          video_url: step_block.settings.video_url_3,
                          alt_text: step_block.settings.alt_text_3 | default: step_block.settings.alt_text | default: step_block.settings.title,
                          width: 1280,
                          height: 480,
                          loading: load_type,
                          class_name: '' %}
                      </div>
                      {%- assign idx = idx | plus: 1 -%}
                    {%- endif -%}

                    {%- if step_block.settings.image_4 != blank or step_block.settings.video_url_4 != blank -%}
                      <div class="exercise-page__tutorial-gallery-item {% if idx == 0 %}is-active{% endif %}" data-image-index="{{ idx }}">
                        {%- liquid
                          if idx == 0
                            assign load_type = 'eager'
                          else
                            assign load_type = 'lazy'
                          endif
                        -%}
                        {% render 'exercise-media',
                          image: step_block.settings.image_4,
                          video_url: step_block.settings.video_url_4,
                          alt_text: step_block.settings.alt_text_4 | default: step_block.settings.alt_text | default: step_block.settings.title,
                          width: 1280,
                          height: 480,
                          loading: load_type,
                          class_name: '' %}
                      </div>
                      {%- assign idx = idx | plus: 1 -%}
                    {%- endif -%}

                    <button type="button" class="exercise-page__tutorial-nav exercise-page__tutorial-nav--prev" aria-label="Previous image" data-nav="prev">‹</button>
                    <button type="button" class="exercise-page__tutorial-nav exercise-page__tutorial-nav--next" aria-label="Next image" data-nav="next">›</button>
                  </div>

                  <div class="exercise-page__tutorial-thumbnails">
                    {%- assign t = 0 -%}
                    {%- if step_block.settings.image != blank -%}
                      <button type="button" class="exercise-page__tutorial-thumbnail {% if t == 0 %}is-active{% endif %}" data-thumbnail-index="{{ t }}" aria-label="View image {{ t | plus: 1 }}">
                        <img src="{{ step_block.settings.image | image_url: width: 100 }}" alt="" width="40" height="40" loading="lazy" decoding="async">
                      </button>
                      {%- assign t = t | plus: 1 -%}
                    {%- endif -%}
                    {%- if step_block.settings.image_2 != blank -%}
                      <button type="button" class="exercise-page__tutorial-thumbnail {% if t == 0 %}is-active{% endif %}" data-thumbnail-index="{{ t }}" aria-label="View image {{ t | plus: 1 }}">
                        <img src="{{ step_block.settings.image_2 | image_url: width: 100 }}" alt="" width="40" height="40" loading="lazy" decoding="async">
                      </button>
                      {%- assign t = t | plus: 1 -%}
                    {%- endif -%}
                    {%- if step_block.settings.image_3 != blank -%}
                      <button type="button" class="exercise-page__tutorial-thumbnail {% if t == 0 %}is-active{% endif %}" data-thumbnail-index="{{ t }}" aria-label="View image {{ t | plus: 1 }}">
                        <img src="{{ step_block.settings.image_3 | image_url: width: 100 }}" alt="" width="40" height="40" loading="lazy" decoding="async">
                      </button>
                      {%- assign t = t | plus: 1 -%}
                    {%- endif -%}
                    {%- if step_block.settings.image_4 != blank -%}
                      <button type="button" class="exercise-page__tutorial-thumbnail {% if t == 0 %}is-active{% endif %}" data-thumbnail-index="{{ t }}" aria-label="View image {{ t | plus: 1 }}">
                        <img src="{{ step_block.settings.image_4 | image_url: width: 100 }}" alt="" width="40" height="40" loading="lazy" decoding="async">
                      </button>
                      {%- assign t = t | plus: 1 -%}
                    {%- endif -%}
                  </div>
                </div>

              {%- elsif image_count == 1 -%}
                {%- if step_block.settings.image != blank or step_block.settings.video_url != blank -%}
                  {% render 'exercise-media',
                    image: step_block.settings.image,
                    video_url: step_block.settings.video_url,
                    alt_text: step_block.settings.alt_text | default: step_block.settings.title,
                    width: 1280,
                    height: 480,
                    loading: 'lazy',
                    class_name: '' %}
                {%- elsif step_block.settings.image_2 != blank or step_block.settings.video_url_2 != blank -%}
                  {% render 'exercise-media',
                    image: step_block.settings.image_2,
                    video_url: step_block.settings.video_url_2,
                    alt_text: step_block.settings.alt_text_2 | default: step_block.settings.alt_text | default: step_block.settings.title,
                    width: 1280,
                    height: 480,
                    loading: 'lazy',
                    class_name: '' %}
                {%- elsif step_block.settings.image_3 != blank or step_block.settings.video_url_3 != blank -%}
                  {% render 'exercise-media',
                    image: step_block.settings.image_3,
                    video_url: step_block.settings.video_url_3,
                    alt_text: step_block.settings.alt_text_3 | default: step_block.settings.alt_text | default: step_block.settings.title,
                    width: 1280,
                    height: 480,
                    loading: 'lazy',
                    class_name: '' %}
                {%- elsif step_block.settings.image_4 != blank or step_block.settings.video_url_4 != blank -%}
                  {% render 'exercise-media',
                    image: step_block.settings.image_4,
                    video_url: step_block.settings.video_url_4,
                    alt_text: step_block.settings.alt_text_4 | default: step_block.settings.alt_text | default: step_block.settings.title,
                    width: 1280,
                    height: 480,
                    loading: 'lazy',
                    class_name: '' %}
                {%- endif -%}
              {%- endif -%}
            </div>
            <div class="exercise-page__tutorial-content">
              <h3>{{ step_block.settings.title | default: 'Step' | append: ' ' | append: step_number }}</h3>
              {%- if step_block.settings.description != blank -%}
                <p>{{ step_block.settings.description }}</p>
              {%- endif -%}
              {%- if step_block.settings.note != blank -%}
                <div class="exercise-page__tip">
                  <span>Note</span>
                  <p>{{ step_block.settings.note }}</p>
                </div>
              {%- endif -%}
              {%- if step_block.settings.caution != blank -%}
                <div class="exercise-page__tip">
                  <span>Caution</span>
                  <p>{{ step_block.settings.caution }}</p>
                </div>
              {%- endif -%}
            </div>
          </article>
        {%- endfor -%}
      </div>
    </section>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Apply alternating colors to exercise sections
    const exerciseSections = document.querySelectorAll('.exercise-page');
    exerciseSections.forEach((section, index) => {
      if (index % 2 === 0) {
        section.style.backgroundColor = '#ffffff';
      } else {
        section.style.backgroundColor = '#f8f9fa';
      }
    });

    const galleries = document.querySelectorAll('[data-step-gallery]');
    
    galleries.forEach(gallery => {
      const images = gallery.querySelectorAll('.exercise-page__tutorial-gallery-item');
      const wrapper = gallery.closest('.exercise-page__tutorial-media-wrapper');
      const thumbnails = wrapper?.querySelectorAll('.exercise-page__tutorial-thumbnail') || [];
      const prevBtn = gallery.querySelector('[data-nav="prev"]');
      const nextBtn = gallery.querySelector('[data-nav="next"]');
      let currentIndex = 0;
      
      if (images.length <= 1) {
        if (prevBtn) prevBtn.style.display = 'none';
        if (nextBtn) nextBtn.style.display = 'none';
        if (thumbnails.length > 0) {
          thumbnails[0].parentElement.style.display = 'none';
        }
        return;
      }
      
      function showImage(index) {
        images.forEach((img, i) => {
          const isActive = i === index;
          img.classList.toggle('is-active', isActive);
          
          // Pause videos when not active, play when active
          const video = img.querySelector('video');
          if (video) {
            if (isActive) {
              video.play().catch(() => {
                // Ignore autoplay errors
              });
            } else {
              video.pause();
            }
          }
        });
        thumbnails.forEach((thumb, i) => {
          thumb.classList.toggle('is-active', i === index);
        });
        currentIndex = index;
        
        if (prevBtn) prevBtn.disabled = index === 0;
        if (nextBtn) nextBtn.disabled = index === images.length - 1;
      }
      
      if (prevBtn) {
        prevBtn.addEventListener('click', () => {
          if (currentIndex > 0) {
            showImage(currentIndex - 1);
          }
        });
      }
      
      if (nextBtn) {
        nextBtn.addEventListener('click', () => {
          if (currentIndex < images.length - 1) {
            showImage(currentIndex + 1);
          }
        });
      }
      
      thumbnails.forEach((thumb, index) => {
        thumb.addEventListener('click', () => {
          showImage(index);
        });
      });
      
      showImage(0);
    });
  });
</script>

{% schema %}
  {
    "name": "Exercise Page",
    "tag": "section",
    "class": "exercise-page-section",
    "settings": [
      {
        "type": "header",
        "content": "Header Content"
      },
      {
        "type": "text",
        "id": "badge_text",
        "label": "Badge Text",
        "default": "Upper Body Exercise"
      },
      {
        "type": "text",
        "id": "title",
        "label": "Exercise Title",
        "default": "Bicep Curls"
      },
      {
        "type": "text",
        "id": "title_highlight",
        "label": "Title Highlight Word",
        "info": "Word to highlight in orange (e.g., 'Curls' in 'Bicep Curls')",
        "default": "Curls"
      },
      {
        "type": "textarea",
        "id": "subtitle",
        "label": "Subtitle",
        "default": "A classic isolation exercise to build arm strength and definition. Perfect for controlled reps and strong bicep engagement."
      },
      {
        "type": "text",
        "id": "target",
        "label": "Target Muscle",
        "default": "Biceps"
      },
      {
        "type": "header",
        "content": "About Section"
      },
      {
        "type": "text",
        "id": "about_title",
        "label": "About Section Title",
        "default": "About the Exercise"
      },
      {
        "type": "textarea",
        "id": "about_description",
        "label": "About Description",
        "default": "Bicep curls isolate the biceps to build strength, size, and definition in the upper arms. Focus on slow, controlled reps to keep tension on the muscle and avoid using momentum. This movement is great for beginners and advanced lifters alike, especially when paired with strict form and proper breathing."
      }
    ],
    "blocks": [
      {
        "type": "rating",
        "name": "Rating",
        "settings": [
          {
            "type": "paragraph",
            "content": "Icons are automatically assigned based on rating title: 'Muscle & Strength', 'Cardio & Endurance', or 'Flexibility & Mobility'"
          },
          {
            "type": "text",
            "id": "title",
            "label": "Title",
            "default": "Muscle & Strength"
          },
          {
            "type": "text",
            "id": "subtitle",
            "label": "Subtitle",
            "default": "Muscle-building impact"
          },
          {
            "type": "range",
            "id": "rating_value",
            "label": "Rating Value",
            "min": 1,
            "max": 5,
            "step": 1,
            "default": 5,
            "info": "Rating from 1 to 5"
          }
        ]
      },
      {
        "type": "tutorial_step",
        "name": "Tutorial Step",
        "settings": [
          {
            "type": "image_picker",
            "id": "image",
            "label": "Main GIF/Image"
          },
          {
            "type": "url",
            "id": "video_url",
            "label": "Main Video URL (MP4) - Optional",
            "info": "If provided, video will be shown instead of image. Supports MP4 format."
          },
          {
            "type": "image_picker",
            "id": "image_2",
            "label": "Extra GIF/Image 2 (Optional)"
          },
          {
            "type": "url",
            "id": "video_url_2",
            "label": "Video 2 URL (MP4) - Optional",
            "info": "If provided, video will be shown instead of image 2."
          },
          {
            "type": "image_picker",
            "id": "image_3",
            "label": "Extra GIF/Image 3 (Optional)"
          },
          {
            "type": "url",
            "id": "video_url_3",
            "label": "Video 3 URL (MP4) - Optional",
            "info": "If provided, video will be shown instead of image 3."
          },
          {
            "type": "image_picker",
            "id": "image_4",
            "label": "Extra GIF/Image 4 (Optional)"
          },
          {
            "type": "url",
            "id": "video_url_4",
            "label": "Video 4 URL (MP4) - Optional",
            "info": "If provided, video will be shown instead of image 4."
          },
          {
            "type": "text",
            "id": "title",
            "label": "Step Title",
            "default": "Step"
          },
          {
            "type": "textarea",
            "id": "description",
            "label": "Description",
            "default": "Step description goes here"
          },
          {
            "type": "textarea",
            "id": "note",
            "label": "Note (Optional)",
            "info": "Additional tip or note for this step"
          },
          {
            "type": "textarea",
            "id": "caution",
            "label": "Caution (Optional)",
            "info": "Warning or caution message for this step"
          },
          {
            "type": "text",
            "id": "alt_text",
            "label": "Image Alt Text",
            "default": "Exercise step"
          },
          {
            "type": "text",
            "id": "alt_text_2",
            "label": "Alt Text (Image 2)",
            "default": "Exercise step (image 2)"
          },
          {
            "type": "text",
            "id": "alt_text_3",
            "label": "Alt Text (Image 3)",
            "default": "Exercise step (image 3)"
          },
          {
            "type": "text",
            "id": "alt_text_4",
            "label": "Alt Text (Image 4)",
            "default": "Exercise step (image 4)"
          },
          {
            "type": "select",
            "id": "image_position",
            "label": "Image Position",
            "options": [
              {
                "value": "left",
                "label": "Left"
              },
              {
                "value": "right",
                "label": "Right"
              }
            ],
            "default": "left",
            "info": "Choose which side the image appears on"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Exercise Page"
      }
    ]
  }
{% endschema %}
