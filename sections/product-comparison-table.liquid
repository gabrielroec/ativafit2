{%- liquid
  assign product_1 = all_products['27-5-lbs-adjustable-weight-dumbbell']
  assign product_2 = all_products['50lbs']
  assign product_3 = all_products['66lbs']
  assign product_4 = all_products['88lbs']

  # Product 1 specs (27.5LBS DUMBBELL SET GT528)
  assign product_1_weightRange = '5.5 - 27.5 lbs'
  assign product_1_increments = '5.5 lbs'
  assign product_1_dimensions = '16.2"L x 7.2"W x 7.2"H'
  assign product_1_packageWeight = '32 lbs (single)'
  assign product_1_material = 'Steel plates, reinforced base'
  assign product_1_handleDesign = 'Steel core, non-slip rubber grip'
  assign product_1_adjustment = 'Glide Tech'
  assign product_1_userGroup = 'Beginners, home toning'

  # Product 2 specs (50LBS DUMBBELL SET)
  assign product_2_weightRange = '5 - 50 lbs'
  assign product_2_increments = '5 lbs'
  assign product_2_dimensions = '16.7"L x 8.2"W x 7.7"H'
  assign product_2_packageWeight = '-'
  assign product_2_material = 'Steel plates, reinforced base'
  assign product_2_handleDesign = 'Steel core, non-slip rubber grip'
  assign product_2_adjustment = 'Dial Tech'
  assign product_2_userGroup = 'General fitness, multi-purpose use'

  # Product 3 specs (66LBS DUMBBELL SET DT1166)
  assign product_3_weightRange = '11 - 66 lbs'
  assign product_3_increments = '5 lbs'
  assign product_3_dimensions = '16.2"L x 7.2"W x 7.2"H'
  assign product_3_packageWeight = '145 lbs (set)'
  assign product_3_material = 'Steel plates, reinforced base'
  assign product_3_handleDesign = 'Steel core, ergonomic design'
  assign product_3_adjustment = 'Dial Tech'
  assign product_3_userGroup = 'General fitness, multi-purpose use'

  # Product 4 specs (88LBS DUMBBELL SET DT1188)
  assign product_4_weightRange = '11 - 88 lbs'
  assign product_4_increments = '7 lbs'
  assign product_4_dimensions = '16.2"L x 8"W x 8"H'
  assign product_4_packageWeight = '99 lbs (single), 188lbs (set)'
  assign product_4_material = 'Steel plates, reinforced base'
  assign product_4_handleDesign = 'Steel core, ergonomic design'
  assign product_4_adjustment = 'Dial Tech'
  assign product_4_userGroup = 'Advanced training, pro-level workouts'
-%}

{%- style -%}
  .product-comparison {
    --brand: #eb701f;
    --border: #e5e7eb;
    --background: #ffffff;
    --muted-foreground: #6b7280;
    --foreground: #1a1a1a;
    --hover-bg: #fff8f3;
    --row-bg: #f8f8f8;
    width: 100%;
    position: relative;
  }

  .product-comparison__container {
    position: relative;
  }

  .product-comparison__scroll-hint {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
    font-size: 0.875rem;
    color: var(--muted-foreground);
  }

  @media (min-width: 1024px) {
    .product-comparison__scroll-hint {
      display: none;
    }
  }

  .product-comparison__table-wrapper {
    overflow-x: auto;
    scrollbar-width: none;
    -ms-overflow-style: none;
    scroll-behavior: smooth;
  }

  .product-comparison__container {
    max-width: 1740px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .product-comparison__table-wrapper::-webkit-scrollbar {
    display: none;
  }

  .product-comparison__table {
    min-width: 800px;
    width: 100%;
  }

  @media (min-width: 1024px) {
    .product-comparison__table {
      min-width: 0;
      width: 100%;
    }
  }

  .product-comparison__grid {
    display: grid;
    grid-template-columns: 140px repeat(4, minmax(160px, 1fr));
    width: 100%;
  }

  @media (min-width: 768px) {
    .product-comparison__grid {
      grid-template-columns: 160px repeat(4, minmax(180px, 1fr));
    }
  }

  @media (min-width: 1024px) {
    .product-comparison__grid {
      grid-template-columns: 180px repeat(4, 1fr);
    }
  }

  .product-comparison__label-cell {
    display: flex;
    align-items: center;
    padding: 1rem 0.5rem;
    position: sticky;
    left: 0;
    background: var(--background);
    z-index: 10;
  }

  .product-comparison__label-cell--header {
    padding-bottom: 1rem;
    align-items: flex-end;
  }

  .product-comparison__label-text {
    color: var(--brand);
    font-weight: 500;
    font-size: 1rem;
  }

  .product-comparison__label-text--spec {
    font-size: 0.875rem;
  }

  .product-comparison__product-card {
    position: relative;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }

  .product-comparison__product-card:hover,
  .product-comparison__product-card.is-hovered {
    background: var(--hover-bg);
  }

  .product-comparison__product-border {
    position: absolute;
    inset: 0;
    pointer-events: none;
    transition: border-color 0.2s ease
    , border-radius 0.2s ease;
    border: 2px solid transparent;
  }

  .product-comparison__product-card:hover .product-comparison__product-border,
  .product-comparison__product-card.is-hovered .product-comparison__product-border {
    border-color: var(--brand);
    border-bottom-color: transparent;
    border-radius: 0.5rem 0.5rem 0 0;
  }

  .product-comparison__product-top-bar {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--brand);
    border-radius: 0.5rem 0.5rem 0 0;
    display: none;
  }


  /*
   .product-comparison__product-card:hover .product-comparison__product-top-bar,
   .product-comparison__product-card.is-hovered .product-comparison__product-top-bar {
   display: block;
   }
*/

  .product-comparison__badge {
    position: absolute;
    top: 0.75rem;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10;
    display: none;
  }

  .product-comparison__product-card:hover .product-comparison__badge,
  .product-comparison__product-card.is-hovered .product-comparison__badge {
    display: block;
  }

  .product-comparison__badge-text {
    background: var(--brand);
    color: white;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.375rem 1rem;
    border-radius: 9999px;
    white-space: nowrap;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .product-comparison__product-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 3rem 1rem 1rem;
    position: relative;
  }

  .product-comparison__product-image {
    position: relative;
    width: 100%;
    aspect-ratio: 4 / 3;
    margin-bottom: 1rem;
  }

  .product-comparison__product-image img {
    width: 100%;
    height: 100%;
    aspect-ratio: 4 / 3;
    object-fit: contain;
  }

  .product-comparison__product-title {
    font-size: 22px !important;
    font-weight: 700;
    color: var(--foreground);
    text-align: center;
    line-height: 1.25;
    margin-bottom: 1rem;
  }

  .product-comparison__product-cta {
    display: none;
    width: 100%;
    max-width: 200px;
    background: var(--brand);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 0.75rem 1.5rem;
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-top: 0.5rem;
  }

  .product-comparison__product-cta:hover {
    background: #d65a0f;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(235, 112, 31, 0.3);
  }

  .product-comparison__product-cta:active {
    transform: translateY(0);
  }

  .product-comparison__product-cta:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .product-comparison__product-card:hover .product-comparison__product-cta,
  .product-comparison__product-card.is-hovered .product-comparison__product-cta {
    display: block;
  }

  @media (max-width: 1023px) {
    .product-comparison__product-cta {
      display: block;
      font-size: 12px !important;
    }
  }

  .product-comparison__spec-cell {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    text-align: center;
    font-size: 0.875rem;
    color: var(--foreground);
    transition: background-color 0.2s ease;
  }

  .product-comparison__spec-cell--even {
    background: var(--row-bg);
  }

  .product-comparison__spec-cell--odd {
    background: var(--background);
  }

  .product-comparison__spec-cell:hover,
  .product-comparison__spec-cell.is-hovered {
    background: var(--hover-bg);
  }

  .product-comparison__spec-border {
    position: absolute;
    inset: 0;
    pointer-events: none;
    transition: border-color 0.2s ease
    , border-radius 0.2s ease;
    border-left: 2px solid transparent;
    border-right: 2px solid transparent;
  }

  .product-comparison__spec-cell:hover .product-comparison__spec-border,
  .product-comparison__spec-cell.is-hovered .product-comparison__spec-border {
    border-left-color: var(--brand);
    border-right-color: var(--brand);
  }

  .product-comparison__spec-cell--last .product-comparison__spec-border {
    border-bottom: 2px solid transparent;
    border-radius: 0 0 0.5rem 0.5rem;
  }

  .product-comparison__spec-cell--last:hover .product-comparison__spec-border,
  .product-comparison__spec-cell--last.is-hovered .product-comparison__spec-border {
    border-bottom-color: var(--brand);
  }

  .product-comparison__spec-value {
    position: relative;
    z-index: 1;
  }

  .product-comparison__scroll-indicators {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin-top: 1rem;
  }

  @media (min-width: 1024px) {
    .product-comparison__scroll-indicators {
      display: none;
    }
  }

  .product-comparison__indicator {
    width: 0.5rem;
    height: 0.5rem;
    border-radius: 9999px;
    transition: background-color 0.2s ease
    , width 0.2s ease;
    background: rgba(107, 114, 128, 0.3);
    cursor: pointer;
    border: none;
    padding: 0;
  }

  .product-comparison__indicator:hover {
    background: rgba(107, 114, 128, 0.5);
  }

  .product-comparison__indicator--active {
    background: var(--brand);
    width: 1rem;
  }

  @media (max-width: 1024px) {
    .product-comparison__product-title {
      font-size: 16px !important;
    }
    .product-comparison__label-cell--header,
    .product-comparison__label-cell,
    .product-comparison__spec-cell {
      padding: 8px !important;
    }
  }
{%- endstyle -%}

<section class="product-comparison" data-section-id="{{ section.id }}">
  <div class="product-comparison__container">
    {%- if product_1 != blank or product_2 != blank or product_3 != blank or product_4 != blank -%}

      <!-- Table Container -->
      <div class="product-comparison__table-wrapper" data-scroll-container>
        <div class="product-comparison__table">
          <div class="product-comparison__grid">
            <!-- Header Row - Model Label + Product Cards -->
            <div class="product-comparison__label-cell product-comparison__label-cell--header">
              <span class="product-comparison__label-text">Model</span>
            </div>

            {%- if product_1 != blank -%}
              {%- assign product = product_1 -%}
                <div
                class="product-comparison__product-card"
                data-product-id="{{ product.id }}"
                data-product-handle="{{ product.handle }}">
                <!-- Border container -->
                <div class="product-comparison__product-border"></div>

                <!-- Top border bar for hovered state -->
                <div class="product-comparison__product-top-bar"></div>

                <!-- You Are Viewing Badge -->
                <div class="product-comparison__badge">
                  <span class="product-comparison__badge-text">You Are Viewing</span>
                </div>

                <!-- Product Image -->
                <div class="product-comparison__product-content">
                  <div class="product-comparison__product-image">
                    {%- if product.featured_image -%}
                      {{
                        product.featured_image | image_url: width: 400 | image_tag: loading: 'lazy', alt: product.title, class: 'product-comparison__product-image-img'
                      }}
                    {%- else -%}
                      {{ 'image' | placeholder_svg_tag: 'product-comparison__product-image-img' }}
                    {%- endif -%}
                  </div>
                  <h3 class="product-comparison__product-title">{{ product.title }}</h3>
                  <button
                    class="product-comparison__product-cta"
                    type="button"
                    data-add-to-cart
                    data-product-id="{{ product.id }}"
                    data-variant-id="{{ product.selected_or_first_available_variant.id }}"
                    data-product-handle="{{ product.handle }}">
                    Add to Cart
                  </button>
                </div>
              </div>
            {%- endif -%}
            {%- if product_2 != blank -%}
              {%- assign product = product_2 -%}
                <div
                class="product-comparison__product-card"
                data-product-id="{{ product.id }}"
                data-product-handle="{{ product.handle }}">
                <!-- Border container -->
                <div class="product-comparison__product-border"></div>

                <!-- Top border bar for hovered state -->
                <div class="product-comparison__product-top-bar"></div>

                <!-- You Are Viewing Badge -->
                <div class="product-comparison__badge">
                  <span class="product-comparison__badge-text">You Are Viewing</span>
                </div>

                <!-- Product Image -->
                <div class="product-comparison__product-content">
                  <div class="product-comparison__product-image">
                    {%- if product.featured_image -%}
                      {{
                        product.featured_image | image_url: width: 400 | image_tag: loading: 'lazy', alt: product.title, class: 'product-comparison__product-image-img'
                      }}
                    {%- else -%}
                      {{ 'image' | placeholder_svg_tag: 'product-comparison__product-image-img' }}
                    {%- endif -%}
                  </div>
                  <h3 class="product-comparison__product-title">{{ product.title }}</h3>
                  <button
                    class="product-comparison__product-cta"
                    type="button"
                    data-add-to-cart
                    data-product-id="{{ product.id }}"
                    data-variant-id="{{ product.selected_or_first_available_variant.id }}"
                    data-product-handle="{{ product.handle }}">
                    Add to Cart
                  </button>
                </div>
              </div>
            {%- endif -%}
            {%- if product_3 != blank -%}
              {%- assign product = product_3 -%}
                <div
                class="product-comparison__product-card"
                data-product-id="{{ product.id }}"
                data-product-handle="{{ product.handle }}">
                <!-- Border container -->
                <div class="product-comparison__product-border"></div>

                <!-- Top border bar for hovered state -->
                <div class="product-comparison__product-top-bar"></div>

                <!-- You Are Viewing Badge -->
                <div class="product-comparison__badge">
                  <span class="product-comparison__badge-text">You Are Viewing</span>
                </div>

                <!-- Product Image -->
                <div class="product-comparison__product-content">
                  <div class="product-comparison__product-image">
                    {%- if product.featured_image -%}
                      {{
                        product.featured_image | image_url: width: 400 | image_tag: loading: 'lazy', alt: product.title, class: 'product-comparison__product-image-img'
                      }}
                    {%- else -%}
                      {{ 'image' | placeholder_svg_tag: 'product-comparison__product-image-img' }}
                    {%- endif -%}
                  </div>
                  <h3 class="product-comparison__product-title">{{ product.title }}</h3>
                  <button
                    class="product-comparison__product-cta"
                    type="button"
                    data-add-to-cart
                    data-product-id="{{ product.id }}"
                    data-variant-id="{{ product.selected_or_first_available_variant.id }}"
                    data-product-handle="{{ product.handle }}">
                    Add to Cart
                  </button>
                </div>
              </div>
            {%- endif -%}
            {%- if product_4 != blank -%}
              {%- assign product = product_4 -%}
                <div
                class="product-comparison__product-card"
                data-product-id="{{ product.id }}"
                data-product-handle="{{ product.handle }}">
                <!-- Border container -->
                <div class="product-comparison__product-border"></div>

                <!-- Top border bar for hovered state -->
                <div class="product-comparison__product-top-bar"></div>

                <!-- You Are Viewing Badge -->
                <div class="product-comparison__badge">
                  <span class="product-comparison__badge-text">You Are Viewing</span>
                </div>

                <!-- Product Image -->
                <div class="product-comparison__product-content">
                  <div class="product-comparison__product-image">
                    {%- if product.featured_image -%}
                      {{
                        product.featured_image | image_url: width: 400 | image_tag: loading: 'lazy', alt: product.title, class: 'product-comparison__product-image-img'
                      }}
                    {%- else -%}
                      {{ 'image' | placeholder_svg_tag: 'product-comparison__product-image-img' }}
                    {%- endif -%}
                  </div>
                  <h3 class="product-comparison__product-title">{{ product.title }}</h3>
                  <button
                    class="product-comparison__product-cta"
                    type="button"
                    data-add-to-cart
                    data-product-id="{{ product.id }}"
                    data-variant-id="{{ product.selected_or_first_available_variant.id }}"
                    data-product-handle="{{ product.handle }}">
                    Add to Cart
                  </button>
                </div>
              </div>
          {%- endif -%}

            <!-- Spec Rows -->
            {%- assign spec_keys = 'weightRange,increments,dimensions,packageWeight,material,handleDesign,adjustment,userGroup' | split: ',' -%}
            {%- assign spec_labels = 'Weight Range,Increments,Dimensions,Package Weight,Material,Handle Design,Adjustment,User Group' | split: ',' -%}

            {%- for spec_key in spec_keys -%}
              {%- assign spec_index = forloop.index0 -%}
              {%- assign spec_label = spec_labels[spec_index] -%}
              {%- assign is_last_row = false -%}
              {%- if forloop.last -%}
                {%- assign is_last_row = true -%}
              {%- endif -%}

              <div class="product-comparison__label-cell {% if spec_index == 0 or spec_index == 2 or spec_index == 4 or spec_index == 6 %}product-comparison__label-cell--even{% else %}product-comparison__label-cell--odd{% endif %}">
                <span class="product-comparison__label-text product-comparison__label-text--spec">
                  {{ spec_label }}
                </span>
              </div>

              {%- if product_1 != blank -%}
                {%- liquid
                  assign spec_value = '-'
                  case spec_key
                    when 'weightRange'
                      assign spec_value = product_1_weightRange
                    when 'increments'
                      assign spec_value = product_1_increments
                    when 'dimensions'
                      assign spec_value = product_1_dimensions
                    when 'packageWeight'
                      assign spec_value = product_1_packageWeight
                    when 'material'
                      assign spec_value = product_1_material
                    when 'handleDesign'
                      assign spec_value = product_1_handleDesign
                    when 'adjustment'
                      assign spec_value = product_1_adjustment
                    when 'userGroup'
                      assign spec_value = product_1_userGroup
                  endcase
                -%}
                <div class="product-comparison__spec-cell {% if spec_index == 0 or spec_index == 2 or spec_index == 4 or spec_index == 6 %}product-comparison__spec-cell--even{% else %}product-comparison__spec-cell--odd{% endif %} {% if is_last_row %}product-comparison__spec-cell--last{% endif %}" data-product-id="{{ product_1.id }}">
                  <!-- Side borders -->
                  <div class="product-comparison__spec-border"></div>
                  <span class="product-comparison__spec-value">{{ spec_value }}</span>
                </div>
              {%- endif -%}
              {%- if product_2 != blank -%}
                {%- liquid
                  assign spec_value = '-'
                  case spec_key
                    when 'weightRange'
                      assign spec_value = product_2_weightRange
                    when 'increments'
                      assign spec_value = product_2_increments
                    when 'dimensions'
                      assign spec_value = product_2_dimensions
                    when 'packageWeight'
                      assign spec_value = product_2_packageWeight
                    when 'material'
                      assign spec_value = product_2_material
                    when 'handleDesign'
                      assign spec_value = product_2_handleDesign
                    when 'adjustment'
                      assign spec_value = product_2_adjustment
                    when 'userGroup'
                      assign spec_value = product_2_userGroup
                  endcase
                -%}
                <div class="product-comparison__spec-cell {% if spec_index == 0 or spec_index == 2 or spec_index == 4 or spec_index == 6 %}product-comparison__spec-cell--even{% else %}product-comparison__spec-cell--odd{% endif %} {% if is_last_row %}product-comparison__spec-cell--last{% endif %}" data-product-id="{{ product_2.id }}">
                  <!-- Side borders -->
                  <div class="product-comparison__spec-border"></div>
                  <span class="product-comparison__spec-value">{{ spec_value }}</span>
                </div>
              {%- endif -%}
              {%- if product_3 != blank -%}
                {%- liquid
                  assign spec_value = '-'
                  case spec_key
                    when 'weightRange'
                      assign spec_value = product_3_weightRange
                    when 'increments'
                      assign spec_value = product_3_increments
                    when 'dimensions'
                      assign spec_value = product_3_dimensions
                    when 'packageWeight'
                      assign spec_value = product_3_packageWeight
                    when 'material'
                      assign spec_value = product_3_material
                    when 'handleDesign'
                      assign spec_value = product_3_handleDesign
                    when 'adjustment'
                      assign spec_value = product_3_adjustment
                    when 'userGroup'
                      assign spec_value = product_3_userGroup
                  endcase
                -%}
                <div class="product-comparison__spec-cell {% if spec_index == 0 or spec_index == 2 or spec_index == 4 or spec_index == 6 %}product-comparison__spec-cell--even{% else %}product-comparison__spec-cell--odd{% endif %} {% if is_last_row %}product-comparison__spec-cell--last{% endif %}" data-product-id="{{ product_3.id }}">
                  <!-- Side borders -->
                  <div class="product-comparison__spec-border"></div>
                  <span class="product-comparison__spec-value">{{ spec_value }}</span>
                </div>
              {%- endif -%}
              {%- if product_4 != blank -%}
                {%- liquid
                  assign spec_value = '-'
                  case spec_key
                    when 'weightRange'
                      assign spec_value = product_4_weightRange
                    when 'increments'
                      assign spec_value = product_4_increments
                    when 'dimensions'
                      assign spec_value = product_4_dimensions
                    when 'packageWeight'
                      assign spec_value = product_4_packageWeight
                    when 'material'
                      assign spec_value = product_4_material
                    when 'handleDesign'
                      assign spec_value = product_4_handleDesign
                    when 'adjustment'
                      assign spec_value = product_4_adjustment
                    when 'userGroup'
                      assign spec_value = product_4_userGroup
                  endcase
                -%}
                <div class="product-comparison__spec-cell {% if spec_index == 0 or spec_index == 2 or spec_index == 4 or spec_index == 6 %}product-comparison__spec-cell--even{% else %}product-comparison__spec-cell--odd{% endif %} {% if is_last_row %}product-comparison__spec-cell--last{% endif %}" data-product-id="{{ product_4.id }}">
                  <!-- Side borders -->
                  <div class="product-comparison__spec-border"></div>
                  <span class="product-comparison__spec-value">{{ spec_value }}</span>
                </div>
              {%- endif -%}
            {%- endfor -%}
          </div>
        </div>
      </div>

      <!-- Scroll indicators -->
      <div class="product-comparison__scroll-indicators">
        {%- if product_1 != blank -%}
          <button
            class="product-comparison__indicator"
            data-product-index="0"
            aria-label="Go to {{ product_1.title }}"></button>
        {%- endif -%}
        {%- if product_2 != blank -%}
          <button
            class="product-comparison__indicator"
            data-product-index="1"
            aria-label="Go to {{ product_2.title }}"></button>
        {%- endif -%}
        {%- if product_3 != blank -%}
          <button
            class="product-comparison__indicator"
            data-product-index="2"
            aria-label="Go to {{ product_3.title }}"></button>
        {%- endif -%}
        {%- if product_4 != blank -%}
          <button
            class="product-comparison__indicator"
            data-product-index="3"
            aria-label="Go to {{ product_4.title }}"></button>
        {%- endif -%}
      </div>
    {%- else -%}
      <p>No products found. Please check product handles in section settings.</p>
    {%- endif -%}
  </div>
</section>

<script>
  (function() {
    const section = document.querySelector('[data-section-id="{{ section.id }}"]');
    if (!section) return;

    const scrollContainer = section.querySelector('[data-scroll-container]');
    const productCards = section.querySelectorAll('.product-comparison__product-card');
    const specCells = section.querySelectorAll('.product-comparison__spec-cell');
    const indicators = section.querySelectorAll('.product-comparison__indicator');
    let hoveredProductId = null;

    // Hover functionality
    function handleProductHover(productId) {
      hoveredProductId = productId;
      updateHoverState();
    }

    function clearHover() {
      hoveredProductId = null;
      updateHoverState();
    }

    let currentHovered = null;
    
    function updateHoverState() {
      // Only update if changed
      if (currentHovered === hoveredProductId) return;
      currentHovered = hoveredProductId;
      
      // Update product cards
      productCards.forEach(card => {
        const cardProductId = card.getAttribute('data-product-id');
        card.classList.toggle('is-hovered', hoveredProductId === cardProductId);
      });

      // Update spec cells for the same product
      specCells.forEach(cell => {
        const cellProductId = cell.getAttribute('data-product-id');
        cell.classList.toggle('is-hovered', hoveredProductId === cellProductId);
      });

      // Update indicators
      indicators.forEach((indicator, index) => {
        const productCard = productCards[index];
        indicator.classList.toggle('product-comparison__indicator--active', 
          productCard && productCard.classList.contains('is-hovered'));
      });
    }

    // Event listeners

    // Optimized event listeners
    productCards.forEach(card => {
      card.addEventListener('mouseenter', () => {
        handleProductHover(card.getAttribute('data-product-id'));
      });
      card.addEventListener('mouseleave', clearHover);
    });

    specCells.forEach(cell => {
      cell.addEventListener('mouseenter', () => {
        handleProductHover(cell.getAttribute('data-product-id'));
      });
      cell.addEventListener('mouseleave', clearHover);
    });

    indicators.forEach((indicator, index) => {
      indicator.addEventListener('click', () => {
        if (!scrollContainer) return;
        const labelWidth = 140;
        const productWidth = (scrollContainer.scrollWidth - labelWidth) / productCards.length;
        scrollContainer.scrollTo({
          left: index * productWidth,
          behavior: 'smooth'
        });
      });
    });

    // Add to Cart functionality
    const addToCartButtons = section.querySelectorAll('[data-add-to-cart]');
    
    addToCartButtons.forEach(button => {
      button.addEventListener('click', async (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        const variantId = parseInt(button.getAttribute('data-variant-id'));
        const productHandle = button.getAttribute('data-product-handle');
        
        if (!variantId) {
          console.error('Variant ID not found');
          return;
        }
        
        const originalText = button.textContent;
        button.disabled = true;
        button.textContent = 'Adding...';
        
        try {
          const response = await fetch('/cart/add.js', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            body: JSON.stringify({
              id: variantId,
              quantity: 1
            })
          });
          
          if (!response.ok) {
            throw new Error('Failed to add to cart');
          }
          
          const data = await response.json();
          
          // Success feedback
          button.textContent = 'âœ“ Added!';
          button.style.background = '#10b981';
          
          // Update cart drawer if exists
          const cartDrawer = document.querySelector('cart-drawer');
          if (cartDrawer) {
            // Trigger cart update
            const event = new CustomEvent('cart:updated', { bubbles: true });
            document.dispatchEvent(event);
            
            // Open cart drawer
            if (cartDrawer.open) {
              cartDrawer.open();
            }
          }
          
          // Update cart count
          const cartCountElements = document.querySelectorAll('.cart-count, [data-cart-count]');
          if (cartCountElements.length > 0) {
            try {
              const cartResponse = await fetch('/cart.js');
              const cart = await cartResponse.json();
              cartCountElements.forEach(el => {
                el.textContent = cart.item_count;
                el.classList.toggle('hidden', cart.item_count === 0);
              });
            } catch (err) {
              console.error('Failed to update cart count:', err);
            }
          }
          
          // Reset button after 2 seconds
          setTimeout(() => {
            button.disabled = false;
            button.textContent = originalText;
            button.style.background = '';
          }, 2000);
          
        } catch (error) {
          console.error('Error adding to cart:', error);
          button.disabled = false;
          button.textContent = originalText;
          alert('Unable to add product to cart. Please try again.');
        }
      });
    });

  })();
</script>

{% schema %}
  {
    "name": "Product Comparison Table",
    "tag": "section",
    "class": "section",
    "settings": [],
    "presets": [
      {
        "name": "Product Comparison Table"
      }
    ]
  }
{% endschema %}