{%- style -%}
  .product-comparison {
    --brand: #eb701f;
    --border: #e5e7eb;
    --background: #ffffff;
    --muted-foreground: #6b7280;
    --foreground: #1a1a1a;
    --hover-bg: #fff8f3;
    --row-bg: #f8f8f8;
    width: 100%;
    position: relative;
  }

  .product-comparison__container {
    position: relative;
    max-width: 1740px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .product-comparison__table-wrapper {
    overflow-x: auto;
    scrollbar-width: none;
    -ms-overflow-style: none;
    scroll-behavior: smooth;
  }

  .product-comparison__table-wrapper::-webkit-scrollbar {
    display: none;
  }

  .product-comparison__table {
    min-width: 800px;
    width: 100%;
  }

  @media (min-width: 1024px) {
    .product-comparison__table {
      min-width: 0;
      width: 100%;
    }
  }

  .product-comparison__grid {
    display: grid;
    grid-template-columns: 140px repeat({{ section.blocks.size }}, minmax(160px, 1fr));
    width: 100%;
  }

  @media (min-width: 768px) {
    .product-comparison__grid {
      grid-template-columns: 160px repeat({{ section.blocks.size }}, minmax(180px, 1fr));
    }
  }

  @media (min-width: 1024px) {
    .product-comparison__grid {
      grid-template-columns: 180px repeat({{ section.blocks.size }}, 1fr);
    }
  }

  .product-comparison__label-cell {
    display: flex;
    align-items: center;
    padding: 1rem 0.5rem;
    position: sticky;
    left: 0;
    background: var(--background);
    z-index: 10;
    border-top: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
  }

  .product-comparison__label-cell--header {
    padding-bottom: 1rem;
    align-items: flex-end;
  }

  .product-comparison__label-text {
    color: var(--brand);
    font-weight: 500;
    font-size: 1rem;
  }

  .product-comparison__label-text--spec {
    font-size: 0.875rem;
  }

  .product-comparison__product-card {
    position: relative;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }

  .product-comparison__product-border {
    position: absolute;
    inset: 0;
    pointer-events: none;
    transition: border-color 0.2s ease
    , border-radius 0.2s ease;
    border: 2px solid transparent;
  }

  .product-comparison__product-card:hover .product-comparison__product-border,
  .product-comparison__product-card.is-hovered .product-comparison__product-border {
    border-color: var(--brand);
    border-bottom-color: transparent;
    border-radius: 0.5rem 0.5rem 0 0;
  }

  .product-comparison__badge {
    position: absolute;
    top: 0.75rem;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10;
    display: none;
  }

  .product-comparison__product-card:hover .product-comparison__badge,
  .product-comparison__product-card.is-hovered .product-comparison__badge {
    display: block;
  }

  .product-comparison__badge-text {
    background: var(--brand);
    color: white;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.375rem 1rem;
    border-radius: 9999px;
    white-space: nowrap;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .product-comparison__product-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 3rem 1rem 1rem;
    position: relative;
  }

  .product-comparison__product-image {
    position: relative;
    width: 100%;
    aspect-ratio: 4 / 3;
    margin-bottom: 1rem;
  }

  .product-comparison__product-image img {
    width: 100%;
    height: 100%;
    aspect-ratio: 4 / 3;
    object-fit: contain;
  }

  .product-comparison__product-title {
    font-size: 22px !important;
    font-weight: 700;
    color: var(--foreground);
    text-align: center;
    line-height: 1.25;
    margin-bottom: 1rem;
  }

  .product-comparison__product-buttons {
    display: flex;
    flex-direction: row;
    gap: 0.5rem;
    width: 100%;
    margin-top: 0.5rem;
    justify-content: center;
  }

  .product-comparison__product-cta,
  .product-comparison__product-learn-more {
    display: block;
    width: 100%;
    background: var(--brand);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 5px;
    font-size: 14px !important;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    text-transform: uppercase;
    text-align: center;
    text-decoration: none;
  }

  .product-comparison__product-cta:hover {
    background: #d65a0f;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(235, 112, 31, 0.3);
  }

  .product-comparison__product-cta:active {
    transform: translateY(0);
  }

  .product-comparison__product-cta:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }


  .product-comparison__product-learn-more:hover {
    background: var(--brand);
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(235, 112, 31, 0.3);
  }

  .product-comparison__product-learn-more:active {
    transform: translateY(0);
  }

  @media (max-width: 1023px) {
    .product-comparison__product-cta,
    .product-comparison__product-learn-more {
      font-size: 12px !important;
      padding: 0.625rem 1.25rem;
    }
  }

  .product-comparison__spec-cell {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    text-align: center;
    font-size: 0.875rem;
    color: var(--foreground);
    transition: background-color 0.2s ease;
    border-top: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
  }

  .product-comparison__label-cell--even,
  .product-comparison__label-cell--odd,
  .product-comparison__spec-cell--even,
  .product-comparison__spec-cell--odd {
    background: transparent;
  }


  .product-comparison__spec-border {
    position: absolute;
    inset: 0;
    pointer-events: none;
    transition: border-color 0.2s ease
    , border-radius 0.2s ease;
    border-left: 2px solid transparent;
    border-right: 2px solid transparent;
  }

  .product-comparison__spec-cell:hover .product-comparison__spec-border,
  .product-comparison__spec-cell.is-hovered .product-comparison__spec-border {
    border-left-color: var(--brand);
    border-right-color: var(--brand);
  }

  .product-comparison__spec-cell--last .product-comparison__spec-border {
    border-bottom: 2px solid transparent;
    border-radius: 0 0 0.5rem 0.5rem;
  }

  .product-comparison__spec-cell--last:hover .product-comparison__spec-border,
  .product-comparison__spec-cell--last.is-hovered .product-comparison__spec-border {
    border-bottom-color: var(--brand);
  }

  .product-comparison__spec-value {
    position: relative;
    z-index: 1;
  }

  .product-comparison__scroll-indicators {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin-top: 1rem;
  }

  @media (min-width: 1024px) {
    .product-comparison__scroll-indicators {
      display: none;
    }
  }

  .product-comparison__indicator {
    width: 0.5rem;
    height: 0.5rem;
    border-radius: 9999px;
    transition: background-color 0.2s ease
    , width 0.2s ease;
    background: rgba(107, 114, 128, 0.3);
    cursor: pointer;
    border: none;
    padding: 0;
  }

  .product-comparison__indicator:hover {
    background: rgba(107, 114, 128, 0.5);
  }

  .product-comparison__indicator--active {
    background: var(--brand);
    width: 1rem;
  }
  @media (max-width: 1044px) {
    .product-comparison__product-title {
      font-size: 16px !important;
    }
    .product-comparison__product-cta,
    .product-comparison__product-learn-more {
      padding: 2px !important;
      font-size: 12px !important;
      line-height: 1.2 !important;
    }
  }
  @media (max-width: 1024px) {
    .product-comparison__product-title {
      font-size: 16px !important;
    }
    .product-comparison__label-cell--header,
    .product-comparison__label-cell,
    .product-comparison__spec-cell {
      padding: 8px !important;
    }
  }
  @media (max-width: 1044px) {
    .product-comparison__product-buttons {
      flex-direction: column;
    }
    .product-comparison__product-cta,
    .product-comparison__product-learn-more {
      padding: 8px !important;
      font-size: 12px !important;
      line-height: 1.2 !important;
    }
  }
{%- endstyle -%}

<section class="product-comparison" data-section-id="{{ section.id }}">
  <div class="product-comparison__container">
    {%- if section.blocks.size > 0 -%}
      <!-- Table Container -->
      <div class="product-comparison__table-wrapper" data-scroll-container>
        <div class="product-comparison__table">
          <div class="product-comparison__grid">
            <!-- Header Row - Empty label cell + Product Cards -->
            <div class="product-comparison__label-cell product-comparison__label-cell--header"></div>

            {%- comment -%} Product Cards Header {%- endcomment -%}
            {%- for block in section.blocks -%}
              {%- assign product = block.settings.product -%}
              {%- if product != blank -%}
                <div
                  class="product-comparison__product-card"
                  data-product-id="{{ product.id }}"
                  data-product-handle="{{ product.handle }}"
                  {{ block.shopify_attributes }}>
                  <div class="product-comparison__product-border"></div>
                  <div class="product-comparison__badge">
                    <span class="product-comparison__badge-text">You Are Viewing</span>
                  </div>
                  <div class="product-comparison__product-content">
                    <div class="product-comparison__product-image">
                      {%- if block.settings.custom_image != blank -%}
                        {{
                          block.settings.custom_image | image_url: width: 400 | image_tag: loading: 'lazy', alt: product.title, class: 'product-comparison__product-image-img'
                        }}
                      {%- elsif product.featured_image -%}
                        {{
                          product.featured_image | image_url: width: 400 | image_tag: loading: 'lazy', alt: product.title, class: 'product-comparison__product-image-img'
                        }}
                      {%- else -%}
                        {{ 'image' | placeholder_svg_tag: 'product-comparison__product-image-img' }}
                      {%- endif -%}
                    </div>
                    <h3 class="product-comparison__product-title">{{ product.title }}</h3>
                    <div class="product-comparison__product-buttons">
                      <button
                        class="product-comparison__product-cta"
                        type="button"
                        data-add-to-cart
                        data-product-id="{{ product.id }}"
                        data-variant-id="{{ product.selected_or_first_available_variant.id }}"
                        data-product-handle="{{ product.handle }}">
                        Add to Cart
                      </button>
                      <a href="{{ product.url }}" class="product-comparison__product-learn-more">
                        Learn More
                      </a>
                    </div>
                  </div>
                </div>
              {%- endif -%}
          {%- endfor -%}

            {%- comment -%} Spec Rows {%- endcomment -%}
            {%- assign spec_keys = 'weightRange,increments,dimensions,packageWeight,material,handleDesign,adjustment,userGroup' | split: ',' -%}
            {%- assign spec_labels = 'Weight Range,Increments,Dimensions,Package Weight,Material,Handle Design,Adjustment,User Group' | split: ',' -%}

            {%- for spec_key in spec_keys -%}
              {%- assign spec_index = forloop.index0 -%}
              {%- assign spec_label = spec_labels[spec_index] -%}
              {%- assign is_last_row = forloop.last -%}

              <div class="product-comparison__label-cell {% if spec_index == 0 or spec_index == 2 or spec_index == 4 or spec_index == 6 %}product-comparison__label-cell--even{% else %}product-comparison__label-cell--odd{% endif %}">
                <span class="product-comparison__label-text product-comparison__label-text--spec">
                  {{ spec_label }}
                </span>
              </div>

              {%- for block in section.blocks -%}
                {%- assign product = block.settings.product -%}
                {%- if product != blank -%}
                  {%- liquid
                    assign spec_value = '-'
                    case spec_key
                      when 'weightRange'
                        assign spec_value = block.settings.weight_range | default: '-'
                      when 'increments'
                        assign spec_value = block.settings.increments | default: '-'
                      when 'dimensions'
                        assign spec_value = block.settings.dimensions | default: '-'
                      when 'packageWeight'
                        assign spec_value = block.settings.package_weight | default: '-'
                      when 'material'
                        assign spec_value = block.settings.material | default: '-'
                      when 'handleDesign'
                        assign spec_value = block.settings.handle_design | default: '-'
                      when 'adjustment'
                        assign spec_value = block.settings.adjustment | default: '-'
                      when 'userGroup'
                        assign spec_value = block.settings.user_group | default: '-'
                    endcase
                  -%}
                  <div
                    class="product-comparison__spec-cell {% if spec_index == 0 or spec_index == 2 or spec_index == 4 or spec_index == 6 %}product-comparison__spec-cell--even{% else %}product-comparison__spec-cell--odd{% endif %} {% if is_last_row %}product-comparison__spec-cell--last{% endif %}"
                    data-product-id="{{ product.id }}"
                    {{ block.shopify_attributes }}>
                    <div class="product-comparison__spec-border"></div>
                    <span class="product-comparison__spec-value">{{ spec_value }}</span>
                  </div>
                {%- else -%}
                  <div class="product-comparison__spec-cell product-comparison__spec-cell--odd {% if is_last_row %}product-comparison__spec-cell--last{% endif %}">
                    <span class="product-comparison__spec-value">-</span>
                  </div>
                {%- endif -%}
              {%- endfor -%}
            {%- endfor -%}
          </div>
        </div>
      </div>

      <!-- Scroll indicators -->
      <div class="product-comparison__scroll-indicators">
        {%- for block in section.blocks -%}
          {%- assign product = block.settings.product -%}
          {%- if product != blank -%}
            <button
              class="product-comparison__indicator"
              data-product-index="{{ forloop.index0 }}"
              aria-label="Go to {{ product.title }}"></button>
          {%- endif -%}
        {%- endfor -%}
      </div>
    {%- else -%}
      <div style="text-align: center; padding: 3rem 1rem;">
        <p>No products added. Please add product columns in the theme editor.</p>
      </div>
    {%- endif -%}
  </div>
</section>

<script>
  (function() {
    const section = document.querySelector('[data-section-id="{{ section.id }}"]');
    if (!section) return;

    const scrollContainer = section.querySelector('[data-scroll-container]');
    const productCards = section.querySelectorAll('.product-comparison__product-card');
    const specCells = section.querySelectorAll('.product-comparison__spec-cell');
    const indicators = section.querySelectorAll('.product-comparison__indicator');
    let hoveredProductId = null;

    // Hover functionality
    function handleProductHover(productId) {
      hoveredProductId = productId;
      updateHoverState();
    }

    function clearHover() {
      hoveredProductId = null;
      updateHoverState();
    }

    let currentHovered = null;
    
    function updateHoverState() {
      if (currentHovered === hoveredProductId) return;
      currentHovered = hoveredProductId;
      
      productCards.forEach(card => {
        const cardProductId = card.getAttribute('data-product-id');
        card.classList.toggle('is-hovered', hoveredProductId === cardProductId);
      });

      specCells.forEach(cell => {
        const cellProductId = cell.getAttribute('data-product-id');
        cell.classList.toggle('is-hovered', hoveredProductId === cellProductId);
      });

      indicators.forEach((indicator, index) => {
        const productCard = productCards[index];
        indicator.classList.toggle('product-comparison__indicator--active', 
          productCard && productCard.classList.contains('is-hovered'));
      });
    }

    // Event listeners
    productCards.forEach(card => {
      card.addEventListener('mouseenter', () => {
        handleProductHover(card.getAttribute('data-product-id'));
      });
      card.addEventListener('mouseleave', clearHover);
    });

    specCells.forEach(cell => {
      const productId = cell.getAttribute('data-product-id');
      if (productId) {
        cell.addEventListener('mouseenter', () => {
          handleProductHover(productId);
        });
        cell.addEventListener('mouseleave', clearHover);
      }
    });

    indicators.forEach((indicator, index) => {
      indicator.addEventListener('click', () => {
        if (!scrollContainer) return;
        const labelWidth = 140;
        const productWidth = (scrollContainer.scrollWidth - labelWidth) / productCards.length;
        scrollContainer.scrollTo({
          left: index * productWidth,
          behavior: 'smooth'
        });
      });
    });

    // Add to Cart functionality
    const addToCartButtons = section.querySelectorAll('[data-add-to-cart]');
    
    addToCartButtons.forEach(button => {
      button.addEventListener('click', async (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        const variantId = parseInt(button.getAttribute('data-variant-id'));
        const productHandle = button.getAttribute('data-product-handle');
        
        if (!variantId) {
          console.error('Variant ID not found');
          return;
        }
        
        const originalText = button.textContent;
        button.disabled = true;
        button.textContent = 'Adding...';
        
        try {
          const response = await fetch('/cart/add.js', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            body: JSON.stringify({
              id: variantId,
              quantity: 1
            })
          });
          
          if (!response.ok) {
            throw new Error('Failed to add to cart');
          }
          
          const data = await response.json();
          
          button.textContent = 'âœ“ Added!';
          button.style.background = '#10b981';
          
          const cartDrawer = document.querySelector('cart-drawer');
          if (cartDrawer) {
            const event = new CustomEvent('cart:updated', { bubbles: true });
            document.dispatchEvent(event);
            
            if (cartDrawer.open) {
              cartDrawer.open();
            }
          }
          
          const cartCountElements = document.querySelectorAll('.cart-count, [data-cart-count]');
          if (cartCountElements.length > 0) {
            try {
              const cartResponse = await fetch('/cart.js');
              const cart = await cartResponse.json();
              cartCountElements.forEach(el => {
                el.textContent = cart.item_count;
                el.classList.toggle('hidden', cart.item_count === 0);
              });
            } catch (err) {
              console.error('Failed to update cart count:', err);
            }
          }
          
          setTimeout(() => {
            button.disabled = false;
            button.textContent = originalText;
            button.style.background = '';
          }, 2000);
          
        } catch (error) {
          console.error('Error adding to cart:', error);
          button.disabled = false;
          button.textContent = originalText;
          alert('Unable to add product to cart. Please try again.');
        }
      });
    });

  })();
</script>

{% schema %}
  {
    "name": "Product Comparison Table",
    "tag": "section",
    "class": "section",
    "settings": [],
    "blocks": [
      {
        "type": "product_column",
        "name": "Product Column",
        "limit": 6,
        "settings": [
          {
            "type": "product",
            "id": "product",
            "label": "Product",
            "info": "Select the product to display in this column"
          },
          {
            "type": "image_picker",
            "id": "custom_image",
            "label": "Custom Image",
            "info": "Optional: Upload a custom image for this product. If not set, the product's featured image will be used."
          },
          {
            "type": "header",
            "content": "Product Specifications"
          },
          {
            "type": "text",
            "id": "weight_range",
            "label": "Weight Range",
            "default": "-",
            "info": "e.g., 5.5 - 27.5 lbs"
          }, {
            "type": "text",
            "id": "increments",
            "label": "Increments",
            "default": "-",
            "info": "e.g., 5.5 lbs"
          }, {
            "type": "text",
            "id": "dimensions",
            "label": "Dimensions",
            "default": "-",
            "info": "e.g., 16.2\"L x 7.2\"W x 7.2\"H"
          }, {
            "type": "text",
            "id": "package_weight",
            "label": "Package Weight",
            "default": "-",
            "info": "e.g., 32 lbs (single)"
          }, {
            "type": "text",
            "id": "material",
            "label": "Material",
            "default": "-",
            "info": "e.g., Steel plates, reinforced base"
          }, {
            "type": "text",
            "id": "handle_design",
            "label": "Handle Design",
            "default": "-",
            "info": "e.g., Steel core, non-slip rubber grip"
          }, {
            "type": "text",
            "id": "adjustment",
            "label": "Adjustment",
            "default": "-",
            "info": "e.g., Glide Tech or Dial Tech"
          }, {
            "type": "text",
            "id": "user_group",
            "label": "User Group",
            "default": "-",
            "info": "e.g., Beginners, home toning"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Product Comparison Table",
        "blocks": [
          {
            "type": "product_column",
            "settings": {
              "product": "27-5-lbs-adjustable-weight-dumbbell",
              "weight_range": "5.5 - 27.5 lbs",
              "increments": "5.5 lbs",
              "dimensions": "16.2\"L x 7.2\"W x 7.2\"H",
              "package_weight": "32 lbs (single)",
              "material": "Steel plates, reinforced base",
              "handle_design": "Steel core, non-slip rubber grip",
              "adjustment": "Glide Tech",
              "user_group": "Beginners, home toning"
            }
          }, {
            "type": "product_column",
            "settings": {
              "product": "50lbs",
              "weight_range": "5 - 50 lbs",
              "increments": "5 lbs",
              "dimensions": "16.7\"L x 8.2\"W x 7.7\"H",
              "package_weight": "-",
              "material": "Steel plates, reinforced base",
              "handle_design": "Steel core, non-slip rubber grip",
              "adjustment": "Dial Tech",
              "user_group": "General fitness, multi-purpose use"
            }
          }, {
            "type": "product_column",
            "settings": {
              "product": "66lbs",
              "weight_range": "11 - 66 lbs",
              "increments": "5 lbs",
              "dimensions": "16.2\"L x 7.2\"W x 7.2\"H",
              "package_weight": "145 lbs (set)",
              "material": "Steel plates, reinforced base",
              "handle_design": "Steel core, ergonomic design",
              "adjustment": "Dial Tech",
              "user_group": "General fitness, multi-purpose use"
            }
          }, {
            "type": "product_column",
            "settings": {
              "product": "88lbs",
              "weight_range": "11 - 88 lbs",
              "increments": "7 lbs",
              "dimensions": "16.2\"L x 8\"W x 8\"H",
              "package_weight": "99 lbs (single), 188lbs (set)",
              "material": "Steel plates, reinforced base",
              "handle_design": "Steel core, ergonomic design",
              "adjustment": "Dial Tech",
              "user_group": "Advanced training, pro-level workouts"
            }
          }
        ]
      }
    ]
  }
{% endschema %}