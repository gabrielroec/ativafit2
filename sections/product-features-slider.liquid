{%- comment -%}
  Product Features Slider Section
  Based on the mockup showing a slider with feature blocks
  Each feature has a title, description, and image
  Shows a progress bar on the bottom
{%- endcomment -%}

<div class="product-features-slider">
  <div class="features-slider-container">
    <div class="features-slider-title">
      <h2>{{ section.settings.slider_title }}</h2>
      <p>{{ section.settings.slider_subtitle }}</p>
    </div>

    <div class="features-cards-container">
      <div class="features-cards">
        <!-- Card 1 -->
        <div class="feature-card">
          {% if section.settings.card_1_image != blank %}
            <div class="feature-card-image">
              <img
                src="{{ section.settings.card_1_image | img_url: '600x600', crop: 'center' }}"
                alt="{{ section.settings.card_1_title | escape }}"
                loading="lazy">
            </div>
          {% else %}
            <div class="feature-card-image feature-image-placeholder"></div>
          {% endif %}
          <div class="feature-card-content">
            <h3>{{ section.settings.card_1_title }}</h3>
            <p>{{ section.settings.card_1_description }}</p>
          </div>
        </div>

        <!-- Card 2 -->
        <div class="feature-card">
          {% if section.settings.card_2_image != blank %}
            <div class="feature-card-image">
              <img
                src="{{ section.settings.card_2_image | img_url: '600x600', crop: 'center' }}"
                alt="{{ section.settings.card_2_title | escape }}"
                loading="lazy">
            </div>
          {% else %}
            <div class="feature-card-image feature-image-placeholder"></div>
          {% endif %}
          <div class="feature-card-content">
            <h3>{{ section.settings.card_2_title }}</h3>
            <p>{{ section.settings.card_2_description }}</p>
          </div>
        </div>

        <!-- Card 3 -->
        <div class="feature-card">
          {% if section.settings.card_3_image != blank %}
            <div class="feature-card-image">
              <img
                src="{{ section.settings.card_3_image | img_url: '600x600', crop: 'center' }}"
                alt="{{ section.settings.card_3_title | escape }}"
                loading="lazy">
            </div>
          {% else %}
            <div class="feature-card-image feature-image-placeholder"></div>
          {% endif %}
          <div class="feature-card-content">
            <h3>{{ section.settings.card_3_title }}</h3>
            <p>{{ section.settings.card_3_description }}</p>
          </div>
        </div>

        <!-- Card 4 -->
        <div class="feature-card">
          {% if section.settings.card_4_image != blank %}
            <div class="feature-card-image">
              <img
                src="{{ section.settings.card_4_image | img_url: '600x600', crop: 'center' }}"
                alt="{{ section.settings.card_4_title | escape }}"
                loading="lazy">
            </div>
          {% else %}
            <div class="feature-card-image feature-image-placeholder"></div>
          {% endif %}
          <div class="feature-card-content">
            <h3>{{ section.settings.card_4_title }}</h3>
            <p>{{ section.settings.card_4_description }}</p>
          </div>
        </div>

        <!-- Card 5 -->
        <div class="feature-card">
          {% if section.settings.card_5_image != blank %}
            <div class="feature-card-image">
              <img
                src="{{ section.settings.card_5_image | img_url: '600x600', crop: 'center' }}"
                alt="{{ section.settings.card_5_title | escape }}"
                loading="lazy">
            </div>
          {% else %}
            <div class="feature-card-image feature-image-placeholder"></div>
          {% endif %}
          <div class="feature-card-content">
            <h3>{{ section.settings.card_5_title }}</h3>
            <p>{{ section.settings.card_5_description }}</p>
          </div>
        </div>

        <!-- Card 6 -->
        <div class="feature-card">
          {% if section.settings.card_6_image != blank %}
            <div class="feature-card-image">
              <img
                src="{{ section.settings.card_6_image | img_url: '600x600', crop: 'center' }}"
                alt="{{ section.settings.card_6_title | escape }}"
                loading="lazy">
            </div>
          {% else %}
            <div class="feature-card-image feature-image-placeholder"></div>
          {% endif %}
          <div class="feature-card-content">
            <h3>{{ section.settings.card_6_title }}</h3>
            <p>{{ section.settings.card_6_description }}</p>
          </div>
        </div>

        <!-- Card 7 -->
        <div class="feature-card">
          {% if section.settings.card_7_image != blank %}
            <div class="feature-card-image">
              <img
                src="{{ section.settings.card_7_image | img_url: '600x600', crop: 'center' }}"
                alt="{{ section.settings.card_7_title | escape }}"
                loading="lazy">
            </div>
          {% else %}
            <div class="feature-card-image feature-image-placeholder"></div>
          {% endif %}
          <div class="feature-card-content">
            <h3>{{ section.settings.card_7_title }}</h3>
            <p>{{ section.settings.card_7_description }}</p>
          </div>
        </div>

        <!-- Card 8 -->
        <div class="feature-card">
          {% if section.settings.card_8_image != blank %}
            <div class="feature-card-image">
              <img
                src="{{ section.settings.card_8_image | img_url: '600x600', crop: 'center' }}"
                alt="{{ section.settings.card_8_title | escape }}"
                loading="lazy">
            </div>
          {% else %}
            <div class="feature-card-image feature-image-placeholder"></div>
          {% endif %}
          <div class="feature-card-content">
            <h3>{{ section.settings.card_8_title }}</h3>
            <p>{{ section.settings.card_8_description }}</p>
          </div>
        </div>
      </div>
    </div>

    <div class="slider-controls">
      <div class="slider-progress">
        <div class="slider-progress-bar"></div>
      </div>
      <div class="slider-navigation">
        <button class="slider-nav prev" aria-label="Previous slide">
          <svg
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path
              d="M15 6L9 12L15 18"
              stroke="#212121"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round" />
          </svg>
        </button>
        <div class="slider-indicator">
          <span class="current">1</span>/<span class="total">{{ section.blocks.size }}</span>
        </div>
        <button class="slider-nav next" aria-label="Next slide">
          <svg
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path
              d="M9 18L15 12L9 6"
              stroke="#212121"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round" />
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>

<style>
  .product-features-slider {
    width: 100%;
    max-width: 1370px;
    margin: 60px auto;
    padding: 0 40px;
    font-family: Barlow;
    sans-serif;
  }

  .features-slider-container {
    position: relative;
  }

  .features-slider-title {
    text-align: left;
    width: 100%;
    max-width: 665px;
    margin-bottom: 40px;
  }

  .features-slider-title h2 {
    font-size: 36px;
    line-height: 1.5;
    color: #212121;
    margin-bottom: 0 !important;
    font-weight: 600;
  }

  .features-slider-title p {
    font-size: 16px;
    color: #212121;
  }

  /* Cards layout */
  .features-cards-container {
    position: relative;
    overflow: hidden;
    margin-bottom: 20px;
  }

  .features-cards {
    display: flex;
    gap: 20px;
    flex-wrap: nowrap;
    transition: transform 0.5s ease;
    width: 100%;
  }

  .feature-card {
    flex: 0 0 calc(33.333% - 14px);
    min-width: 250px;
    border-radius: 10px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    background-color: #fff;
  }

  .feature-card-image {
    width: 100%;
    height: 300px;
    background-color: #e0e0e0;
    border-radius: 10px;
    overflow: hidden;
  }

  .feature-card-image img {
    width: 100%;
    height: 300px;
    object-fit: cover;
    object-position: center;
  }

  .feature-card-content {
    margin-top: 10px;
    text-align: left;
  }

  .feature-card-content h3 {
    font-size: 18px;
    color: #212121;
    margin-bottom: 8px;
    font-weight: 500 !important;
  }

  .feature-card-content p {
    font-size: 16px;
    color: #212121;
    line-height: 1.4;
  }

  /* Slider progress bar */
  .slider-controls {
    margin-top: 20px;
  }

  .slider-progress {
    width: 100%;
    height: 4px;
    background-color: #e0e0e0;
    border-radius: 2px;
    margin-bottom: 15px;
    overflow: hidden;
  }

  .slider-progress-bar {
    height: 100%;
    width: 30%;
    background-color: #EB701F;
    transition: width 0.3s ease;
  }

  .slider-navigation {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
  }

  .slider-indicator {
    font-size: 15px;
    color: #212121;
  }

  .slider-nav {
    background: none;
    border: none;
    width: 36px;
    height: 36px;
    border-radius: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: #212121;
    background-color: #f5f5f5;
    transition: background-color 0.2s ease;
  }

  .slider-nav:hover {
    background-color: #e0e0e0;
  }

  @media screen and (max-width: 1024px) {
    .product-features-slider {
      padding: 0 20px;
      margin: 40px auto;
    }

    .feature-card {
      flex: 0 0 calc(50% - 10px);
    }
  }

  @media screen and (max-width: 767px) {
    .product-features-slider {
      padding: 0 15px;
      margin: 30px auto;
    }

    .features-slider-title h2 {
      font-size: 24px;
      margin-bottom: 10px;
    }

    .features-slider-title p {
      font-size: 14px;
    }

    .feature-card {
      flex: 0 0 100%;
    }

    .feature-card-content h3 {
      font-size: 16px;
    }

    .feature-card-content p {
      font-size: 13px;
    }

    .slider-controls {
      margin-top: 15px;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const cardsContainer = document.querySelector('.features-cards');
    const cards = document.querySelectorAll('.feature-card');
    const progressBar = document.querySelector('.slider-progress-bar');
    const prevButton = document.querySelector('.slider-nav.prev');
    const nextButton = document.querySelector('.slider-nav.next');
    const currentSlideIndicator = document.querySelector('.slider-indicator .current');
    const totalSlideIndicator = document.querySelector('.slider-indicator .total');
    
    if (!cardsContainer || cards.length === 0) return;
    
    // Calculate how many cards to show per view based on screen width
    function getCardsPerView() {
      if (window.innerWidth <= 767) {
        return 1;
      } else if (window.innerWidth <= 1024) {
        return 2;
      } else {
        return 3;
      }
    }
    
    let cardsPerView = getCardsPerView();
    let currentPage = 0;
    const totalPages = Math.ceil(cards.length / cardsPerView);
    
    // Update indicators
    if (totalSlideIndicator) {
      totalSlideIndicator.textContent = totalPages;
    }
    if (currentSlideIndicator) {
      currentSlideIndicator.textContent = 1;
    }
    
    // Update progress bar
    function updateProgressBar() {
      const progress = ((currentPage + 1) / totalPages) * 100;
      if (progressBar) {
        progressBar.style.width = `${progress}%`;
      }
      if (currentSlideIndicator) {
        currentSlideIndicator.textContent = currentPage + 1;
      }
    }
    
    // Slide to a specific page
    function goToPage(page) {
      if (page < 0) {
        page = totalPages - 1;
      } else if (page >= totalPages) {
        page = 0;
      }
      
      currentPage = page;
      const offset = page * cardsPerView;
      const cardWidth = cards[0].offsetWidth + 20; // card width + gap
      cardsContainer.style.transform = `translateX(-${offset * cardWidth}px)`;
      
      updateProgressBar();
    }
    
    // Handle window resize
    window.addEventListener('resize', () => {
      const newCardsPerView = getCardsPerView();
      if (newCardsPerView !== cardsPerView) {
        cardsPerView = newCardsPerView;
        const newTotalPages = Math.ceil(cards.length / cardsPerView);
        if (totalSlideIndicator) {
          totalSlideIndicator.textContent = newTotalPages;
        }
        if (currentPage >= newTotalPages) {
          currentPage = newTotalPages - 1;
        }
        goToPage(currentPage);
      }
    });
    
    // Add event listeners for navigation buttons
    if (prevButton) {
      prevButton.addEventListener('click', () => {
        goToPage(currentPage - 1);
      });
    }
    
    if (nextButton) {
      nextButton.addEventListener('click', () => {
        goToPage(currentPage + 1);
      });
    }
    
    // Initialize
    updateProgressBar();
    
    // Auto play (optional)
    if ({{ section.settings.auto_play | json }}) {
      const interval = {{ section.settings.auto_play_interval | default: 5000 }};
      
      setInterval(() => {
        goToPage(currentPage + 1);
      }, interval);
    }
  });
</script>

{% schema %}
  {
    "name": "Features Slider",
    "tag": "section",
    "class": "product-section",
    "settings": [
      {
        "type": "header",
        "content": "Slider Content"
      },
      {
        "type": "text",
        "id": "slider_title",
        "label": "Slider Title",
        "default": "Maximize Strength and Performance: Ativafit 66lbs Dumbbell Features"
      },
      {
        "type": "text",
        "id": "slider_subtitle",
        "label": "Slider Subtitle",
        "default": "Unmatched weight range for progressive training. Designed for comprehensive home workouts."
      },
      {
        "type": "header",
        "content": "Card 1"
      }, {
        "type": "text",
        "id": "card_1_title",
        "label": "Title",
        "default": "One dumbbell, boundless strength"
      }, {
        "type": "textarea",
        "id": "card_1_description",
        "label": "Description",
        "default": "Elevate from a solid 11 lbs to an impressive 66 lbs, catering to diverse training requirements, from foundational exercises to heavy lifting."
      }, {
        "type": "image_picker",
        "id": "card_1_image",
        "label": "Image"
      }, {
        "type": "header",
        "content": "Card 2"
      }, {
        "type": "text",
        "id": "card_2_title",
        "label": "Title",
        "default": "Synchronized Weight Adjustment"
      }, {
        "type": "textarea",
        "id": "card_2_description",
        "label": "Description",
        "default": "Our advanced dumbbells enable simultaneous weight changes on both sides, streamlining your workout experience without the hassle."
      }, {
        "type": "image_picker",
        "id": "card_2_image",
        "label": "Image"
      }, {
        "type": "header",
        "content": "Card 3"
      }, {
        "type": "text",
        "id": "card_3_title",
        "label": "Title",
        "default": "Minimalist Footprint"
      }, {
        "type": "textarea",
        "id": "card_3_description",
        "label": "Description",
        "default": "With dimensions of 15.9\"L × 9\"W × 9.4\"H, these adjustable dumbbells are incredibly space-efficient, transforming any small corner into a versatile workout zone."
      }, {
        "type": "image_picker",
        "id": "card_3_image",
        "label": "Image"
      }, {
        "type": "header",
        "content": "Card 4"
      }, {
        "type": "text",
        "id": "card_4_title",
        "label": "Title",
        "default": "Laser Precision Steel Plates"
      }, {
        "type": "textarea",
        "id": "card_4_description",
        "label": "Description",
        "default": "Our laser-cut steel plates ensure optimal balance and uniform weight distribution for smooth lifts. Designed for home workouts, the structure of our dumbbells enables substantial weight without bulkiness."
      }, {
        "type": "image_picker",
        "id": "card_4_image",
        "label": "Image"
      }, {
        "type": "header",
        "content": "Card 5"
      }, {
        "type": "text",
        "id": "card_5_title",
        "label": "Title",
        "default": "Premium Material Construction"
      }, {
        "type": "textarea",
        "id": "card_5_description",
        "label": "Description",
        "default": "Crafted from high-grade materials, our dumbbells offer durability and longevity, standing up to even the most rigorous daily training sessions."
      }, {
        "type": "image_picker",
        "id": "card_5_image",
        "label": "Image"
      }, {
        "type": "header",
        "content": "Card 6"
      }, {
        "type": "text",
        "id": "card_6_title",
        "label": "Title",
        "default": "Ergonomic Handle Design"
      }, {
        "type": "textarea",
        "id": "card_6_description",
        "label": "Description",
        "default": "The textured, non-slip handle ensures a secure grip during intense workouts, reducing strain on your wrists and preventing accidents."
      }, {
        "type": "image_picker",
        "id": "card_6_image",
        "label": "Image"
      }, {
        "type": "header",
        "content": "Card 7"
      }, {
        "type": "text",
        "id": "card_7_title",
        "label": "Title",
        "default": "Quick-Change Weight System"
      }, {
        "type": "textarea",
        "id": "card_7_description",
        "label": "Description",
        "default": "Our innovative selector pin allows for fast weight adjustments between sets, eliminating downtime and keeping your heart rate elevated throughout your workout."
      }, {
        "type": "image_picker",
        "id": "card_7_image",
        "label": "Image"
      }, {
        "type": "header",
        "content": "Card 8"
      }, {
        "type": "text",
        "id": "card_8_title",
        "label": "Title",
        "default": "Compact Storage Solution"
      }, {
        "type": "textarea",
        "id": "card_8_description",
        "label": "Description",
        "default": "These all-in-one dumbbells replace up to 15 pairs of traditional weights, saving precious floor space in your home gym while offering the full range of resistance training."
      }, {
        "type": "image_picker",
        "id": "card_8_image",
        "label": "Image"
      }, {
        "type": "header",
        "content": "Slider Settings"
      }, {
        "type": "checkbox",
        "id": "auto_play",
        "label": "Auto Play",
        "default": false
      }, {
        "type": "range",
        "id": "auto_play_interval",
        "min": 2000,
        "max": 9000,
        "step": 500,
        "unit": "ms",
        "label": "Auto Play Interval",
        "default": 5000
      }
    ],
    "presets": [
      {
        "name": "Features Slider",
        "category": "Product"
      }
    ]
  }
{% endschema %}
